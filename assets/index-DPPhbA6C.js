import{a as ps,b as gs,g as xs,R as oe,r as w,H as ys}from"./vendor-BjY53brD.js";import{C as bs}from"./websocket-ImiZJucQ.js";import{R as ws,L as vs,C as Ns,X as Ss,Y as ot,T as js,a as ye}from"./charts-DBFlZrrq.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var We={exports:{}},be={};var at;function ks(){if(at)return be;at=1;var t=ps(),e=Symbol.for("react.element"),s=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(l,d,c){var u,f={},y=null,O=null;c!==void 0&&(y=""+c),d.key!==void 0&&(y=""+d.key),d.ref!==void 0&&(O=d.ref);for(u in d)n.call(d,u)&&!i.hasOwnProperty(u)&&(f[u]=d[u]);if(l&&l.defaultProps)for(u in d=l.defaultProps,d)f[u]===void 0&&(f[u]=d[u]);return{$$typeof:e,type:l,key:y,ref:O,props:f,_owner:o.current}}return be.Fragment=s,be.jsx=a,be.jsxs=a,be}var it;function Cs(){return it||(it=1,We.exports=ks()),We.exports}var r=Cs(),Me={},lt;function Ts(){if(lt)return Me;lt=1;var t=gs();return Me.createRoot=t.createRoot,Me.hydrateRoot=t.hydrateRoot,Me}var Es=Ts();const Ms=xs(Es);class As extends oe.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Error caught by boundary:",e,s)}render(){return this.state.hasError?r.jsx("div",{className:"min-h-screen bg-red-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md",children:[r.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"âš ï¸ Application Error"}),r.jsx("p",{className:"text-gray-700 mb-4",children:"The dashboard encountered an error and had to reload."}),r.jsx("p",{className:"text-sm text-gray-500 mb-6 font-mono break-words",children:this.state.error?.toString()}),r.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Reload Page"})]})}):this.props.children}}const Lt=w.createContext({userId:"",jwtToken:"",setAuth:()=>{},logout:()=>{}}),Le=()=>w.useContext(Lt),Os=({children:t})=>{const[e,s]=w.useState(localStorage.getItem("userId")||""),[n,o]=w.useState(localStorage.getItem("jwtToken")||""),l={userId:e,jwtToken:n,setAuth:({userId:d,jwtToken:c})=>{s(d),o(c),localStorage.setItem("jwtToken",c),localStorage.setItem("userId",d),console.log("âœ… Auth state updated:",{userId:d,hasToken:!!c})},logout:()=>{s(""),o(""),localStorage.clear(),window.location.href="/"}};return r.jsx(Lt.Provider,{value:l,children:t})};var Rs={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ds=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),$s=(t,e)=>{const s=w.forwardRef(({color:n="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:a,children:l,...d},c)=>w.createElement("svg",{ref:c,...Rs,width:o,height:o,stroke:n,strokeWidth:a?Number(i)*24/Number(o):i,className:`lucide lucide-${Ds(t)}`,...d},[...e.map(([u,f])=>w.createElement(u,f)),...(Array.isArray(l)?l:[l])||[]]));return s.displayName=`${t}`,s};var B=$s;const Ft=B("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Is=B("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ct=B("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),ut=B("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Ls=B("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),dt=B("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Fs=B("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),mt=B("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),ft=B("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),_s=B("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ps=B("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Us=B("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Bs=B("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Ke=B("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Hs=B("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Ws=B("Power",[["path",{d:"M18.36 6.64a9 9 0 1 1-12.73 0",key:"phirl6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"12",key:"aemgbe"}]]),qs=B("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),zs=B("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),_t=B("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Js=B("Sprout",[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]]),ht=B("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),pt=B("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),Pt=B("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Ut=B("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Bt=w.createContext(null);let qe=1;const gt="app_notifications_v1",Vs=({children:t})=>{const[e,s]=w.useState(()=>{try{const a=localStorage.getItem(gt);if(a){const l=JSON.parse(a);if(Array.isArray(l)&&l.length>0){const d=l.reduce((c,u)=>Math.max(c,u.id||0),0);qe=Math.max(qe,d+1)}return l}}catch{}return[]});w.useEffect(()=>{try{localStorage.setItem(gt,JSON.stringify(e))}catch{}},[e]);const n=w.useCallback(a=>{const l={id:qe++,type:a?.type||"info",message:a?.message||"",meta:a?.meta||{},timestamp:a?.timestamp||new Date().toISOString(),read:!1};return s(d=>[l,...d].slice(0,1e3)),l.id},[]),o=w.useCallback(a=>{s(l=>l.map(d=>d.id===a?{...d,read:!0}:d))},[]),i=w.useCallback(a=>{if(!a){s([]);return}s(l=>l.filter(d=>(d.meta&&d.meta.deviceId)!==a))},[]);return r.jsx(Bt.Provider,{value:{notifications:e,addNotification:n,markRead:o,clearAll:i},children:t})},Qe=()=>{const t=w.useContext(Bt);if(!t)throw new Error("useNotifications must be used within NotificationProvider");return t},Ks=t=>{if(!t)return console.error("âŒ Cannot build WebSocket URL: No JWT token available"),null;const e=encodeURIComponent(t),s=`wss://api.protonestconnect.co/ws?token=${e}`;return console.log("ðŸ”Œ WebSocket URL built:",s.replace(e,"***TOKEN***")),s};class Xs{constructor(){this.client=null,this.currentDeviceId=null,this.subscriptions=new Map,this.dataCallback=null,this.connectCallbacks=[],this.disconnectCallbacks=[],this.isReady=!1,this.jwtToken=null}_initializeClient(e){if(this.client){console.log("[WebSocketClient] Client already initialized");return}const s=Ks(e);if(!s)throw new Error("Failed to build WebSocket URL - invalid token");this.client=new bs({brokerURL:s,reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:n=>{console.log("âœ… WebSocket Connected:",n),this.isReady=!0,this.currentDeviceId&&this._subscribeToDeviceTopics(this.currentDeviceId),Array.isArray(this.connectCallbacks)&&this.connectCallbacks.length>0&&this.connectCallbacks.forEach(o=>{try{o()}catch(i){console.warn("[WebSocketClient] connect callback failed",i)}})},onStompError:n=>{console.error("âŒ Broker reported error:",n.headers.message),console.error("Details:",n.body)},onWebSocketError:n=>{console.error("ðŸš« WebSocket error",n)},onWebSocketClose:n=>{console.warn("ðŸ”» WebSocket closed",n),this.isReady=!1,Array.isArray(this.disconnectCallbacks)&&this.disconnectCallbacks.length>0&&this.disconnectCallbacks.forEach(o=>{try{o()}catch(i){console.warn("[WebSocketClient] disconnect callback failed",i)}})},debug:n=>console.log("ðŸªµ Debug:",n)}),this.client.activate(),console.log("[WebSocketClient] STOMP client activated")}_subscribeToDeviceTopics(e){const s=this,n=`/topic/stream/${e}`,o=this.client.subscribe(n,l=>{const d=JSON.parse(l.body);if(console.log(`ðŸ“¡ [${e}] Received stream data:`,d),s.dataCallback){const c=d.payload||d,u=d.topic,f={temp:"temp",temperature:"temp",humidity:"humidity",moisture:"moisture",light:"light",battery:"battery"},O=Object.keys(f).filter(h=>c[h]!==void 0);if(O.length>2){console.log(`ðŸŽ¯ [${e}] Received BATCH state update with ${O.length} sensors`);const h={};O.forEach(g=>{const p=f[g];h[p]=c[g],console.log(`   - ${p}: ${c[g]}`)}),s.dataCallback({sensorType:"batchUpdate",value:h,timestamp:d.timestamp||new Date().toISOString()})}else{let h=!1;if(u&&c[u]!==void 0){const g=f[u]||u;console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: ${g} = ${c[u]}`),s.dataCallback({sensorType:g,value:c[u],timestamp:d.timestamp||new Date().toISOString()}),h=!0}else for(const[g,p]of Object.entries(f))c[g]!==void 0&&(console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: ${p} = ${c[g]}`),s.dataCallback({sensorType:p,value:c[g],timestamp:d.timestamp||new Date().toISOString()}),h=!0);h||console.warn(`âš ï¸ [${e}] No recognized sensor field in message:`,d)}}else console.warn(`âš ï¸ [${e}] No callback registered yet - data will be lost:`,d)});this.subscriptions.set(`stream-${e}`,o),console.log(`ðŸ”” Subscribed to ${n}`);const i=`/topic/state/${e}`,a=this.client.subscribe(i,l=>{const d=JSON.parse(l.body);console.log(`ðŸ”§ [${e}] Pump state received:`,d);const c=d.payload||d;if(s.dataCallback){const u=c.power||c.status||c.pumpStatus;if(u!==void 0){const y=String(u).toUpperCase();console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: pumpStatus = ${y}`),s.dataCallback({sensorType:"pumpStatus",value:y,timestamp:d.timestamp||new Date().toISOString()})}const f=c.mode||c.pumpMode;if(f!==void 0){const y=String(f).toLowerCase();console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: pumpMode = ${y}`),s.dataCallback({sensorType:"pumpMode",value:y,timestamp:d.timestamp||new Date().toISOString()})}}});this.subscriptions.set(`state-${e}`,a),console.log(`ðŸ”” Subscribed to ${i}`)}_unsubscribeFromDeviceTopics(e){const s=`stream-${e}`,n=`state-${e}`;this.subscriptions.has(s)&&(this.subscriptions.get(s).unsubscribe(),this.subscriptions.delete(s),console.log(`ðŸ”• Unsubscribed from /topic/stream/${e}`)),this.subscriptions.has(n)&&(this.subscriptions.get(n).unsubscribe(),this.subscriptions.delete(n),console.log(`ðŸ”• Unsubscribed from /topic/state/${e}`))}unsubscribeFromDevice(e){try{this._unsubscribeFromDeviceTopics(e)}catch(s){console.warn("[WebSocketClient] Failed to unsubscribe from device",e,s)}}async connect(e){if(!e)throw console.error("[WebSocketClient] âŒ Cannot connect: No JWT token provided"),new Error("JWT token required for WebSocket connection");return this.jwtToken=e,this.client?this.isConnected?console.log("[WebSocketClient] âœ… Already connected"):(console.log("[WebSocketClient] ðŸ”„ Reconnecting..."),this.client.activate()):(console.log("[WebSocketClient] ðŸ”„ Initializing STOMP client..."),this._initializeClient(e)),Promise.resolve()}subscribeToDevice(e,s){return this.currentDeviceId&&this.currentDeviceId!==e&&(console.log(`[WebSocketClient] ðŸ”„ Switching from ${this.currentDeviceId} to ${e}`),this._unsubscribeFromDeviceTopics(this.currentDeviceId)),this.currentDeviceId=e,this.dataCallback=s,console.log(`[WebSocketClient] Callback registered for device: ${e}`),this.isReady&&this.isConnected?this._subscribeToDeviceTopics(e):console.log(`[WebSocketClient] Will subscribe to ${e} when connection is ready`),!0}get isConnected(){return this.client?.connected||!1}getConnectionStatus(){return this.isConnected}onConnect(e){if(typeof e=="function"&&(this.connectCallbacks.push(e),this.isConnected))try{e()}catch(s){console.warn("[WebSocketClient] onConnect immediate call failed",s)}}offConnect(e){e&&(this.connectCallbacks=this.connectCallbacks.filter(s=>s!==e))}onDisconnect(e){typeof e=="function"&&this.disconnectCallbacks.push(e)}offDisconnect(e){e&&(this.disconnectCallbacks=this.disconnectCallbacks.filter(s=>s!==e))}sendPumpCommand(e,s,n=null){if(!this.isConnected)return console.warn("[WebSocketClient] Cannot send command - not connected"),!1;const o=`protonest/${e}/state/motor/paddy`,i={power:s.toLowerCase()};n&&(i.mode=n.toLowerCase());try{return this.client.publish({destination:o,body:JSON.stringify(i)}),console.log("[WebSocketClient] ðŸ“¤ Sent pump command:",i),!0}catch(a){return console.error("[WebSocketClient] âŒ Failed to send pump command:",a),!1}}disconnect(){this.client&&this.isConnected?(console.log("[WebSocketClient] ðŸ”Œ Disconnecting..."),this.currentDeviceId&&this._unsubscribeFromDeviceTopics(this.currentDeviceId),this.client.deactivate(),this.isReady=!1):console.log("[WebSocketClient] Already disconnected")}enableTestingMode(){typeof window>"u"||(window.sendPumpCommand=(e,s=null)=>this.currentDeviceId?this.sendPumpCommand(this.currentDeviceId,e,s):(console.error("âŒ No device selected. Subscribe to a device first."),!1),window.simulateSensorData=(e,s)=>{if(!this.isConnected)return console.error("âŒ Not connected"),!1;if(!this.currentDeviceId)return console.error("âŒ No device selected. Subscribe to a device first."),!1;const n=`protonest/${this.currentDeviceId}/stream/${e}`,o={[e]:String(s)};try{return this.client.publish({destination:n,body:JSON.stringify(o)}),console.log("ðŸ“¤ Simulated:",o),!0}catch(i){return console.error("âŒ Failed:",i),!1}},window.wsInfo=()=>{console.log("ðŸ“Š WebSocket Info:"),console.log("   Connected:",this.isConnected),console.log("   Current Device:",this.currentDeviceId||"None"),console.log("   Active Subscriptions:",Array.from(this.subscriptions.keys()))},console.log(""),console.log("ðŸ§ª Testing Mode Enabled!"),console.log('   sendPumpCommand("on")'),console.log('   sendPumpCommand("off")'),console.log('   simulateSensorData("temp", 25.5)'),console.log("   wsInfo()"),console.log(""))}}const se=new Xs,Gs=({deviceId:t,deviceList:e,activeTab:s,setActiveTab:n,selectedDevice:o,setSelectedDevice:i,isConnected:a,alertMessage:l})=>{const[d,c]=w.useState(()=>{if(typeof a<"u")return!!a;try{return!!se.getConnectionStatus()}catch{return!1}});w.useEffect(()=>{if(typeof a<"u"){c(!!a);return}const v=setInterval(()=>{try{const T=!!se.getConnectionStatus();c(T)}catch{c(!1)}},1e3);return()=>clearInterval(v)},[a]);const u=d?"green":"red",f=d?"green":"red",y=d?"green":"yellow",O={green:"Online",yellow:"Limited",red:"Offline"},h=(v,T,M)=>{const _=v==="green"?"text-green-500":v==="yellow"?"text-yellow-500":"text-red-500";return r.jsxs("div",{className:"relative group flex items-center",children:[r.jsx(T,{className:`w-5 h-5 ${_}`}),r.jsx("span",{className:"sr-only",children:M}),r.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 px-2 py-1 rounded bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-50 shadow-lg transition-opacity duration-200",children:[M,": ",O[v]]})]})},{userId:g,logout:p}=Le(),j=e||["device9988","device0011233","device0000","device0001"],C=o||localStorage.getItem("selectedDevice")||j[0],N=v=>{const T=v.target.value;localStorage.setItem("selectedDevice",T),typeof i=="function"&&i(T)};return r.jsx("header",{className:"fixed inset-x-0 top-4 flex justify-center z-50",children:r.jsxs("div",{className:"w-[calc(100%-2rem)] max-w-7xl bg-white border-2 rounded-lg px-4 py-2 flex flex-col sm:flex-row justify-between items-center shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-4 sm:mb-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:()=>typeof n=="function"?n("dashboard"):null,className:`flex items-center justify-center w-8 h-8 rounded-lg transition border-none focus:outline-none ${s==="dashboard"?"bg-blue-50 text-blue-600 shadow-sm":"bg-transparent text-gray-500 hover:bg-gray-100"}`,title:"Dashboard","aria-label":"Dashboard","aria-current":s==="dashboard"?"page":void 0,children:[r.jsx(Bs,{className:"w-4 h-4"}),r.jsx("span",{className:"sr-only",children:"Dashboard"})]}),r.jsxs("button",{onClick:()=>typeof n=="function"?n("settings"):null,className:`flex items-center justify-center w-8 h-8 rounded-lg transition border-none focus:outline-none ${s==="settings"?"bg-blue-50 text-blue-600 shadow-sm":"bg-transparent text-gray-500 hover:bg-gray-100"}`,title:"Device Settings","aria-label":"Device Settings","aria-current":s==="settings"?"page":void 0,children:[r.jsx(_t,{className:"w-4 h-4"}),r.jsx("span",{className:"sr-only",children:"Device Settings"})]})]}),r.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[r.jsx(Js,{className:"h-6 w-6 text-green-600"}),r.jsxs("span",{className:"text-2xl font-bold tracking-wide font-mono",children:["Agri",r.jsx("span",{className:"text-yellow-400",children:"Cop"})]})]}),r.jsxs("div",{className:"text-left text-xs ml-4",children:[r.jsx("div",{className:"text-green-600 font-bold",children:"Authentication: Successful"}),r.jsxs("div",{className:"text-gray-600 font-mono",children:["User: ",g]}),r.jsxs("button",{onClick:p,className:"text-red-500 hover:underline mt-1 flex items-center gap-1",children:["Logout ",r.jsx(Hs,{className:"w-3 h-3"})]})]})]}),r.jsx("div",{className:"flex-1 flex justify-center items-center mb-4 sm:mb-0",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Select Device:"}),r.jsx("select",{value:C||"",onChange:N,className:"bg-white border border-green-300 text-gray-700 py-1 px-2 rounded focus:ring-2 focus:ring-green-500 outline-none font-medium",children:j.map(v=>r.jsx("option",{value:v,children:v},v))})]})}),r.jsxs("div",{className:"flex items-center gap-4 ml-6",children:[h(u,Pt,"WebSocket"),h(f,qs,"MQTT"),h(y,zs,"System")]}),r.jsx("div",{className:"flex items-center gap-4 ml-8",children:r.jsx(Zs,{selectedDevice:C})})]})})},Zs=({selectedDevice:t})=>{const{notifications:e,markRead:s,clearAll:n}=Qe(),[o,i]=oe.useState(!1),a=w.useRef();oe.useEffect(()=>{const u=f=>{a.current&&(a.current.contains(f.target)||i(!1))};return document.addEventListener("click",u),()=>document.removeEventListener("click",u)},[]);const l=e.filter(u=>{const f=u.meta&&u.meta.deviceId?u.meta.deviceId:null;return f===null||f===t}),d=l.filter(u=>!u.read).length,c=u=>u==="critical"?r.jsx(Is,{className:"w-4 h-4 text-red-600"}):u&&u.startsWith("pump")?r.jsx(Ft,{className:"w-4 h-4 text-blue-600"}):r.jsx(ut,{className:"w-4 h-4 text-gray-600"});return r.jsxs("div",{className:"relative",ref:a,children:[r.jsxs("button",{onClick:()=>i(u=>!u),className:"relative group",title:"View Alerts","aria-haspopup":"true",children:[r.jsx(ut,{className:"w-6 h-6 text-gray-500 hover:text-yellow-500 transition"}),d>0&&r.jsx("span",{className:"absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full",children:d})]}),o&&r.jsxs("div",{className:"absolute right-0 mt-2 w-80 max-h-96 overflow-auto bg-white border rounded shadow-lg z-50",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[r.jsx("div",{className:"font-semibold",children:"Notifications"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:()=>{n(t)},className:"text-xs text-gray-500 hover:underline",children:"Clear"})})]}),r.jsxs("ul",{className:"divide-y",children:[l.length===0&&r.jsx("li",{className:"p-3 text-sm text-gray-500",children:"No notifications"}),l.map(u=>r.jsx("li",{className:`p-3 text-sm ${u.read?"bg-white":"bg-gray-50"}`,children:r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:c(u.type)}),r.jsxs("div",{className:"truncate",children:[r.jsx("div",{className:`font-medium ${u.type==="critical"?"text-red-700":"text-gray-800"}`,children:u.message}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(u.timestamp).toLocaleString()})]}),r.jsx("div",{className:"ml-2",children:!u.read&&r.jsx("button",{onClick:()=>s(u.id),className:"text-xs text-blue-600",children:"Mark"})})]})},u.id))]})]})]})};function Ht(t,e){return function(){return t.apply(e,arguments)}}const{toString:Ys}=Object.prototype,{getPrototypeOf:et}=Object,{iterator:Fe,toStringTag:Wt}=Symbol,_e=(t=>e=>{const s=Ys.call(e);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),ne=t=>(t=t.toLowerCase(),e=>_e(e)===t),Pe=t=>e=>typeof e===t,{isArray:ge}=Array,pe=Pe("undefined");function je(t){return t!==null&&!pe(t)&&t.constructor!==null&&!pe(t.constructor)&&Q(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const qt=ne("ArrayBuffer");function Qs(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&qt(t.buffer),e}const en=Pe("string"),Q=Pe("function"),zt=Pe("number"),ke=t=>t!==null&&typeof t=="object",tn=t=>t===!0||t===!1,Re=t=>{if(_e(t)!=="object")return!1;const e=et(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Wt in t)&&!(Fe in t)},sn=t=>{if(!ke(t)||je(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},nn=ne("Date"),rn=ne("File"),on=ne("Blob"),an=ne("FileList"),ln=t=>ke(t)&&Q(t.pipe),cn=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Q(t.append)&&((e=_e(t))==="formdata"||e==="object"&&Q(t.toString)&&t.toString()==="[object FormData]"))},un=ne("URLSearchParams"),[dn,mn,fn,hn]=["ReadableStream","Request","Response","Headers"].map(ne),pn=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ce(t,e,{allOwnKeys:s=!1}={}){if(t===null||typeof t>"u")return;let n,o;if(typeof t!="object"&&(t=[t]),ge(t))for(n=0,o=t.length;n<o;n++)e.call(null,t[n],n,t);else{if(je(t))return;const i=s?Object.getOwnPropertyNames(t):Object.keys(t),a=i.length;let l;for(n=0;n<a;n++)l=i[n],e.call(null,t[l],l,t)}}function Jt(t,e){if(je(t))return null;e=e.toLowerCase();const s=Object.keys(t);let n=s.length,o;for(;n-- >0;)if(o=s[n],e===o.toLowerCase())return o;return null}const ue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Vt=t=>!pe(t)&&t!==ue;function Xe(){const{caseless:t,skipUndefined:e}=Vt(this)&&this||{},s={},n=(o,i)=>{const a=t&&Jt(s,i)||i;Re(s[a])&&Re(o)?s[a]=Xe(s[a],o):Re(o)?s[a]=Xe({},o):ge(o)?s[a]=o.slice():(!e||!pe(o))&&(s[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&Ce(arguments[o],n);return s}const gn=(t,e,s,{allOwnKeys:n}={})=>(Ce(e,(o,i)=>{s&&Q(o)?t[i]=Ht(o,s):t[i]=o},{allOwnKeys:n}),t),xn=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),yn=(t,e,s,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),s&&Object.assign(t.prototype,s)},bn=(t,e,s,n)=>{let o,i,a;const l={};if(e=e||{},t==null)return e;do{for(o=Object.getOwnPropertyNames(t),i=o.length;i-- >0;)a=o[i],(!n||n(a,t,e))&&!l[a]&&(e[a]=t[a],l[a]=!0);t=s!==!1&&et(t)}while(t&&(!s||s(t,e))&&t!==Object.prototype);return e},wn=(t,e,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=e.length;const n=t.indexOf(e,s);return n!==-1&&n===s},vn=t=>{if(!t)return null;if(ge(t))return t;let e=t.length;if(!zt(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=t[e];return s},Nn=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&et(Uint8Array)),Sn=(t,e)=>{const n=(t&&t[Fe]).call(t);let o;for(;(o=n.next())&&!o.done;){const i=o.value;e.call(t,i[0],i[1])}},jn=(t,e)=>{let s;const n=[];for(;(s=t.exec(e))!==null;)n.push(s);return n},kn=ne("HTMLFormElement"),Cn=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,n,o){return n.toUpperCase()+o}),xt=(({hasOwnProperty:t})=>(e,s)=>t.call(e,s))(Object.prototype),Tn=ne("RegExp"),Kt=(t,e)=>{const s=Object.getOwnPropertyDescriptors(t),n={};Ce(s,(o,i)=>{let a;(a=e(o,i,t))!==!1&&(n[i]=a||o)}),Object.defineProperties(t,n)},En=t=>{Kt(t,(e,s)=>{if(Q(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const n=t[s];if(Q(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Mn=(t,e)=>{const s={},n=o=>{o.forEach(i=>{s[i]=!0})};return ge(t)?n(t):n(String(t).split(e)),s},An=()=>{},On=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Rn(t){return!!(t&&Q(t.append)&&t[Wt]==="FormData"&&t[Fe])}const Dn=t=>{const e=new Array(10),s=(n,o)=>{if(ke(n)){if(e.indexOf(n)>=0)return;if(je(n))return n;if(!("toJSON"in n)){e[o]=n;const i=ge(n)?[]:{};return Ce(n,(a,l)=>{const d=s(a,o+1);!pe(d)&&(i[l]=d)}),e[o]=void 0,i}}return n};return s(t,0)},$n=ne("AsyncFunction"),In=t=>t&&(ke(t)||Q(t))&&Q(t.then)&&Q(t.catch),Xt=((t,e)=>t?setImmediate:e?((s,n)=>(ue.addEventListener("message",({source:o,data:i})=>{o===ue&&i===s&&n.length&&n.shift()()},!1),o=>{n.push(o),ue.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",Q(ue.postMessage)),Ln=typeof queueMicrotask<"u"?queueMicrotask.bind(ue):typeof process<"u"&&process.nextTick||Xt,Fn=t=>t!=null&&Q(t[Fe]),m={isArray:ge,isArrayBuffer:qt,isBuffer:je,isFormData:cn,isArrayBufferView:Qs,isString:en,isNumber:zt,isBoolean:tn,isObject:ke,isPlainObject:Re,isEmptyObject:sn,isReadableStream:dn,isRequest:mn,isResponse:fn,isHeaders:hn,isUndefined:pe,isDate:nn,isFile:rn,isBlob:on,isRegExp:Tn,isFunction:Q,isStream:ln,isURLSearchParams:un,isTypedArray:Nn,isFileList:an,forEach:Ce,merge:Xe,extend:gn,trim:pn,stripBOM:xn,inherits:yn,toFlatObject:bn,kindOf:_e,kindOfTest:ne,endsWith:wn,toArray:vn,forEachEntry:Sn,matchAll:jn,isHTMLForm:kn,hasOwnProperty:xt,hasOwnProp:xt,reduceDescriptors:Kt,freezeMethods:En,toObjectSet:Mn,toCamelCase:Cn,noop:An,toFiniteNumber:On,findKey:Jt,global:ue,isContextDefined:Vt,isSpecCompliantForm:Rn,toJSONObject:Dn,isAsyncFn:$n,isThenable:In,setImmediate:Xt,asap:Ln,isIterable:Fn};function D(t,e,s,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}m.inherits(D,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});const Gt=D.prototype,Zt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Zt[t]={value:t}});Object.defineProperties(D,Zt);Object.defineProperty(Gt,"isAxiosError",{value:!0});D.from=(t,e,s,n,o,i)=>{const a=Object.create(Gt);m.toFlatObject(t,a,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const l=t&&t.message?t.message:"Error",d=e==null&&t?t.code:e;return D.call(a,l,d,s,n,o),t&&a.cause==null&&Object.defineProperty(a,"cause",{value:t,configurable:!0}),a.name=t&&t.name||"Error",i&&Object.assign(a,i),a};const _n=null;function Ge(t){return m.isPlainObject(t)||m.isArray(t)}function Yt(t){return m.endsWith(t,"[]")?t.slice(0,-2):t}function yt(t,e,s){return t?t.concat(e).map(function(o,i){return o=Yt(o),!s&&i?"["+o+"]":o}).join(s?".":""):e}function Pn(t){return m.isArray(t)&&!t.some(Ge)}const Un=m.toFlatObject(m,{},null,function(e){return/^is[A-Z]/.test(e)});function Ue(t,e,s){if(!m.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,s=m.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,p){return!m.isUndefined(p[g])});const n=s.metaTokens,o=s.visitor||u,i=s.dots,a=s.indexes,d=(s.Blob||typeof Blob<"u"&&Blob)&&m.isSpecCompliantForm(e);if(!m.isFunction(o))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(m.isDate(h))return h.toISOString();if(m.isBoolean(h))return h.toString();if(!d&&m.isBlob(h))throw new D("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(h)||m.isTypedArray(h)?d&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function u(h,g,p){let j=h;if(h&&!p&&typeof h=="object"){if(m.endsWith(g,"{}"))g=n?g:g.slice(0,-2),h=JSON.stringify(h);else if(m.isArray(h)&&Pn(h)||(m.isFileList(h)||m.endsWith(g,"[]"))&&(j=m.toArray(h)))return g=Yt(g),j.forEach(function(N,v){!(m.isUndefined(N)||N===null)&&e.append(a===!0?yt([g],v,i):a===null?g:g+"[]",c(N))}),!1}return Ge(h)?!0:(e.append(yt(p,g,i),c(h)),!1)}const f=[],y=Object.assign(Un,{defaultVisitor:u,convertValue:c,isVisitable:Ge});function O(h,g){if(!m.isUndefined(h)){if(f.indexOf(h)!==-1)throw Error("Circular reference detected in "+g.join("."));f.push(h),m.forEach(h,function(j,C){(!(m.isUndefined(j)||j===null)&&o.call(e,j,m.isString(C)?C.trim():C,g,y))===!0&&O(j,g?g.concat(C):[C])}),f.pop()}}if(!m.isObject(t))throw new TypeError("data must be an object");return O(t),e}function bt(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function tt(t,e){this._pairs=[],t&&Ue(t,this,e)}const Qt=tt.prototype;Qt.append=function(e,s){this._pairs.push([e,s])};Qt.toString=function(e){const s=e?function(n){return e.call(this,n,bt)}:bt;return this._pairs.map(function(o){return s(o[0])+"="+s(o[1])},"").join("&")};function Bn(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function es(t,e,s){if(!e)return t;const n=s&&s.encode||Bn;m.isFunction(s)&&(s={serialize:s});const o=s&&s.serialize;let i;if(o?i=o(e,s):i=m.isURLSearchParams(e)?e.toString():new tt(e,s).toString(n),i){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class wt{constructor(){this.handlers=[]}use(e,s,n){return this.handlers.push({fulfilled:e,rejected:s,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){m.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ts={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Hn=typeof URLSearchParams<"u"?URLSearchParams:tt,Wn=typeof FormData<"u"?FormData:null,qn=typeof Blob<"u"?Blob:null,zn={isBrowser:!0,classes:{URLSearchParams:Hn,FormData:Wn,Blob:qn},protocols:["http","https","file","blob","url","data"]},st=typeof window<"u"&&typeof document<"u",Ze=typeof navigator=="object"&&navigator||void 0,Jn=st&&(!Ze||["ReactNative","NativeScript","NS"].indexOf(Ze.product)<0),Vn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Kn=st&&window.location.href||"http://localhost",Xn=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:st,hasStandardBrowserEnv:Jn,hasStandardBrowserWebWorkerEnv:Vn,navigator:Ze,origin:Kn},Symbol.toStringTag,{value:"Module"})),X={...Xn,...zn};function Gn(t,e){return Ue(t,new X.classes.URLSearchParams,{visitor:function(s,n,o,i){return X.isNode&&m.isBuffer(s)?(this.append(n,s.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function Zn(t){return m.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Yn(t){const e={},s=Object.keys(t);let n;const o=s.length;let i;for(n=0;n<o;n++)i=s[n],e[i]=t[i];return e}function ss(t){function e(s,n,o,i){let a=s[i++];if(a==="__proto__")return!0;const l=Number.isFinite(+a),d=i>=s.length;return a=!a&&m.isArray(o)?o.length:a,d?(m.hasOwnProp(o,a)?o[a]=[o[a],n]:o[a]=n,!l):((!o[a]||!m.isObject(o[a]))&&(o[a]=[]),e(s,n,o[a],i)&&m.isArray(o[a])&&(o[a]=Yn(o[a])),!l)}if(m.isFormData(t)&&m.isFunction(t.entries)){const s={};return m.forEachEntry(t,(n,o)=>{e(Zn(n),o,s,0)}),s}return null}function Qn(t,e,s){if(m.isString(t))try{return(e||JSON.parse)(t),m.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(s||JSON.stringify)(t)}const Te={transitional:ts,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const n=s.getContentType()||"",o=n.indexOf("application/json")>-1,i=m.isObject(e);if(i&&m.isHTMLForm(e)&&(e=new FormData(e)),m.isFormData(e))return o?JSON.stringify(ss(e)):e;if(m.isArrayBuffer(e)||m.isBuffer(e)||m.isStream(e)||m.isFile(e)||m.isBlob(e)||m.isReadableStream(e))return e;if(m.isArrayBufferView(e))return e.buffer;if(m.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Gn(e,this.formSerializer).toString();if((l=m.isFileList(e))||n.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Ue(l?{"files[]":e}:e,d&&new d,this.formSerializer)}}return i||o?(s.setContentType("application/json",!1),Qn(e)):e}],transformResponse:[function(e){const s=this.transitional||Te.transitional,n=s&&s.forcedJSONParsing,o=this.responseType==="json";if(m.isResponse(e)||m.isReadableStream(e))return e;if(e&&m.isString(e)&&(n&&!this.responseType||o)){const a=!(s&&s.silentJSONParsing)&&o;try{return JSON.parse(e,this.parseReviver)}catch(l){if(a)throw l.name==="SyntaxError"?D.from(l,D.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:X.classes.FormData,Blob:X.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],t=>{Te.headers[t]={}});const er=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tr=t=>{const e={};let s,n,o;return t&&t.split(`
`).forEach(function(a){o=a.indexOf(":"),s=a.substring(0,o).trim().toLowerCase(),n=a.substring(o+1).trim(),!(!s||e[s]&&er[s])&&(s==="set-cookie"?e[s]?e[s].push(n):e[s]=[n]:e[s]=e[s]?e[s]+", "+n:n)}),e},vt=Symbol("internals");function we(t){return t&&String(t).trim().toLowerCase()}function De(t){return t===!1||t==null?t:m.isArray(t)?t.map(De):String(t)}function sr(t){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(t);)e[n[1]]=n[2];return e}const nr=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ze(t,e,s,n,o){if(m.isFunction(n))return n.call(this,e,s);if(o&&(e=s),!!m.isString(e)){if(m.isString(n))return e.indexOf(n)!==-1;if(m.isRegExp(n))return n.test(e)}}function rr(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,n)=>s.toUpperCase()+n)}function or(t,e){const s=m.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+s,{value:function(o,i,a){return this[n].call(this,e,o,i,a)},configurable:!0})})}let ee=class{constructor(e){e&&this.set(e)}set(e,s,n){const o=this;function i(l,d,c){const u=we(d);if(!u)throw new Error("header name must be a non-empty string");const f=m.findKey(o,u);(!f||o[f]===void 0||c===!0||c===void 0&&o[f]!==!1)&&(o[f||d]=De(l))}const a=(l,d)=>m.forEach(l,(c,u)=>i(c,u,d));if(m.isPlainObject(e)||e instanceof this.constructor)a(e,s);else if(m.isString(e)&&(e=e.trim())&&!nr(e))a(tr(e),s);else if(m.isObject(e)&&m.isIterable(e)){let l={},d,c;for(const u of e){if(!m.isArray(u))throw TypeError("Object iterator must return a key-value pair");l[c=u[0]]=(d=l[c])?m.isArray(d)?[...d,u[1]]:[d,u[1]]:u[1]}a(l,s)}else e!=null&&i(s,e,n);return this}get(e,s){if(e=we(e),e){const n=m.findKey(this,e);if(n){const o=this[n];if(!s)return o;if(s===!0)return sr(o);if(m.isFunction(s))return s.call(this,o,n);if(m.isRegExp(s))return s.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=we(e),e){const n=m.findKey(this,e);return!!(n&&this[n]!==void 0&&(!s||ze(this,this[n],n,s)))}return!1}delete(e,s){const n=this;let o=!1;function i(a){if(a=we(a),a){const l=m.findKey(n,a);l&&(!s||ze(n,n[l],l,s))&&(delete n[l],o=!0)}}return m.isArray(e)?e.forEach(i):i(e),o}clear(e){const s=Object.keys(this);let n=s.length,o=!1;for(;n--;){const i=s[n];(!e||ze(this,this[i],i,e,!0))&&(delete this[i],o=!0)}return o}normalize(e){const s=this,n={};return m.forEach(this,(o,i)=>{const a=m.findKey(n,i);if(a){s[a]=De(o),delete s[i];return}const l=e?rr(i):String(i).trim();l!==i&&delete s[i],s[l]=De(o),n[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return m.forEach(this,(n,o)=>{n!=null&&n!==!1&&(s[o]=e&&m.isArray(n)?n.join(", "):n)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const n=new this(e);return s.forEach(o=>n.set(o)),n}static accessor(e){const n=(this[vt]=this[vt]={accessors:{}}).accessors,o=this.prototype;function i(a){const l=we(a);n[l]||(or(o,a),n[l]=!0)}return m.isArray(e)?e.forEach(i):i(e),this}};ee.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(ee.prototype,({value:t},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[s]=n}}});m.freezeMethods(ee);function Je(t,e){const s=this||Te,n=e||s,o=ee.from(n.headers);let i=n.data;return m.forEach(t,function(l){i=l.call(s,i,o.normalize(),e?e.status:void 0)}),o.normalize(),i}function ns(t){return!!(t&&t.__CANCEL__)}function xe(t,e,s){D.call(this,t??"canceled",D.ERR_CANCELED,e,s),this.name="CanceledError"}m.inherits(xe,D,{__CANCEL__:!0});function rs(t,e,s){const n=s.config.validateStatus;!s.status||!n||n(s.status)?t(s):e(new D("Request failed with status code "+s.status,[D.ERR_BAD_REQUEST,D.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function ar(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function ir(t,e){t=t||10;const s=new Array(t),n=new Array(t);let o=0,i=0,a;return e=e!==void 0?e:1e3,function(d){const c=Date.now(),u=n[i];a||(a=c),s[o]=d,n[o]=c;let f=i,y=0;for(;f!==o;)y+=s[f++],f=f%t;if(o=(o+1)%t,o===i&&(i=(i+1)%t),c-a<e)return;const O=u&&c-u;return O?Math.round(y*1e3/O):void 0}}function lr(t,e){let s=0,n=1e3/e,o,i;const a=(c,u=Date.now())=>{s=u,o=null,i&&(clearTimeout(i),i=null),t(...c)};return[(...c)=>{const u=Date.now(),f=u-s;f>=n?a(c,u):(o=c,i||(i=setTimeout(()=>{i=null,a(o)},n-f)))},()=>o&&a(o)]}const Ie=(t,e,s=3)=>{let n=0;const o=ir(50,250);return lr(i=>{const a=i.loaded,l=i.lengthComputable?i.total:void 0,d=a-n,c=o(d),u=a<=l;n=a;const f={loaded:a,total:l,progress:l?a/l:void 0,bytes:d,rate:c||void 0,estimated:c&&l&&u?(l-a)/c:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(f)},s)},Nt=(t,e)=>{const s=t!=null;return[n=>e[0]({lengthComputable:s,total:t,loaded:n}),e[1]]},St=t=>(...e)=>m.asap(()=>t(...e)),cr=X.hasStandardBrowserEnv?((t,e)=>s=>(s=new URL(s,X.origin),t.protocol===s.protocol&&t.host===s.host&&(e||t.port===s.port)))(new URL(X.origin),X.navigator&&/(msie|trident)/i.test(X.navigator.userAgent)):()=>!0,ur=X.hasStandardBrowserEnv?{write(t,e,s,n,o,i,a){if(typeof document>"u")return;const l=[`${t}=${encodeURIComponent(e)}`];m.isNumber(s)&&l.push(`expires=${new Date(s).toUTCString()}`),m.isString(n)&&l.push(`path=${n}`),m.isString(o)&&l.push(`domain=${o}`),i===!0&&l.push("secure"),m.isString(a)&&l.push(`SameSite=${a}`),document.cookie=l.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function dr(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function mr(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function os(t,e,s){let n=!dr(e);return t&&(n||s==!1)?mr(t,e):e}const jt=t=>t instanceof ee?{...t}:t;function me(t,e){e=e||{};const s={};function n(c,u,f,y){return m.isPlainObject(c)&&m.isPlainObject(u)?m.merge.call({caseless:y},c,u):m.isPlainObject(u)?m.merge({},u):m.isArray(u)?u.slice():u}function o(c,u,f,y){if(m.isUndefined(u)){if(!m.isUndefined(c))return n(void 0,c,f,y)}else return n(c,u,f,y)}function i(c,u){if(!m.isUndefined(u))return n(void 0,u)}function a(c,u){if(m.isUndefined(u)){if(!m.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function l(c,u,f){if(f in e)return n(c,u);if(f in t)return n(void 0,c)}const d={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(c,u,f)=>o(jt(c),jt(u),f,!0)};return m.forEach(Object.keys({...t,...e}),function(u){const f=d[u]||o,y=f(t[u],e[u],u);m.isUndefined(y)&&f!==l||(s[u]=y)}),s}const as=t=>{const e=me({},t);let{data:s,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:l}=e;if(e.headers=a=ee.from(a),e.url=es(os(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),m.isFormData(s)){if(X.hasStandardBrowserEnv||X.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(m.isFunction(s.getHeaders)){const d=s.getHeaders(),c=["content-type","content-length"];Object.entries(d).forEach(([u,f])=>{c.includes(u.toLowerCase())&&a.set(u,f)})}}if(X.hasStandardBrowserEnv&&(n&&m.isFunction(n)&&(n=n(e)),n||n!==!1&&cr(e.url))){const d=o&&i&&ur.read(i);d&&a.set(o,d)}return e},fr=typeof XMLHttpRequest<"u",hr=fr&&function(t){return new Promise(function(s,n){const o=as(t);let i=o.data;const a=ee.from(o.headers).normalize();let{responseType:l,onUploadProgress:d,onDownloadProgress:c}=o,u,f,y,O,h;function g(){O&&O(),h&&h(),o.cancelToken&&o.cancelToken.unsubscribe(u),o.signal&&o.signal.removeEventListener("abort",u)}let p=new XMLHttpRequest;p.open(o.method.toUpperCase(),o.url,!0),p.timeout=o.timeout;function j(){if(!p)return;const N=ee.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),T={data:!l||l==="text"||l==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:N,config:t,request:p};rs(function(_){s(_),g()},function(_){n(_),g()},T),p=null}"onloadend"in p?p.onloadend=j:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(j)},p.onabort=function(){p&&(n(new D("Request aborted",D.ECONNABORTED,t,p)),p=null)},p.onerror=function(v){const T=v&&v.message?v.message:"Network Error",M=new D(T,D.ERR_NETWORK,t,p);M.event=v||null,n(M),p=null},p.ontimeout=function(){let v=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const T=o.transitional||ts;o.timeoutErrorMessage&&(v=o.timeoutErrorMessage),n(new D(v,T.clarifyTimeoutError?D.ETIMEDOUT:D.ECONNABORTED,t,p)),p=null},i===void 0&&a.setContentType(null),"setRequestHeader"in p&&m.forEach(a.toJSON(),function(v,T){p.setRequestHeader(T,v)}),m.isUndefined(o.withCredentials)||(p.withCredentials=!!o.withCredentials),l&&l!=="json"&&(p.responseType=o.responseType),c&&([y,h]=Ie(c,!0),p.addEventListener("progress",y)),d&&p.upload&&([f,O]=Ie(d),p.upload.addEventListener("progress",f),p.upload.addEventListener("loadend",O)),(o.cancelToken||o.signal)&&(u=N=>{p&&(n(!N||N.type?new xe(null,t,p):N),p.abort(),p=null)},o.cancelToken&&o.cancelToken.subscribe(u),o.signal&&(o.signal.aborted?u():o.signal.addEventListener("abort",u)));const C=ar(o.url);if(C&&X.protocols.indexOf(C)===-1){n(new D("Unsupported protocol "+C+":",D.ERR_BAD_REQUEST,t));return}p.send(i||null)})},pr=(t,e)=>{const{length:s}=t=t?t.filter(Boolean):[];if(e||s){let n=new AbortController,o;const i=function(c){if(!o){o=!0,l();const u=c instanceof Error?c:this.reason;n.abort(u instanceof D?u:new xe(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{a=null,i(new D(`timeout ${e} of ms exceeded`,D.ETIMEDOUT))},e);const l=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),t=null)};t.forEach(c=>c.addEventListener("abort",i));const{signal:d}=n;return d.unsubscribe=()=>m.asap(l),d}},gr=function*(t,e){let s=t.byteLength;if(s<e){yield t;return}let n=0,o;for(;n<s;)o=n+e,yield t.slice(n,o),n=o},xr=async function*(t,e){for await(const s of yr(t))yield*gr(s,e)},yr=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:s,value:n}=await e.read();if(s)break;yield n}}finally{await e.cancel()}},kt=(t,e,s,n)=>{const o=xr(t,e);let i=0,a,l=d=>{a||(a=!0,n&&n(d))};return new ReadableStream({async pull(d){try{const{done:c,value:u}=await o.next();if(c){l(),d.close();return}let f=u.byteLength;if(s){let y=i+=f;s(y)}d.enqueue(new Uint8Array(u))}catch(c){throw l(c),c}},cancel(d){return l(d),o.return()}},{highWaterMark:2})},Ct=64*1024,{isFunction:Ae}=m,br=(({Request:t,Response:e})=>({Request:t,Response:e}))(m.global),{ReadableStream:Tt,TextEncoder:Et}=m.global,Mt=(t,...e)=>{try{return!!t(...e)}catch{return!1}},wr=t=>{t=m.merge.call({skipUndefined:!0},br,t);const{fetch:e,Request:s,Response:n}=t,o=e?Ae(e):typeof fetch=="function",i=Ae(s),a=Ae(n);if(!o)return!1;const l=o&&Ae(Tt),d=o&&(typeof Et=="function"?(h=>g=>h.encode(g))(new Et):async h=>new Uint8Array(await new s(h).arrayBuffer())),c=i&&l&&Mt(()=>{let h=!1;const g=new s(X.origin,{body:new Tt,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!g}),u=a&&l&&Mt(()=>m.isReadableStream(new n("").body)),f={stream:u&&(h=>h.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!f[h]&&(f[h]=(g,p)=>{let j=g&&g[h];if(j)return j.call(g);throw new D(`Response type '${h}' is not supported`,D.ERR_NOT_SUPPORT,p)})});const y=async h=>{if(h==null)return 0;if(m.isBlob(h))return h.size;if(m.isSpecCompliantForm(h))return(await new s(X.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(m.isArrayBufferView(h)||m.isArrayBuffer(h))return h.byteLength;if(m.isURLSearchParams(h)&&(h=h+""),m.isString(h))return(await d(h)).byteLength},O=async(h,g)=>{const p=m.toFiniteNumber(h.getContentLength());return p??y(g)};return async h=>{let{url:g,method:p,data:j,signal:C,cancelToken:N,timeout:v,onDownloadProgress:T,onUploadProgress:M,responseType:_,headers:q,withCredentials:J="same-origin",fetchOptions:V}=as(h),x=e||fetch;_=_?(_+"").toLowerCase():"text";let b=pr([C,N&&N.toAbortSignal()],v),S=null;const k=b&&b.unsubscribe&&(()=>{b.unsubscribe()});let W;try{if(M&&c&&p!=="get"&&p!=="head"&&(W=await O(q,j))!==0){let R=new s(g,{method:"POST",body:j,duplex:"half"}),P;if(m.isFormData(j)&&(P=R.headers.get("content-type"))&&q.setContentType(P),R.body){const[F,A]=Nt(W,Ie(St(M)));j=kt(R.body,Ct,F,A)}}m.isString(J)||(J=J?"include":"omit");const U=i&&"credentials"in s.prototype,le={...V,signal:b,method:p.toUpperCase(),headers:q.normalize().toJSON(),body:j,duplex:"half",credentials:U?J:void 0};S=i&&new s(g,le);let G=await(i?x(S,V):x(g,le));const ae=u&&(_==="stream"||_==="response");if(u&&(T||ae&&k)){const R={};["status","statusText","headers"].forEach(I=>{R[I]=G[I]});const P=m.toFiniteNumber(G.headers.get("content-length")),[F,A]=T&&Nt(P,Ie(St(T),!0))||[];G=new n(kt(G.body,Ct,F,()=>{A&&A(),k&&k()}),R)}_=_||"text";let $=await f[m.findKey(f,_)||"text"](G,h);return!ae&&k&&k(),await new Promise((R,P)=>{rs(R,P,{data:$,headers:ee.from(G.headers),status:G.status,statusText:G.statusText,config:h,request:S})})}catch(U){throw k&&k(),U&&U.name==="TypeError"&&/Load failed|fetch/i.test(U.message)?Object.assign(new D("Network Error",D.ERR_NETWORK,h,S),{cause:U.cause||U}):D.from(U,U&&U.code,h,S)}}},vr=new Map,is=t=>{let e=t&&t.env||{};const{fetch:s,Request:n,Response:o}=e,i=[n,o,s];let a=i.length,l=a,d,c,u=vr;for(;l--;)d=i[l],c=u.get(d),c===void 0&&u.set(d,c=l?new Map:wr(e)),u=c;return c};is();const nt={http:_n,xhr:hr,fetch:{get:is}};m.forEach(nt,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const At=t=>`- ${t}`,Nr=t=>m.isFunction(t)||t===null||t===!1;function Sr(t,e){t=m.isArray(t)?t:[t];const{length:s}=t;let n,o;const i={};for(let a=0;a<s;a++){n=t[a];let l;if(o=n,!Nr(n)&&(o=nt[(l=String(n)).toLowerCase()],o===void 0))throw new D(`Unknown adapter '${l}'`);if(o&&(m.isFunction(o)||(o=o.get(e))))break;i[l||"#"+a]=o}if(!o){const a=Object.entries(i).map(([d,c])=>`adapter ${d} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=s?a.length>1?`since :
`+a.map(At).join(`
`):" "+At(a[0]):"as no adapter specified";throw new D("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return o}const ls={getAdapter:Sr,adapters:nt};function Ve(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new xe(null,t)}function Ot(t){return Ve(t),t.headers=ee.from(t.headers),t.data=Je.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),ls.getAdapter(t.adapter||Te.adapter,t)(t).then(function(n){return Ve(t),n.data=Je.call(t,t.transformResponse,n),n.headers=ee.from(n.headers),n},function(n){return ns(n)||(Ve(t),n&&n.response&&(n.response.data=Je.call(t,t.transformResponse,n.response),n.response.headers=ee.from(n.response.headers))),Promise.reject(n)})}const cs="1.13.2",Be={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Be[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Rt={};Be.transitional=function(e,s,n){function o(i,a){return"[Axios v"+cs+"] Transitional option '"+i+"'"+a+(n?". "+n:"")}return(i,a,l)=>{if(e===!1)throw new D(o(a," has been removed"+(s?" in "+s:"")),D.ERR_DEPRECATED);return s&&!Rt[a]&&(Rt[a]=!0,console.warn(o(a," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(i,a,l):!0}};Be.spelling=function(e){return(s,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function jr(t,e,s){if(typeof t!="object")throw new D("options must be an object",D.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let o=n.length;for(;o-- >0;){const i=n[o],a=e[i];if(a){const l=t[i],d=l===void 0||a(l,i,t);if(d!==!0)throw new D("option "+i+" must be "+d,D.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new D("Unknown option "+i,D.ERR_BAD_OPTION)}}const $e={assertOptions:jr,validators:Be},re=$e.validators;let de=class{constructor(e){this.defaults=e||{},this.interceptors={request:new wt,response:new wt}}async request(e,s){try{return await this._request(e,s)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=me(this.defaults,s);const{transitional:n,paramsSerializer:o,headers:i}=s;n!==void 0&&$e.assertOptions(n,{silentJSONParsing:re.transitional(re.boolean),forcedJSONParsing:re.transitional(re.boolean),clarifyTimeoutError:re.transitional(re.boolean)},!1),o!=null&&(m.isFunction(o)?s.paramsSerializer={serialize:o}:$e.assertOptions(o,{encode:re.function,serialize:re.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),$e.assertOptions(s,{baseUrl:re.spelling("baseURL"),withXsrfToken:re.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let a=i&&m.merge(i.common,i[s.method]);i&&m.forEach(["delete","get","head","post","put","patch","common"],h=>{delete i[h]}),s.headers=ee.concat(a,i);const l=[];let d=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(s)===!1||(d=d&&g.synchronous,l.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let u,f=0,y;if(!d){const h=[Ot.bind(this),void 0];for(h.unshift(...l),h.push(...c),y=h.length,u=Promise.resolve(s);f<y;)u=u.then(h[f++],h[f++]);return u}y=l.length;let O=s;for(;f<y;){const h=l[f++],g=l[f++];try{O=h(O)}catch(p){g.call(this,p);break}}try{u=Ot.call(this,O)}catch(h){return Promise.reject(h)}for(f=0,y=c.length;f<y;)u=u.then(c[f++],c[f++]);return u}getUri(e){e=me(this.defaults,e);const s=os(e.baseURL,e.url,e.allowAbsoluteUrls);return es(s,e.params,e.paramsSerializer)}};m.forEach(["delete","get","head","options"],function(e){de.prototype[e]=function(s,n){return this.request(me(n||{},{method:e,url:s,data:(n||{}).data}))}});m.forEach(["post","put","patch"],function(e){function s(n){return function(i,a,l){return this.request(me(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}de.prototype[e]=s(),de.prototype[e+"Form"]=s(!0)});let kr=class us{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(i){s=i});const n=this;this.promise.then(o=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](o);n._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(l=>{n.subscribe(l),i=l}).then(o);return a.cancel=function(){n.unsubscribe(i)},a},e(function(i,a,l){n.reason||(n.reason=new xe(i,a,l),s(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=n=>{e.abort(n)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new us(function(o){e=o}),cancel:e}}};function Cr(t){return function(s){return t.apply(null,s)}}function Tr(t){return m.isObject(t)&&t.isAxiosError===!0}const Ye={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Ye).forEach(([t,e])=>{Ye[e]=t});function ds(t){const e=new de(t),s=Ht(de.prototype.request,e);return m.extend(s,de.prototype,e,{allOwnKeys:!0}),m.extend(s,e,null,{allOwnKeys:!0}),s.create=function(o){return ds(me(t,o))},s}const H=ds(Te);H.Axios=de;H.CanceledError=xe;H.CancelToken=kr;H.isCancel=ns;H.VERSION=cs;H.toFormData=Ue;H.AxiosError=D;H.Cancel=H.CanceledError;H.all=function(e){return Promise.all(e)};H.spread=Cr;H.isAxiosError=Tr;H.mergeConfig=me;H.AxiosHeaders=ee;H.formToJSON=t=>ss(m.isHTMLForm(t)?new FormData(t):t);H.getAdapter=ls.getAdapter;H.HttpStatusCode=Ye;H.default=H;const{Axios:Yr,AxiosError:Qr,CanceledError:eo,isCancel:to,CancelToken:so,VERSION:no,all:ro,Cancel:oo,isAxiosError:ao,spread:io,toFormData:lo,AxiosHeaders:co,HttpStatusCode:uo,formToJSON:mo,getAdapter:fo,mergeConfig:ho}=H,Er=()=>"https://api.protonestconnect.co/api/v1/user",rt=Er();console.log("ðŸ”§ API Base URL:",rt);const Se=H.create({baseURL:rt,headers:{"Content-Type":"application/json"},timeout:15e3});Se.interceptors.request.use(t=>{const e=localStorage.getItem("jwtToken");return e&&e!=="MOCK_TOKEN_FOR_TESTING"&&(t.headers["X-Token"]=e),console.log("ðŸ“¤ API Request:",{method:t.method?.toUpperCase(),url:t.url,baseURL:t.baseURL,hasToken:!!e&&e!=="MOCK_TOKEN_FOR_TESTING",payload:t.data||void 0}),t},t=>(console.error("âŒ Request interceptor error:",t),Promise.reject(t)));Se.interceptors.response.use(t=>(console.log("ðŸ“¥ API Response:",{status:t.status,url:t.config.url,method:t.config.method?.toUpperCase()}),t),async t=>{const e=t.config;if(t.response){const s=t.response.status===400,n=t.response.data?.data||t.response.data?.message;if((!s||!window.__api400ErrorLogged&&n!=="Device does not belong to the user")&&(console.error("âŒ API Error Response:",{status:t.response.status,statusText:t.response.statusText,url:e?.url,method:e?.method?.toUpperCase(),data:t.response.data,allowHeader:t.response.headers?.allow}),s&&(window.__api400ErrorLogged=!0)),t.response.status===400){const o=t.response.data?.data||t.response.data?.message;if(o==="Device does not belong to the user")return window.__deviceAuthErrorShown||(console.error(`
ðŸš« DEVICE AUTHORIZATION ERROR`),console.error("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"),console.error("âŒ Device does not belong to your account"),console.error(`
ðŸ’¡ TO FIX THIS:`),console.error("   1. Go to: https://api.protonestconnect.co"),console.error("   2. Find your device ID in your dashboard"),console.error(`   3. Update 'defaultDeviceId' in Dashboard.jsx
`),console.error(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`),window.__deviceAuthErrorShown=!0),Promise.reject(t);o!=="Device does not belong to the user"&&console.error("ðŸ” 400 Error:",{endpoint:e?.url,message:o})}}if(t.response?.status===405)return console.error("ðŸš« Method Not Allowed (405):",{attempted:e?.method?.toUpperCase(),endpoint:e?.url,allowed:t.response.headers?.allow||"Not specified"}),Promise.reject(t);if((t.response?.status===400||t.response?.status===401)&&!e?.url?.includes("/get-token")&&(t.response?.data?.data==="Invalid token"||t.response?.data?.message?.includes("token"))&&!e._retry){e._retry=!0;try{const s=localStorage.getItem("refreshToken");if(!s)throw new Error("No refresh token available");console.log("ðŸ”„ Attempting token refresh...");const n=await H.post(`${rt}/get-new-token`,{},{headers:{"X-Refresh-Token":s},timeout:1e4});if(n.data.status==="Success"){const{jwtToken:o}=n.data.data;return localStorage.setItem("jwtToken",o),e.headers["X-Token"]=o,console.log("âœ… Token refreshed successfully"),Se(e)}}catch(s){console.error("âŒ Token refresh failed:",s.message),localStorage.clear(),window.location.href="/"}}return Promise.reject(t)});const Mr=async(t,e,s=null,n=null,o=0,i=100)=>{try{const a=y=>y.toISOString().split(".")[0]+"Z",l=new Date,d=n?new Date(n):l,c=s?new Date(s):new Date(l.getTime()-1440*60*1e3);console.log(`â° [HTTP] Time calculation for ${e}:`,{currentTime:l.toISOString(),startTime:c.toISOString(),endTime:d.toISOString(),rangeHours:((d-c)/(1e3*60*60)).toFixed(1)});const u={deviceId:t,topic:e,startTime:a(c),endTime:a(d),pagination:String(o),pageSize:String(i)};console.log(`ðŸ“¤ [HTTP] Fetching ${e} data:`),console.log(JSON.stringify({deviceId:u.deviceId,topic:u.topic,startTime:u.startTime,endTime:u.endTime,pagination:u.pagination,pageSize:u.pageSize},null,2));const f=await Se.post("/get-stream-data/device/topic",u);if(console.log(`ðŸ“¥ [HTTP] Response for ${e}:`,{status:f.data.status,dataLength:f.data.data?.length||0}),f.data.status==="Success"){const y=f.data.data?.length||0;return y>0?(console.log(`âœ… ${e}: ${y} records`),console.log(`ðŸ“‹ [HTTP] Sample ${e} record:`,f.data.data[0])):console.log(`â„¹ï¸ ${e}: No data found in time range`),f.data.data||[]}return[]}catch(a){let l="Unknown error";return a.response?.data?l=a.response.data.data||a.response.data.message||a.response.data.error||(typeof a.response.data=="string"?a.response.data:null)||JSON.stringify(a.response.data):a.message&&(l=a.message),console.warn(`âš ï¸ [HTTP] Error fetching ${e}:`,{status:a.response?.status||"No response",statusText:a.response?.statusText||"N/A",message:l,fullResponse:a.response?.data}),[]}},Ar=async(t,e=null,s=null)=>{const n=[{name:"temp",label:"temperature"},{name:"moisture",label:"moisture"},{name:"humidity",label:"humidity"},{name:"battery",label:"battery"},{name:"light",label:"light"}];try{console.log(`ðŸ“Š [HTTP] Fetching historical data for ${t}`),console.log(`ðŸ“… [HTTP] Time range: ${e||"Last 24h"} to ${s||"Now"}`);const o=await Promise.allSettled(n.map(f=>Mr(t,f.name,e,s,0,100))),i=o.filter(f=>f.status==="fulfilled"&&f.value.length>0).length,a=o.filter(f=>f.status==="rejected").length,l=o.filter(f=>f.status==="fulfilled"&&f.value.length===0).length;console.log("ðŸ“Š [HTTP] Historical data summary:",{successful:i,empty:l,failed:a,total:n.length}),i>0?console.log(`âœ… [HTTP] Loaded ${i} topics with historical data`):window.__historicalDataWarningShown||(console.warn("â„¹ï¸ [HTTP] No historical data available yet. Real-time data will still work."),console.warn("ðŸ’¡ [HTTP] Possible reasons:"),console.warn("   1. Device recently added - ProtoNest hasn't saved MQTT data to DB yet"),console.warn("   2. Topic names mismatch - check what topic names are saved in DB"),console.warn("   3. Device not in your account - verify device ownership"),window.__historicalDataWarningShown=!0);const d=new Map;o.forEach((f,y)=>{const O=n[y],h=O.name,g=O.label;f.status==="fulfilled"&&Array.isArray(f.value)?(console.log(`ðŸ” [HTTP] Processing ${h}: ${f.value.length} records`),f.value.forEach(p=>{const j=p.timestamp||p.time||new Date().toISOString();d.has(j)||d.set(j,{timestamp:j,time:new Date(j).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),moisture:null,temperature:null,humidity:null,light:null,battery:null});const C=d.get(j);let N=p;if(p.payload&&typeof p.payload=="string")try{N=JSON.parse(p.payload)}catch{console.warn(`âš ï¸ Failed to parse payload for ${h}:`,p.payload),N=p}else p.payload&&typeof p.payload=="object"&&(N=p.payload);g==="temperature"||h==="temp"?(C.temperature=Number(N.temp||N.temperature||p.value||0),console.log(`  ðŸ“Š [${j}] temperature: ${C.temperature}`)):g==="moisture"?(C.moisture=Number(N.moisture||p.value||0),console.log(`  ðŸ“Š [${j}] moisture: ${C.moisture}`)):g==="humidity"?(C.humidity=Number(N.humidity||p.value||0),console.log(`  ðŸ“Š [${j}] humidity: ${C.humidity}`)):g==="battery"?(C.battery=Number(N.battery||p.value||0),console.log(`  ðŸ“Š [${j}] battery: ${C.battery}`)):g==="light"&&(C.light=Number(N.light||p.value||0),console.log(`  ðŸ“Š [${j}] light: ${C.light}`))})):f.status==="rejected"&&console.warn(`âš ï¸ [HTTP] Failed to fetch ${h} data:`,f.reason?.message)});const c=Array.from(d.values()).sort((f,y)=>new Date(f.timestamp)-new Date(y.timestamp)),u={moisture:null,temperature:null,humidity:null,light:null,battery:null};return c.forEach(f=>{Object.keys(u).forEach(y=>{f[y]!==null&&f[y]!==void 0&&f[y]!==0?u[y]=f[y]:u[y]!==null&&(f[y]=u[y])})}),c.length>0&&(console.log(`âœ… [HTTP] Historical data: ${c.length} data points combined`),console.log(`ðŸ“… [HTTP] Time range: ${c[0].time} to ${c[c.length-1].time}`),console.log("ðŸ“Š [HTTP] Latest data point:",c[c.length-1])),c}catch(o){throw console.error("âŒ [HTTP] Error fetching all stream data:",o),o}},Or=async(t,e,s={})=>{try{console.log("Updating device state:",{deviceId:t,topic:e,payload:s});const n={deviceId:t,topic:e,payload:s};console.log("ðŸ“¤ Update state request body:",JSON.stringify(n,null,2));const o=await Se.post("/update-state-details",n);return console.log("âœ… Device state update response:",o.data),o.data}catch(n){throw n.response?.status===405&&(console.error("âŒ Method not allowed for update-state-details. Server may not support POST."),console.error("Allowed methods:",n.response.headers?.allow||"Unknown")),n.response?.status===400&&console.error("ðŸ” Device Update 400 Error Analysis:",{endpoint:"/update-state-details",sentPayload:requestBody,serverResponse:n.response.data,possibleCauses:["Invalid deviceId format","Topic not found or invalid format","Payload structure incorrect (should be key-value pairs)","Missing required parameters (deviceId, topic, payload)","Topic doesn't exist - new topic will be created automatically"]}),console.error("âŒ Error updating device state:",{status:n.response?.status,statusText:n.response?.statusText,data:n.response?.data,message:n.message,url:n.config?.url,method:n.config?.method,requestBody}),n}},Rr=async(t,e,s="pump",n="auto")=>{const o=e.toLowerCase();return console.log("ðŸ“¤ Sending pump command via HTTP API:",{deviceId:t,topic:s,pump:o,mode:n}),Or(t,s,{pump:o,mode:n})},ve=({label:t,value:e,unit:s="",status:n,decimals:o=1})=>{const i=h=>h==null?"--":typeof h=="number"?Number(h).toFixed(o):h,a=h=>h==="critical"?{accent:"border-t-4 border-red-500",bg:"bg-red-500",text:"text-red-500"}:h==="warning"?{accent:"border-t-4 border-amber-400",bg:"bg-amber-400",text:"text-amber-500"}:{accent:"border-t-4 border-green-500",bg:"bg-green-50",text:"text-green-700"},{accent:l,bg:d,text:c,Icon:u,short:f}=a(n),y="text-3xl lg:text-4xl",O=c||"text-gray-800";return r.jsxs("div",{className:`flex flex-col items-center p-3 bg-white rounded-lg shadow-sm w-full ${l}`,children:[r.jsxs("div",{className:"flex flex-col items-center justify-center w-full",children:[r.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:t}),r.jsxs("div",{className:`${y} font-semibold ${O} text-center`,children:[i(e),s]})]}),f?r.jsx("div",{className:"mt-3 w-full flex items-center justify-center",children:r.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full ${d} ${c} text-xs font-semibold shadow-sm`,children:[u?r.jsx(u,{className:"w-4 h-4"}):null,r.jsx("span",{children:f})]})}):null]})},Dr=[{key:"moisture",label:"Moisture",color:"bg-cyan-500"},{key:"temperature",label:"Temp",color:"bg-green-500"},{key:"humidity",label:"Humidity",color:"bg-blue-500"},{key:"light",label:"Light",color:"bg-yellow-500"},{key:"battery",label:"Battery",color:"bg-purple-500"}],$r=({visibleSeries:t,toggleSeries:e,getButtonClass:s,className:n=""})=>r.jsx("div",{className:`flex items-center gap-2 justify-center md:justify-start ${n}`,children:Dr.map(({key:o,label:i,color:a})=>r.jsxs("button",{onClick:()=>e(o),className:s(t[o],a),children:[t[o]?r.jsx(Ps,{className:"w-3 h-3"}):r.jsx(_s,{className:"w-3 h-3"})," ",i]},o))}),Ir=({chartData:t,isLoading:e,onExportCSV:s,isExporting:n,dataSource:o="None",error:i=null,timeRange:a="1h",dataInterval:l="auto",onTimeRangeChange:d,onDataIntervalChange:c,allData:u=[],onFilteredDataChange:f})=>{const[y,O]=w.useState({moisture:!0,temperature:!0,humidity:!0,light:!0,battery:!0}),[h,g]=w.useState(!1),[p,j]=w.useState(""),[C,N]=w.useState("minutes"),[v,T]=w.useState(""),[M,_]=w.useState("seconds"),[q,J]=w.useState(!1),[V,x]=w.useState(a),[b,S]=w.useState(l),[k,W]=w.useState("all"),U=()=>{if(!p||parseFloat(p)<=0){alert("Please enter a valid time range value");return}const E={seconds:1e3,minutes:60*1e3,hours:3600*1e3,days:1440*60*1e3},Y=`custom_${parseFloat(p)*E[C]}`;if(le[Y]=`${p} ${C.charAt(0).toUpperCase()+C.slice(1)}`,v&&parseFloat(v)>0){const fe=`custom_interval_${parseFloat(v)*E[M]}`;G[fe]=`${v} ${M.charAt(0).toUpperCase()+M.slice(1)}`,c&&c(fe)}d&&d(Y),g(!1)},le={"1m":"Last 1 Minute","5m":"Last 5 Minutes","15m":"Last 15 Minutes","1h":"Last 1 Hour","6h":"Last 6 Hours","24h":"Last 24 Hours"},G={auto:"Auto","1s":"1 Second","5s":"5 Seconds","1m":"1 Minute","5m":"5 Minutes","1h":"1 Hour"},$=(E=>{if(E.startsWith("custom_")){const Y=parseInt(E.replace("custom_","")),K=["auto"];return Y>=1e3&&K.push("1s"),Y>=5e3&&K.push("5s"),Y>=6e4&&K.push("1m"),Y>=3e5&&K.push("5m"),Y>=36e5&&K.push("1h"),K}return{"1m":["auto","1s"],"5m":["auto","1s","5s"],"15m":["auto","1s","5s","1m"],"1h":["auto","1s","5s","1m","5m"],"6h":["auto","5s","1m","5m"],"24h":["auto","1m","5m","1h"]}[E]||["auto"]})(a),R=w.useMemo(()=>{if(!u||u.length===0)return t;const E=new Date;let L;a.startsWith("custom_")?L=parseInt(a.replace("custom_","")):L={"1m":60*1e3,"5m":300*1e3,"15m":900*1e3,"1h":3600*1e3,"6h":360*60*1e3,"24h":1440*60*1e3}[a]||3600*1e3;const Y=E.getTime()-L;let K=u.filter(Z=>new Date(Z.timestamp).getTime()>=Y);if(l!=="auto"&&K.length>0){let Z;if(l.startsWith("custom_interval_")?Z=parseInt(l.replace("custom_interval_","")):Z={"1s":1e3,"5s":5e3,"1m":6e4,"5m":5*6e4,"1h":60*6e4}[l]||0,Z>0){const ie=new Map;K.forEach(ce=>{const Ee=new Date(ce.timestamp).getTime(),he=Math.floor(Ee/Z)*Z;if(!ie.has(he))ie.set(he,ce);else{const fs=ie.get(he),hs=new Date(fs.timestamp).getTime();Math.abs(Ee-he)<Math.abs(hs-he)&&ie.set(he,ce)}}),K=Array.from(ie.values()).sort((ce,Ee)=>new Date(ce.timestamp).getTime()-new Date(Ee.timestamp).getTime())}}const fe=l==="1s"||l==="5s"||l.startsWith("custom_interval_")&&parseInt(l.replace("custom_interval_",""))<6e4;return K=K.map(Z=>({...Z,time:new Date(Z.timestamp).toLocaleTimeString([],fe?{hour:"2-digit",minute:"2-digit",second:"2-digit"}:{hour:"2-digit",minute:"2-digit"})})),K},[u,t,a,l]),P=E=>{O(L=>({...L,[E]:!L[E]}))},F=Object.values(y).every(E=>E===!0);oe.useEffect(()=>{f&&f(R)},[R,f]);const A=()=>{const E=Object.keys(y).filter(L=>y[L]);d&&d(V),c&&c(b),setTimeout(()=>{s&&s(E),J(!1)},100)},I=()=>{d&&d(V),c&&c(b),setTimeout(()=>{s&&s(),J(!1)},100)},z=E=>{const L=E==="selected"?Object.keys(y).filter(Y=>y[Y]):null;s&&s(L),J(!1)};oe.useEffect(()=>{q&&(x(a),S(l))},[q,a,l]);const He=(E,L)=>`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all border ${E?`${L} text-white border-transparent shadow-sm`:"bg-gray-50 text-gray-500 border-gray-200 hover:bg-gray-100"}`;return r.jsxs("div",{className:"w-[calc(100%-2rem)] max-w-7xl mx-auto bg-white rounded-2xl p-4 shadow-sm flex flex-col border border-gray-200 px-6 py-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Historical Trends of the Sensors"}),r.jsxs("span",{className:"text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-full flex items-center gap-1",children:[r.jsx(Ls,{className:"w-3 h-3"}),le[a]||a.replace("custom_","").replace(/\d+/,E=>{const L=parseInt(E);return L>=864e5?`${(L/864e5).toFixed(1)} Days`:L>=36e5?`${(L/36e5).toFixed(1)} Hours`:L>=6e4?`${(L/6e4).toFixed(1)} Minutes`:`${(L/1e3).toFixed(1)} Seconds`})]}),l!=="auto"&&r.jsx("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full border border-indigo-200",children:G[l]||l.replace("custom_interval_","").replace(/\d+/,E=>{const L=parseInt(E);return L>=36e5?`${(L/36e5).toFixed(1)} Hour Interval`:L>=6e4?`${(L/6e4).toFixed(1)} Min Interval`:`${(L/1e3).toFixed(1)}s Interval`})}),R.length>0&&r.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full border border-purple-200",children:[R.length," points"]}),o!=="None"&&r.jsxs("span",{className:`text-xs px-2 py-1 rounded-full flex items-center gap-1 ${o==="API"?"bg-blue-100 text-blue-700 border border-blue-200":"bg-green-100 text-green-700 border border-green-200"}`,children:[o==="API"?r.jsx(Fs,{className:"w-3 h-3"}):r.jsx(Pt,{className:"w-3 h-3"}),o]})]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>J(!q),disabled:n||t.length===0,className:"bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 text-xs font-bold px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[n?r.jsx(Ke,{className:"w-4 h-4 animate-spin"}):r.jsx(mt,{className:"w-4 h-4"}),r.jsx("span",{children:"Export CSV"})]}),q&&!n&&t.length>0&&r.jsx("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:r.jsxs("div",{className:"p-4",children:[r.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-3",children:"Export Options"}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sensors"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>W("all"),className:`flex-1 px-3 py-1.5 text-xs rounded transition-all ${k==="all"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Sensors"}),!F&&r.jsxs("button",{onClick:()=>W("selected"),className:`flex-1 px-3 py-1.5 text-xs rounded transition-all ${k==="selected"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Selected (",Object.values(y).filter(E=>E).length,")"]})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Time Range"}),r.jsxs("select",{value:V,onChange:E=>x(E.target.value),className:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"1m",children:"Last 1 Minute"}),r.jsx("option",{value:"5m",children:"Last 5 Minutes"}),r.jsx("option",{value:"15m",children:"Last 15 Minutes"}),r.jsx("option",{value:"1h",children:"Last 1 Hour"}),r.jsx("option",{value:"6h",children:"Last 6 Hours"}),r.jsx("option",{value:"24h",children:"Last 24 Hours"})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Data Interval"}),r.jsxs("select",{value:b,onChange:E=>S(E.target.value),className:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"auto",children:"Auto"}),r.jsx("option",{value:"1s",children:"1 Second"}),r.jsx("option",{value:"5s",children:"5 Seconds"}),r.jsx("option",{value:"1m",children:"1 Minute"}),r.jsx("option",{value:"5m",children:"5 Minutes"}),r.jsx("option",{value:"1h",children:"1 Hour"})]})]}),r.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-200",children:[r.jsx("button",{onClick:()=>J(!1),className:"flex-1 px-3 py-2 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-all",children:"Cancel"}),r.jsxs("button",{onClick:k==="all"?I:A,className:"flex-1 px-3 py-2 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-all font-medium flex items-center justify-center gap-1",children:[r.jsx(mt,{className:"w-3 h-3"}),"Export"]})]}),r.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:r.jsx("button",{onClick:()=>z(k),className:"w-full px-3 py-1.5 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded transition-all text-center",children:"Quick Export (Current View)"})})]})})]})]}),q&&r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>J(!1)}),i&&r.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-3 mb-4 flex items-center gap-2 text-sm",children:[r.jsx(Ft,{className:"w-4 h-4 flex-shrink-0"}),r.jsx("span",{children:i})]}),h&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx- shadow-2xl",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Custom Time Range"}),r.jsxs("div",{className:"space-y-10",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Range"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"number",value:p,onChange:E=>j(E.target.value),placeholder:"Enter value",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"any"}),r.jsxs("select",{value:C,onChange:E=>N(E.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"seconds",children:"Seconds"}),r.jsx("option",{value:"minutes",children:"Minutes"}),r.jsx("option",{value:"hours",children:"Hours"}),r.jsx("option",{value:"days",children:"Days"})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Interval (Optional)"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"number",value:v,onChange:E=>T(E.target.value),placeholder:"Leave empty for auto",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"any"}),r.jsxs("select",{value:M,onChange:E=>_(E.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"seconds",children:"Seconds"}),r.jsx("option",{value:"minutes",children:"Minutes"}),r.jsx("option",{value:"hours",children:"Hours"})]})]})]})]}),r.jsxs("div",{className:"flex gap-3 mt-6",children:[r.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium",children:"Cancel"}),r.jsx("button",{onClick:U,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all font-medium shadow-md",children:"Apply"})]})]})}),r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("div",{className:"flex-1",children:r.jsx($r,{visibleSeries:y,toggleSeries:P,getButtonClass:He,className:"mb-0 p-0 bg-transparent border-0"})}),r.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600 hidden md:inline",children:"Time Range"}),r.jsxs("select",{value:a.startsWith("custom_")?"custom":a,onChange:E=>{E.target.value==="custom"?g(!0):d&&d(E.target.value)},className:"px-3 py-1 rounded-lg text-xs border border-gray-300 bg-white",children:[r.jsx("option",{value:"1m",children:"1m"}),r.jsx("option",{value:"5m",children:"5m"}),r.jsx("option",{value:"15m",children:"15m"}),r.jsx("option",{value:"1h",children:"1h"}),r.jsx("option",{value:"6h",children:"6h"}),r.jsx("option",{value:"24h",children:"24h"}),r.jsx("option",{value:"custom",children:"Custom"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600 hidden md:inline",children:"Interval"}),r.jsxs("select",{value:l.startsWith("custom_interval_")?"custom":l,onChange:E=>{E.target.value==="custom"?g(!0):c&&c(E.target.value)},className:"px-3 py-1 rounded-lg text-xs border border-gray-300 bg-white",children:[["auto","1s","5s","1m","5m","1h"].map(E=>r.jsx("option",{value:E,disabled:!$.includes(E),children:G[E]},E)),r.jsx("option",{value:"custom",children:"Custom"})]})]})]})]}),r.jsx("div",{className:"h-96 w-full flex-grow relative",children:e?r.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400 bg-white/50 z-10",children:[r.jsx(Ke,{className:"animate-spin w-10 h-10 mb-3 text-blue-500"}),r.jsx("span",{className:"text-sm font-medium",children:"Loading Data..."})]}):R.length===0?r.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:r.jsx("span",{className:"text-sm",children:"No data available for this period"})}):r.jsx(ws,{width:"100%",height:"100%",children:r.jsxs(vs,{data:R,margin:{top:10,right:10,left:-20,bottom:0},children:[r.jsx(Ns,{strokeDasharray:"3 3",vertical:!1,stroke:"#f0f0f0"}),r.jsx(Ss,{dataKey:"time",tick:{fontSize:11,fill:"#9ca3af"},tickLine:!1,axisLine:{stroke:"#e5e7eb"},minTickGap:30}),r.jsx(ot,{yAxisId:"left",tick:{fontSize:11,fill:"#9ca3af"},tickLine:!1,axisLine:!1,domain:[0,"auto"]}),r.jsx(ot,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:"#eab308"},tickLine:!1,axisLine:!1,hide:!y.light}),r.jsx(js,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},itemStyle:{fontSize:"12px",fontWeight:600}}),y.moisture&&r.jsx(ye,{yAxisId:"left",type:"monotone",dataKey:"moisture",name:"Moisture (%)",stroke:"#06b6d4",strokeWidth:3,dot:!1,activeDot:{r:6}}),y.temperature&&r.jsx(ye,{yAxisId:"left",type:"monotone",dataKey:"temperature",name:"Temp (Â°C)",stroke:"#22c55e",strokeWidth:3,dot:!1,activeDot:{r:6}}),y.humidity&&r.jsx(ye,{yAxisId:"left",type:"monotone",dataKey:"humidity",name:"Humidity (%)",stroke:"#3b82f6",strokeWidth:3,dot:!1,activeDot:{r:6}}),y.battery&&r.jsx(ye,{yAxisId:"left",type:"step",dataKey:"battery",name:"Battery (%)",stroke:"#a855f7",strokeWidth:3,dot:!1}),y.light&&r.jsx(ye,{yAxisId:"right",type:"monotone",dataKey:"light",name:"Light (lux)",stroke:"#eab308",strokeWidth:3,dot:!1,activeDot:{r:6}})]})})})]})},Lr=()=>r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3v18h18"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17V9m6 8V5m-3 12V13"})]}),ms=({title:t="Title",subtitle:e="",deviceId:s="",showDate:n=!0,showDevice:o=!0,icon:i=null})=>{const[a,l]=w.useState(new Date);return w.useEffect(()=>{if(!n)return;const d=setInterval(()=>l(new Date),1e3);return()=>clearInterval(d)},[n]),r.jsx("div",{className:"mb-6 mx-auto justify-center z-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"bg-indigo-50 text-indigo-600 rounded-lg p-3",children:i||r.jsx(Lr,{})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:t}),e&&r.jsx("p",{className:"text-sm text-gray-500",children:e})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[n&&r.jsx("div",{className:"text-xl font-semibold text-gray-800",children:a.toLocaleString([],{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),o&&r.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[r.jsx("span",{className:"text-sm text-gray-500",children:"Device ID"}),r.jsx("div",{className:"bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full",children:s||"â€”"})]})]})]})})},Fr=({enabled:t=!0})=>{const e=new Date,s=e.getMonth(),n=e.getDate(),o=s===11,i=o&&(n===24||n===25),a=w.useMemo(()=>{const l=Math.min(80,Math.max(20,Math.floor(window.innerWidth/12)));return Array.from({length:l}).map((d,c)=>{const u=Math.random()*8+6,f=Math.random()*100,y=Math.random()*8,O=6+Math.random()*10,h=.6+Math.random()*.4,g=Math.random()*40+10;return{id:c,size:u,left:f,delay:y,duration:O,opacity:h,sway:g}})},[]);return!t||!o?null:r.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none",children:[r.jsxs("div",{style:{position:"fixed",inset:0,zIndex:40,overflow:"hidden"},children:[r.jsx("style",{children:`
          @keyframes fallDown {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); }
            100% { transform: translateY(110vh) translateX(var(--sway)) rotate(360deg); }
          }
        `}),a.map(l=>r.jsx("div",{style:{position:"absolute",left:`${l.left}%`,top:"-5vh",width:l.size,height:l.size,borderRadius:"50%",background:"rgba(255,255,255,0.9)",boxShadow:"0 0 6px rgba(255,255,255,0.6)",opacity:l.opacity,transform:"translateY(-10vh)",animationName:"fallDown",animationDuration:`${l.duration}s`,animationDelay:`${l.delay}s`,animationTimingFunction:"linear",animationIterationCount:"infinite","--sway":`${(Math.random()>.5?1:-1)*l.sway}px`}},l.id))]}),i&&r.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"flex-start",justifyContent:"center",zIndex:50,pointerEvents:"none"},children:r.jsx("div",{style:{marginTop:72,background:"rgba(255,255,255,0.9)",color:"#1f2937",padding:"8px 14px",borderRadius:12,boxShadow:"0 6px 20px rgba(0,0,0,0.12)",fontWeight:600},children:n===24?"Warm wishes â€” Happy Christmas Eve! ðŸŽ„":"Merry Christmas! ðŸŽ… Enjoy the holidays!"})})]})},_r=({deviceId:t,liveData:e,settings:s,isConnected:n,alertMessage:o})=>{const a=t||"device0011233",{jwtToken:l}=Le(),d=e||{moisture:0,temperature:0,humidity:0,light:0,battery:0,pumpStatus:"OFF",pumpMode:"manual"},c=s||{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1},[u]=w.useState(["device9988","device0011233","device0000","device0001","device0002"]),[f,y]=w.useState([]),[O,h]=w.useState([]),[g,p]=w.useState(!1),[j,C]=w.useState(!1),[N,v]=w.useState(null),[T,M]=w.useState(()=>localStorage.getItem(`timeRange_${a}`)||"1h"),[_,q]=w.useState(()=>localStorage.getItem(`dataInterval_${a}`)||"auto"),[J,V]=w.useState({});w.useEffect(()=>{try{const $=P=>{const F=e?.[P];if(F==null||c==null)return{level:"normal",message:null};const A=Number(F);if(!isFinite(A))return{level:"normal",message:null};if(P==="moisture"){const I=parseFloat(c.moistureMin),z=parseFloat(c.moistureMax);if(!isNaN(I)&&A<I)return{level:"critical",message:`CRITICAL: ${A.toFixed(1)}% < ${I}%`};if(!isNaN(z)&&A>z)return{level:"warning",message:`WARNING: ${A.toFixed(1)}% > ${z}%`}}if(P==="temperature"){const I=parseFloat(c.tempMin),z=parseFloat(c.tempMax);if(!isNaN(I)&&A<I)return{level:"critical",message:`CRITICAL: ${A.toFixed(1)}Â°C < ${I}Â°C`};if(!isNaN(z)&&A>z)return{level:"warning",message:`WARNING: ${A.toFixed(1)}Â°C > ${z}Â°C`}}if(P==="humidity"){const I=parseFloat(c.humidityMin),z=parseFloat(c.humidityMax);if(!isNaN(I)&&A<I)return{level:"critical",message:`CRITICAL: ${A.toFixed(1)}% < ${I}%`};if(!isNaN(z)&&A>z)return{level:"warning",message:`WARNING: ${A.toFixed(1)}% > ${z}%`}}if(P==="light"){const I=parseFloat(c.lightMin),z=parseFloat(c.lightMax);if(!isNaN(I)&&A<I)return{level:"critical",message:`CRITICAL: ${Math.round(A)} lux < ${I} lux`};if(!isNaN(z)&&A>z)return{level:"warning",message:`WARNING: ${Math.round(A)} lux > ${z} lux`}}if(P==="battery"){const I=parseFloat(c.batteryMin);if(!isNaN(I)&&A<I)return{level:"critical",message:`Warning: below ${I}%`}}return{level:"normal",message:null}},R={moisture:$("moisture"),temperature:$("temperature"),humidity:$("humidity"),light:$("light"),battery:$("battery")};console.debug("[Dashboard] computed alertStates ->",{rawLive:e,settings:c,states:R}),V(R)}catch($){console.warn("[Dashboard] alertStates compute failed",$)}},[e,c]);const[x,b]=w.useState(null),[S,k]=w.useState(null);w.useEffect(()=>{const $=async()=>{if(!l){console.warn("âš ï¸ Cannot fetch historical data: missing deviceId or token");return}p(!0),v(null);try{console.log(`ðŸ“Š [HTTP API] Fetching historical data for device: ${a}`);const P=await Ar(a);y(P),console.log(`âœ… [HTTP API] Historical data loaded: ${P.length} records`)}catch(P){console.error("âŒ [HTTP API] Failed to fetch historical data:",P),P.response?.data?.data==="Device does not belong to the user"?v(`âš ï¸ Device "${a}" not found in your account. Please update the device ID in Dashboard.jsx or add this device to your ProtoNest account. Real-time data will still work.`):v("Failed to load historical data. Real-time WebSocket data will still work."),y([])}finally{p(!1)}};$();const R=setInterval(()=>{l&&$()},3e4);return()=>clearInterval(R)},[a,l,T]),w.useEffect(()=>{console.log(`[Dashboard] ðŸ”„ Device changed to: ${a} - Resetting view state`),y([]),h([]),v(null),b(null),k(null);const $=localStorage.getItem(`timeRange_${a}`),R=localStorage.getItem(`dataInterval_${a}`);M($||"1h"),q(R||"auto"),console.log(`[Dashboard] âœ… View reset complete for device: ${a}`)},[a]);const W=async($=null)=>{C(!0);try{const R=O.length>0?O:f;if(R.length===0){alert("No data available to export. Please wait for data to accumulate.");return}const P=["moisture","temperature","humidity","light","battery"],F=$&&$.length>0?$.filter(Z=>P.includes(Z)):P,A=["time",...F].join(","),I=R.map(Z=>{const ie=[Z.time];return F.forEach(ce=>{ie.push(Z[ce]??"")}),ie.join(",")}).join(`
`),z=`${A}
${I}`,He=new Blob([z],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(He),L=document.createElement("a");L.href=E;const Y=$?"selected":"all",K=T.replace("custom_","custom-"),fe=_==="auto"?"auto":_.replace("custom_interval_","interval-");L.download=`agricop_${a}_${Y}_${K}_${fe}_report.csv`,document.body.appendChild(L),L.click(),document.body.removeChild(L)}catch(R){console.error("Export failed",R)}finally{C(!1)}},U=$=>{console.log(`ðŸ“Š Changing time range to: ${$}`),M($),localStorage.setItem(`timeRange_${a}`,$);let R="auto";$==="1m"||$==="5m"?R="1s":$==="15m"?R="5s":$==="1h"?R="auto":$==="6h"?R="1m":$==="24h"&&(R="5m"),q(R),localStorage.setItem(`dataInterval_${a}`,R)},le=$=>{console.log(`ðŸ“Š Changing data interval to: ${$}`),q($),localStorage.setItem(`dataInterval_${a}`,$)},G=d?.pumpStatus||"OFF",ae=$=>{try{const R=d?.[$];if(R==null||c==null)return"critical";const P=Number(R);if(!isFinite(P))return"critical";let F=NaN,A=NaN;const I={moistureMin:20,moistureMax:70,tempMin:10,tempMax:35,humidityMin:30,humidityMax:80,lightMin:200,lightMax:1e3,batteryMin:20};switch($){case"moisture":F=parseFloat(c.moistureMin),A=parseFloat(c.moistureMax),isNaN(F)&&(F=I.moistureMin),isNaN(A)&&(A=I.moistureMax);break;case"temperature":F=parseFloat(c.tempMin),A=parseFloat(c.tempMax),isNaN(F)&&(F=I.tempMin),isNaN(A)&&(A=I.tempMax);break;case"humidity":F=parseFloat(c.humidityMin),A=parseFloat(c.humidityMax),isNaN(F)&&(F=I.humidityMin),isNaN(A)&&(A=I.humidityMax);break;case"light":F=parseFloat(c.lightMin),A=parseFloat(c.lightMax),isNaN(F)&&(F=I.lightMin),isNaN(A)&&(A=I.lightMax);break;case"battery":F=parseFloat(c.batteryMin),isNaN(F)&&(F=I.batteryMin),A=100;break;default:break}return!isNaN(F)&&P===F||!isNaN(A)&&P===A?"warning":!isNaN(F)&&P<F||!isNaN(A)&&P>A?"critical":"normal"}catch(R){return console.warn("[Dashboard] getSensorStatus failed",R),"critical"}};return r.jsxs("div",{className:"min-h-screen bg-[#f0f4f8] p-4 font-sans text-gray-800 overflow-x-hidden",children:[r.jsx(Fr,{}),r.jsx("div",{className:"w-[calc(100%-2rem)] max-w-7xl justify-center mx-auto mb-6",children:r.jsx(ms,{title:"Dashboard",subtitle:"Real-time sensor readings, charts, and controls for your device.",deviceId:a})}),r.jsxs("div",{className:"w-[calc(100%-2rem)] mx-auto px-4 mb-8",children:[r.jsx("div",{className:"max-w-7xl mx-auto",children:r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:[r.jsx(ve,{label:"Soil Moisture",value:d?.moisture,unit:"%",decimals:1,status:ae("moisture")}),r.jsx(ve,{label:"Temperature",value:d?.temperature,unit:"Â°C",decimals:1,status:ae("temperature")}),r.jsx(ve,{label:"Humidity",value:d?.humidity,unit:"%",decimals:1,status:ae("humidity")}),r.jsx(ve,{label:"Light",value:d?.light,unit:" lux",decimals:0,status:ae("light")}),r.jsx(ve,{label:"Battery",value:d?.battery,unit:"%",decimals:0,status:ae("battery")})]})}),r.jsx("div",{className:`w-[calc(100%-2rem)] max-w-7xl mx-auto rounded-xl py-3 text-center border transition-colors duration-500 shadow-sm ${G==="ON"?"bg-green-100 border-green-300 text-green-900":"bg-blue-100 border-blue-300 text-blue-900"}`,children:r.jsxs("h2",{className:"text-lg font-semibold",children:["Pump : ",G," (",d?.pumpMode||"Optimal",")"]})})]}),r.jsx("div",{className:"w-[calc(100%-2rem)] mx-auto flex flex-col items-center justify-center",children:r.jsx("div",{className:"w-full",children:r.jsx(Ir,{chartData:f,isLoading:g,onExportCSV:W,isExporting:j,dataSource:"HTTP API",error:N,timeRange:T,dataInterval:_,onTimeRangeChange:U,onDataIntervalChange:le,allData:f,onFilteredDataChange:h})})})]})},Dt=({label:t,value:e,onChange:s,min:n,max:o,step:i="1",error:a,unit:l=""})=>r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:[t," ",l&&`(${l})`]}),r.jsx("input",{type:"number",min:n,max:o,step:i,value:e,onChange:s,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none ${a?"border-red-300":"border-gray-300"}`}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Valid Range: ",n," - ",o," ",l]}),a&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:a})]}),Ne=({title:t,minConfig:e,maxConfig:s,rangeError:n,icon:o})=>r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-gray-700 border-b pb-2",children:r.jsxs("div",{className:"flex items-center gap-3",children:[o&&r.jsx(o,{className:"w-5 h-5 text-gray-600"}),r.jsx("span",{children:t})]})}),n&&r.jsxs("div",{className:"text-red-600 text-sm flex items-center gap-2",children:[r.jsx(Ut,{className:"w-4 h-4"}),n]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsx(Dt,{...e}),s&&r.jsx(Dt,{...s})]})]}),Pr=({onClick:t,disabled:e,loading:s,loadingText:n="Processing...",icon:o,children:i,className:a=""})=>r.jsx("button",{onClick:t,disabled:e||s,className:`flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition ${a}`,children:s?r.jsxs(r.Fragment,{children:[r.jsx(Ke,{className:"w-4 h-4 animate-spin"}),n]}):r.jsxs(r.Fragment,{children:[o&&r.jsx(o,{className:"w-4 h-4"}),i]})}),Ur=({enabled:t,onToggle:e,title:s="Automatic Mode",description:n="Auto control pump based on moisture thresholds"})=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-700",children:s}),r.jsx("div",{className:"text-xs text-gray-500",children:n})]}),r.jsx("button",{onClick:e,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${t?"bg-blue-600":"bg-gray-300"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]}),Br=({open:t,title:e="Cannot Save Settings",errors:s=[],onClose:n})=>t?r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black opacity-40",onClick:n}),r.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4 z-10 border-2 border-red-200",children:[r.jsxs("div",{className:"p-4 border-b flex items-center gap-3",children:[r.jsx(Ut,{className:"w-6 h-6 text-red-600"}),r.jsx("h3",{className:"text-lg font-semibold text-red-700",children:e})]}),r.jsxs("div",{className:"p-4",children:[r.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"There are errors in the form. Please correct the highlighted fields before saving."}),s&&s.length>0&&r.jsx("ul",{className:"list-disc list-inside text-sm text-red-600 space-y-1 mb-4",children:s.map((o,i)=>r.jsx("li",{children:o},i))}),r.jsx("div",{className:"flex justify-end",children:r.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-semibold",children:"Close"})})]})]})]}):null,te={moisture:{min:20,max:60},temperature:{min:10,max:35},humidity:{min:30,max:70},light:{min:100,max:1e3},battery:{min:20}},Hr=({deviceId:t})=>{const e=t,[s,n]=w.useState(te),[o,i]=w.useState(!1),[a,l]=w.useState(!1),[d,c]=w.useState(""),[u,f]=w.useState(!1),[y,O]=w.useState([]),{addNotification:h}=Qe();w.useEffect(()=>{if(!e)return;const x=`settings_${e}`;try{const b=localStorage.getItem(x);if(b){const S=JSON.parse(b);if(S.thresholds){const k=Object.keys(te).reduce((W,U)=>(W[U]={...te[U],...S.thresholds[U]||{}},W),{});n(k)}typeof S.autoMode=="boolean"&&i(S.autoMode),typeof S.pumpOn=="boolean"&&l(S.pumpOn)}}catch{}},[e]);const g=(x={})=>{if(!e)return;const b=`settings_${e}`,S={thresholds:{...s,...x.thresholds||{}},autoMode:typeof x.autoMode=="boolean"?x.autoMode:o,pumpOn:typeof x.pumpOn=="boolean"?x.pumpOn:a};localStorage.setItem(b,JSON.stringify(S)),window.dispatchEvent(new CustomEvent("settings:updated",{detail:{deviceId:e}}))},p=(x,b,S)=>{n(k=>{const W=Number(S),U=Number.isNaN(W)&&k&&k[x]&&typeof k[x][b]<"u"?k[x][b]:W;return{...k,[x]:{...k[x],[b]:U}}})},j=()=>{i(x=>{const b=!x;try{h({type:"pump:mode",message:`Pump mode set to ${b?"auto":"manual"}`,timestamp:new Date().toISOString(),meta:{deviceId:e}})}catch{}return b})},C=()=>{l(x=>{const b=!x;g({pumpOn:b});try{const S=o?"auto":"manual";h({type:"pump:status",message:`Pump turned ${b?"ON":"OFF"} (${S})`,timestamp:new Date().toISOString(),meta:{deviceId:e,mode:S}})}catch{}return b})},[N,v]=w.useState({moisture:"unknown",temperature:"unknown",humidity:"unknown",light:"unknown",battery:"unknown"});w.useEffect(()=>{try{const b=window.__latestLiveData||null;b&&typeof b=="object"&&(v(S=>({moisture:typeof b.moisture<"u"?b.moisture:S.moisture,temperature:typeof b.temperature<"u"?b.temperature:S.temperature,humidity:typeof b.humidity<"u"?b.humidity:S.humidity,light:typeof b.light<"u"?b.light:S.light,battery:typeof b.battery<"u"?b.battery:S.battery})),typeof b.pumpStatus<"u"&&l(String(b.pumpStatus).toUpperCase()==="ON"),typeof b.pumpMode<"u"&&i(String(b.pumpMode).toLowerCase()==="auto"))}catch{}const x=b=>{const S=b&&b.detail?b.detail:b;if(S){v(k=>({moisture:typeof S.moisture<"u"?S.moisture:k.moisture,temperature:typeof S.temperature<"u"?S.temperature:k.temperature,humidity:typeof S.humidity<"u"?S.humidity:k.humidity,light:typeof S.light<"u"?S.light:k.light,battery:typeof S.battery<"u"?S.battery:k.battery}));try{typeof S.pumpStatus<"u"&&l(String(S.pumpStatus).toUpperCase()==="ON"),typeof S.pumpMode<"u"&&i(String(S.pumpMode).toLowerCase()==="auto")}catch{}}};return window.addEventListener("live:update",x),()=>window.removeEventListener("live:update",x)},[]);const T=x=>{const b=N[x];if(b==null||String(b)==="unknown")return"critical";const S=Number(b);if(Number.isNaN(S))return"critical";const k=s&&s[x]||te[x]||{},W=typeof k.min<"u"?Number(k.min):void 0,U=typeof k.max<"u"?Number(k.max):void 0;return typeof W<"u"&&!Number.isNaN(W)&&S===W||typeof U<"u"&&!Number.isNaN(U)&&S===U?"warning":typeof W<"u"&&!Number.isNaN(W)&&S<W||typeof U<"u"&&!Number.isNaN(U)&&S>U?"critical":"normal"},M=x=>{const b=T(x);return b==="critical"?{container:"bg-red-50 rounded p-2",icon:"text-red-600",value:"text-red-600"}:b==="warning"?{container:"bg-yellow-50 rounded p-2",icon:"text-yellow-600",value:"text-yellow-600"}:{container:"bg-green-50 rounded p-2",icon:"text-green-600",value:"text-green-600"}},_=()=>{J()},q={moisture:{min:0,max:100},temperature:{min:-10,max:60},humidity:{min:0,max:100},light:{min:0,max:2e3},battery:{min:0,max:100}},J=()=>{const x=[];if(Object.keys(q).forEach(b=>{const S=q[b],k=s[b]||{};typeof k.min>"u"||k.min===null||k.min===""?x.push(`${V(b)} Min is required.`):Number.isNaN(Number(k.min))?x.push(`${V(b)} Min must be a number.`):(Number(k.min)<S.min||Number(k.min)>S.max)&&x.push(`${V(b)} Min must be between ${S.min} and ${S.max}.`),typeof k.max<"u"&&(k.max===null||k.max===""?x.push(`${V(b)} Max is required.`):Number.isNaN(Number(k.max))?x.push(`${V(b)} Max must be a number.`):(Number(k.max)<S.min||Number(k.max)>S.max)&&x.push(`${V(b)} Max must be between ${S.min} and ${S.max}.`)),typeof k.min<"u"&&typeof k.max<"u"&&k.min!==""&&k.max!==""&&Number(k.min)>Number(k.max)&&x.push(`${V(b)} Min cannot be greater than Max.`)}),x.length>0){O(x),f(!0);return}g({thresholds:s}),c("Settings saved"),setTimeout(()=>c(""),2500)},V=x=>x.charAt(0).toUpperCase()+x.slice(1);return r.jsx(r.Fragment,{children:r.jsxs("div",{className:"min-h-screen bg-[#f0f4f8] p-4 font-sans text-gray-800 overflow-x-hidden",children:[r.jsx("div",{children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsx(ms,{title:"Device Settings",subtitle:"Configure thresholds and pump",deviceId:e,showDate:!0,icon:r.jsx(_t,{className:"w-6 h-6"})}),r.jsx("div",{className:" p-8 mx-auto mt-6 bg-blue-100 rounded-lg shadow-md border-blue-50",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch",children:[r.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-6 w-full lg:col-span-8",children:r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 grid grid-cols-2 grid-rows-3 gap-6",children:[r.jsx("div",{children:r.jsx(Ne,{title:"Soil Moisture Thresholds",icon:ft,minConfig:{label:"Min",unit:"%",value:s&&s.moisture&&typeof s.moisture.min<"u"?s.moisture.min:te.moisture.min,onChange:x=>p("moisture","min",x.target.value),min:0,max:100,step:1},maxConfig:{label:"Max",unit:"%",value:s&&s.moisture&&typeof s.moisture.max<"u"?s.moisture.max:te.moisture.max,onChange:x=>p("moisture","max",x.target.value),min:0,max:100,step:1}})}),r.jsx("div",{children:r.jsx(Ne,{title:"Temperature Thresholds",icon:pt,minConfig:{label:"Min",unit:"Â°C",value:s&&s.temperature&&typeof s.temperature.min<"u"?s.temperature.min:te.temperature.min,onChange:x=>p("temperature","min",x.target.value),min:-10,max:50,step:.5},maxConfig:{label:"Max",unit:"Â°C",value:s&&s.temperature&&typeof s.temperature.max<"u"?s.temperature.max:te.temperature.max,onChange:x=>p("temperature","max",x.target.value),min:0,max:60,step:.5}})}),r.jsx("div",{children:r.jsx(Ne,{title:"Humidity Thresholds",icon:dt,minConfig:{label:"Min",unit:"%",value:s&&s.humidity&&typeof s.humidity.min<"u"?s.humidity.min:te.humidity.min,onChange:x=>p("humidity","min",x.target.value),min:0,max:100,step:1},maxConfig:{label:"Max",unit:"%",value:s&&s.humidity&&typeof s.humidity.max<"u"?s.humidity.max:te.humidity.max,onChange:x=>p("humidity","max",x.target.value),min:0,max:100,step:1}})}),r.jsx("div",{children:r.jsx(Ne,{title:"Light Intensity Thresholds",icon:ht,minConfig:{label:"Min",unit:"lux",value:s&&s.light&&typeof s.light.min<"u"?s.light.min:te.light.min,onChange:x=>p("light","min",x.target.value),min:0,max:2e3,step:10},maxConfig:{label:"Max",unit:"lux",value:s&&s.light&&typeof s.light.max<"u"?s.light.max:te.light.max,onChange:x=>p("light","max",x.target.value),min:0,max:2e3,step:10}})}),r.jsx("div",{className:"col-span-2",children:r.jsx(Ne,{title:"Battery Protection",icon:ct,minConfig:{label:"Min",unit:"%",value:s&&s.battery&&typeof s.battery.min<"u"?s.battery.min:te.battery.min,onChange:x=>p("battery","min",x.target.value),min:0,max:100,step:1}})})]})}),r.jsxs("div",{className:"self-start lg:pl-4 lg:col-span-4 flex flex-col justify-between h-full space-y-4",children:[r.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-4 ",children:[r.jsx("div",{className:"flex items-center justify-between mb-3",children:r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("span",{className:" ml-8 text-lg font-semibold text-gray-800",children:"Current Status"})})}),r.jsxs("div",{className:"px-4 grid grid-cols-2 gap-3 text-sm text-gray-700",children:[(()=>{const x=M("moisture");return r.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[r.jsx(ft,{className:`w-4 h-4 ${x.icon}`}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Moisture"}),r.jsxs("div",{className:`font-medium ${x.value}`,children:[String(N.moisture),"%"]})]})]})})(),(()=>{const x=M("temperature");return r.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[r.jsx(pt,{className:`w-4 h-4 ${x.icon}`}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Temperature"}),r.jsxs("div",{className:`font-medium ${x.value}`,children:[String(N.temperature),"Â°C"]})]})]})})(),(()=>{const x=M("humidity");return r.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[r.jsx(dt,{className:`w-4 h-4 ${x.icon}`}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Humidity"}),r.jsxs("div",{className:`font-medium ${x.value}`,children:[String(N.humidity),"%"]})]})]})})(),(()=>{const x=M("light");return r.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[r.jsx(ht,{className:`w-4 h-4 ${x.icon}`}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Light"}),r.jsxs("div",{className:`font-medium ${x.value}`,children:[String(N.light)," lux"]})]})]})})(),(()=>{const x=M("battery");return r.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[r.jsx(ct,{className:`w-4 h-4 ${x.icon}`}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Battery"}),r.jsxs("div",{className:`font-medium ${x.value}`,children:[String(N.battery),"%"]})]})]})})(),(()=>{const x=a?"text-green-600":"text-gray-600",b=a?"text-green-600":"text-gray-700";return r.jsxs("div",{className:`flex items-center gap-2 ${a?"bg-green-50 rounded p-2":""}`,children:[r.jsx(Ws,{className:`w-4 h-4 ${x}`}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Pump"}),r.jsx("div",{className:`font-medium ${b}`,children:a?"ON":"OFF"})]})]})})()]})]}),r.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-6 h-full w-full lg:w-auto",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(Us,{className:"w-6 h-6 text-gray-600"}),r.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"Pump Control"})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 flex flex-col gap-4",children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx(Ur,{enabled:o,onToggle:j})}),r.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex flex-col items-start",children:[r.jsx("div",{className:"font-semibold text-gray-700",children:"Manual Control"}),r.jsxs("div",{className:"flex flex-col items-start gap-1 mt-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),r.jsx("span",{className:`font-bold ${a?"text-green-600":"text-gray-700"}`,children:a?"ON":"OFF"})]}),r.jsx("div",{children:r.jsx("span",{className:`${o?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"} text-xs px-2 py-0.5 rounded`,children:o?"auto":"manual"})})]})]}),r.jsxs("button",{onClick:C,"aria-pressed":a,disabled:o,className:`flex items-center gap-3 px-6 py-3 rounded-lg font-bold text-white shadow-md transition-all focus:outline-none ${a?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 2v10"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.5 7.5a8.5 8.5 0 1013 0"})]}),a?"Turn OFF":"Turn ON"]})]})]})]}),r.jsxs("div",{className:"flex flex-col items-center mt-6",children:[r.jsx(Pr,{onClick:_,className:"w-full",children:"Save Settings"}),d&&r.jsx("div",{className:"text-center text-sm text-green-600 mt-4",children:d})]})]})]})})]})}),r.jsx(Br,{open:u,errors:y,onClose:()=>f(!1)})]})})};function Wr(){const{jwtToken:t}=Le(),{addNotification:e}=Qe(),[s,n]=w.useState(()=>localStorage.getItem("activeTab")||"dashboard"),o="device0011233",[i,a]=w.useState(()=>localStorage.getItem("selectedDevice")||o),[l,d]=w.useState({moisture:0,temperature:0,humidity:0,light:0,battery:0,pumpStatus:"OFF",pumpMode:"manual"}),[c,u]=w.useState(!1),[f,y]=w.useState(()=>{try{const g=localStorage.getItem(`settings_${i}`);return g?JSON.parse(g):{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1}}catch{return{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1}}});w.useEffect(()=>{try{window.__latestLiveData=l,window.dispatchEvent(new CustomEvent("live:update",{detail:l}))}catch{}},[l]);const O=oe.useRef(null);oe.useEffect(()=>{try{const g=O.current||{},p=l||{};let j=null;try{const v=localStorage.getItem(`settings_${i}`);v&&(j=JSON.parse(v).thresholds||null)}catch{}const C=["moisture","temperature","humidity","light","battery"],N=(v,T)=>{if(T==null||String(T)==="unknown")return!0;const M=Number(T);if(Number.isNaN(M))return!0;const _=j&&j[v]||null,q=_&&typeof _.min<"u"?Number(_.min):void 0,J=_&&typeof _.max<"u"?Number(_.max):void 0;return typeof q<"u"&&!Number.isNaN(q)&&M<q||typeof J<"u"&&!Number.isNaN(J)&&M>J};if(C.forEach(v=>{const T=N(v,g[v]),M=N(v,p[v]);if(!T&&M)try{e({type:"critical",message:`Critical: ${v}=${p[v]}`,timestamp:new Date().toISOString(),meta:{deviceId:i,sensor:v,value:p[v]}})}catch{}}),(g.pumpStatus||"")!==(p.pumpStatus||"")){const v=p.pumpMode||(f&&f.autoMode?"auto":"manual")||"manual";try{e({type:"pump:status",message:`Pump ${p.pumpStatus} (${v})`,timestamp:new Date().toISOString(),meta:{deviceId:i,mode:v}})}catch{}}}catch{}finally{O.current=l}},[l,i,e,f]),w.useEffect(()=>{localStorage.setItem("activeTab",s)},[s]),w.useEffect(()=>{localStorage.setItem("selectedDevice",i)},[i]),w.useEffect(()=>{try{const g=localStorage.getItem(`settings_${i}`);y(g?JSON.parse(g):{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1})}catch(g){console.warn("[App] Failed to load settings",g)}},[i]),w.useEffect(()=>{const g=p=>{try{const j=p?.detail?.deviceId;if(!j||j!==i)return;const C=localStorage.getItem(`settings_${i}`);C&&y(JSON.parse(C))}catch(j){console.error("[App] onSettingsUpdated",j)}};return window.addEventListener("settings:updated",g),()=>window.removeEventListener("settings:updated",g)},[i]);const h=w.useRef({cmd:null,ts:0});return w.useEffect(()=>{try{if(!f||!f.autoMode)return;const g=l?.moisture;if(g==null)return;const p=Number(g);if(!isFinite(p))return;let j=parseFloat(f.moistureMin);isNaN(j)&&(j=20);const C=p<=j?"ON":"OFF",N=Date.now(),v=h.current;if(v.cmd===C&&N-v.ts<5e3||!i||(l?.pumpStatus||"").toUpperCase()===C)return;console.log("[App] AUTO MODE: sending pump command",{device:i,desired:C,moisture:p,min:j}),Rr(i,C,"pump","auto").then(M=>{h.current={cmd:C,ts:Date.now()},console.log("[App] AUTO MODE: pump command response",M)}).catch(M=>{console.error("[App] AUTO MODE: pump command failed",M)})}catch(g){console.warn("[App] auto control failed",g)}},[f?.autoMode,l?.moisture,i,l?.pumpStatus]),w.useEffect(()=>{if(!t)return;se.connect(t).then(()=>console.log("[App] WebSocket connected (global)")).catch(N=>console.warn("[App] WebSocket connect failed",N));const g=()=>u(!0),p=()=>u(!1);se.onConnect(g),se.onDisconnect(p);const j=N=>{d(v=>{const T={...v};if(N.sensorType==="batchUpdate"){const M=N.value||{};M.temp!==void 0&&(T.temperature=parseFloat(M.temp)),M.humidity!==void 0&&(T.humidity=parseFloat(M.humidity)),M.battery!==void 0&&(T.battery=parseFloat(M.battery)),M.light!==void 0&&(T.light=parseFloat(M.light)),M.moisture!==void 0&&(T.moisture=parseFloat(M.moisture))}else switch(N.sensorType){case"temp":T.temperature=parseFloat(N.value);break;case"humidity":T.humidity=parseFloat(N.value);break;case"battery":T.battery=parseFloat(N.value);break;case"light":T.light=parseFloat(N.value);break;case"moisture":T.moisture=parseFloat(N.value);break;case"pumpStatus":T.pumpStatus=N.value;break;case"pumpMode":T.pumpMode=N.value;break}return T})},C=()=>{try{se.subscribeToDevice(i,j)}catch(N){console.warn("[App] subscribeToDevice failed",N)}};try{se.getConnectionStatus()&&C()}catch{}return se.onConnect(()=>C()),()=>{try{se.offConnect(g),se.offDisconnect(p),se.unsubscribeFromDevice(i)}catch(N){console.warn("[App] cleanup failed",N)}}},[t,i]),r.jsx(As,{children:r.jsxs("div",{className:"App",children:[r.jsx(Gs,{activeTab:s,setActiveTab:n,selectedDevice:i,setSelectedDevice:a,isConnected:c}),r.jsx("div",{className:"pt-24"}),s==="dashboard"?r.jsx(_r,{deviceId:i,liveData:l,settings:f,isConnected:c}):r.jsx(Hr,{deviceId:i})]})})}const qr=()=>"https://api.protonestconnect.co/api/v1/user",$t=qr(),zr=async(t,e)=>{try{const s=t.trim(),n=e.trim();if(!s.includes("@"))throw new Error("Invalid email format");console.log("ðŸ”„ Making secure authentication request to:",$t),console.log("ðŸ“‹ IMPORTANT: Using secretKey as password (not login password)");const o={email:s,password:n};console.log("ðŸ”„ Attempting /get-token with documented payload structure:",{email:s,passwordType:"secretKey",passwordLength:n.length});try{const i=await H.post(`${$t}/get-token`,o,{headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(console.log("ðŸ“¡ API Response from /get-token (Success):",i.data),i.data.status==="Success"){const a=i.data.data?.jwtToken,l=i.data.data?.refreshToken;if(!a)throw new Error("No JWT token in response data");return console.log("âœ… Login successful via /get-token. JWT token received securely."),{jwtToken:a,refreshToken:l,userId:s}}else throw new Error(`Authentication failed: ${i.data.message||"Unexpected response status"}`)}catch(i){if(i.response?.status===400){const a=i.response.data;throw console.error("âŒ Authentication failed (400):",{serverResponse:JSON.stringify(a,null,2),possibleCauses:["Invalid email format - check email address","Invalid credentials - verify email is registered","Wrong secretKey - check Protonest dashboard for correct secretKey","User not found - email not registered in system","Email not verified - check email verification status"]}),a?.data==="Invalid email format"?new Error("Invalid email format. Please check the email address."):a?.data==="Invalid credentials"?new Error("Invalid credentials. Please verify the email and secretKey from Protonest dashboard."):a?.data==="User not found"?new Error("User not found. Please check if the email is registered in the system."):a?.data==="Email not verified"?new Error("Email not verified. Please verify your email address first."):new Error(`Authentication failed: ${a?.data||"Please verify email and secretKey"}`)}else throw i.response?.status===500?(console.error("âŒ Server error (500):",i.response.data),new Error("Internal server error. Please try again later.")):(console.error(`âŒ Unexpected error (${i.response?.status}):`,i.response?.data),i)}}catch(s){throw console.error("âŒ Login process failed:",{message:s.message,email:t?.trim(),hasPassword:!0,passwordLength:e?.length||0}),s}},Oe="ratnaabinayansn@gmail.com",It="6M3@pwYvBGRVJLN",Jr=({children:t})=>{const{setAuth:e}=Le(),[s,n]=oe.useState(!1),[o,i]=oe.useState(!0);return oe.useEffect(()=>{if(s)return;n(!0),(async()=>{try{console.log("ðŸ”‘ Attempting auto login with real credentials..."),console.log("ðŸ“§ Email:",Oe),console.log("ðŸ” SecretKey length:",It.length);const l=await zr(Oe,It);console.log("âœ… Auto login successful. Ready for connection."),e({userId:l.userId||Oe,jwtToken:l.jwtToken}),l.refreshToken&&localStorage.setItem("refreshToken",l.refreshToken)}catch(l){console.warn("âš ï¸ Auto login failed. Using mock data for development."),console.error("Auto login error details:",l.message),l.message.includes("Invalid credentials")&&console.error("ðŸ”§ Credentials may be incorrect or expired. Please verify from Protonest dashboard"),e({userId:Oe,jwtToken:"MOCK_TOKEN_FOR_TESTING"})}finally{i(!1)}})()},[e,s]),o?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Authenticating with Protonest API..."}),r.jsx("p",{className:"text-blue-600 text-sm mt-2",children:"âœ… Using real credentials"})]})}):t};Ms.createRoot(document.getElementById("root")).render(r.jsx(Os,{children:r.jsx(Jr,{children:r.jsx(ys,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:r.jsx(Vs,{children:r.jsx(Wr,{})})})})}));
