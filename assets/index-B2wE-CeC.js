import{a as ys,b as bs,g as ws,R as ne,r as w,H as vs}from"./vendor-BjY53brD.js";import{C as Ns}from"./websocket-ImiZJucQ.js";import{R as js,L as Ss,C as ks,X as Cs,Y as lt,T as Ts,a as ye}from"./charts-DBFlZrrq.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var We={exports:{}},be={};var ct;function Es(){if(ct)return be;ct=1;var t=ys(),e=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(l,d,c){var u,f={},y=null,R=null;c!==void 0&&(y=""+c),d.key!==void 0&&(y=""+d.key),d.ref!==void 0&&(R=d.ref);for(u in d)r.call(d,u)&&!i.hasOwnProperty(u)&&(f[u]=d[u]);if(l&&l.defaultProps)for(u in d=l.defaultProps,d)f[u]===void 0&&(f[u]=d[u]);return{$$typeof:e,type:l,key:y,ref:R,props:f,_owner:o.current}}return be.Fragment=s,be.jsx=a,be.jsxs=a,be}var ut;function Ms(){return ut||(ut=1,We.exports=Es()),We.exports}var n=Ms(),Me={},dt;function Os(){if(dt)return Me;dt=1;var t=bs();return Me.createRoot=t.createRoot,Me.hydrateRoot=t.hydrateRoot,Me}var As=Os();const Rs=ws(As);class Ds extends ne.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Error caught by boundary:",e,s)}render(){return this.state.hasError?n.jsx("div",{className:"min-h-screen bg-red-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md",children:[n.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"âš ï¸ Application Error"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"The dashboard encountered an error and had to reload."}),n.jsx("p",{className:"text-sm text-gray-500 mb-6 font-mono break-words",children:this.state.error?.toString()}),n.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Reload Page"})]})}):this.props.children}}const Ut=w.createContext({userId:"",jwtToken:"",setAuth:()=>{},logout:()=>{}}),Le=()=>w.useContext(Ut),$s=({children:t})=>{const[e,s]=w.useState(localStorage.getItem("userId")||""),[r,o]=w.useState(localStorage.getItem("jwtToken")||""),l={userId:e,jwtToken:r,setAuth:({userId:d,jwtToken:c})=>{s(d),o(c),localStorage.setItem("jwtToken",c),localStorage.setItem("userId",d),console.log("âœ… Auth state updated:",{userId:d,hasToken:!!c})},logout:()=>{s(""),o(""),localStorage.clear(),window.location.href="/"}};return n.jsx(Ut.Provider,{value:l,children:t})};var Is={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ls=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Fs=(t,e)=>{const s=w.forwardRef(({color:r="currentColor",size:o=24,strokeWidth:i=2,absoluteStrokeWidth:a,children:l,...d},c)=>w.createElement("svg",{ref:c,...Is,width:o,height:o,stroke:r,strokeWidth:a?Number(i)*24/Number(o):i,className:`lucide lucide-${Ls(t)}`,...d},[...e.map(([u,f])=>w.createElement(u,f)),...(Array.isArray(l)?l:[l])||[]]));return s.displayName=`${t}`,s};var H=Fs;const Bt=H("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),_s=H("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),mt=H("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),ft=H("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Ps=H("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ht=H("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),Us=H("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),pt=H("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),gt=H("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),Bs=H("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Hs=H("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ws=H("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),xt=H("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),Ge=H("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),qs=H("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),zs=H("Power",[["path",{d:"M18.36 6.64a9 9 0 1 1-12.73 0",key:"phirl6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"12",key:"aemgbe"}]]),Js=H("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),Vs=H("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),Ze=H("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),qe=H("Sprout",[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]]),yt=H("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),bt=H("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),Ht=H("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Wt=H("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),qt=w.createContext(null);let ze=1;const wt="app_notifications_v1",Ks=({children:t})=>{const[e,s]=w.useState(()=>{try{const a=localStorage.getItem(wt);if(a){const l=JSON.parse(a);if(Array.isArray(l)&&l.length>0){const d=l.reduce((c,u)=>Math.max(c,u.id||0),0);ze=Math.max(ze,d+1)}return l}}catch{}return[]});w.useEffect(()=>{try{localStorage.setItem(wt,JSON.stringify(e))}catch{}},[e]);const r=w.useCallback(a=>{const l={id:ze++,type:a?.type||"info",message:a?.message||"",meta:a?.meta||{},timestamp:a?.timestamp||new Date().toISOString(),read:!1};return s(d=>[l,...d].slice(0,1e3)),l.id},[]),o=w.useCallback(a=>{s(l=>l.map(d=>d.id===a?{...d,read:!0}:d))},[]),i=w.useCallback(a=>{if(!a){s([]);return}s(l=>l.filter(d=>(d.meta&&d.meta.deviceId)!==a))},[]);return n.jsx(qt.Provider,{value:{notifications:e,addNotification:r,markRead:o,clearAll:i},children:t})},st=()=>{const t=w.useContext(qt);if(!t)throw new Error("useNotifications must be used within NotificationProvider");return t},Xs=t=>{if(!t)return console.error("âŒ Cannot build WebSocket URL: No JWT token available"),null;const e=encodeURIComponent(t),s=`wss://api.protonestconnect.co/ws?token=${e}`;return console.log("ðŸ”Œ WebSocket URL built:",s.replace(e,"***TOKEN***")),s};class Gs{constructor(){this.client=null,this.currentDeviceId=null,this.subscriptions=new Map,this.dataCallback=null,this.connectCallbacks=[],this.disconnectCallbacks=[],this.isReady=!1,this.jwtToken=null}_initializeClient(e){if(this.client){console.log("[WebSocketClient] Client already initialized");return}const s=Xs(e);if(!s)throw new Error("Failed to build WebSocket URL - invalid token");this.client=new Ns({brokerURL:s,reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:r=>{console.log("âœ… WebSocket Connected:",r),this.isReady=!0,this.currentDeviceId&&this._subscribeToDeviceTopics(this.currentDeviceId),Array.isArray(this.connectCallbacks)&&this.connectCallbacks.length>0&&this.connectCallbacks.forEach(o=>{try{o()}catch(i){console.warn("[WebSocketClient] connect callback failed",i)}})},onStompError:r=>{console.error("âŒ Broker reported error:",r.headers.message),console.error("Details:",r.body)},onWebSocketError:r=>{console.error("ðŸš« WebSocket error",r)},onWebSocketClose:r=>{console.warn("ðŸ”» WebSocket closed",r),this.isReady=!1,Array.isArray(this.disconnectCallbacks)&&this.disconnectCallbacks.length>0&&this.disconnectCallbacks.forEach(o=>{try{o()}catch(i){console.warn("[WebSocketClient] disconnect callback failed",i)}})},debug:r=>console.log("ðŸªµ Debug:",r)}),this.client.activate(),console.log("[WebSocketClient] STOMP client activated")}_subscribeToDeviceTopics(e){const s=this,r=`/topic/stream/${e}`,o=this.client.subscribe(r,l=>{const d=JSON.parse(l.body);if(console.log(`ðŸ“¡ [${e}] Received stream data:`,d),s.dataCallback){const c=d.payload||d,u=d.topic,f={temp:"temp",temperature:"temp",humidity:"humidity",moisture:"moisture",light:"light",battery:"battery"},R=Object.keys(f).filter(h=>c[h]!==void 0);if(R.length>2){console.log(`ðŸŽ¯ [${e}] Received BATCH state update with ${R.length} sensors`);const h={};R.forEach(g=>{const p=f[g];h[p]=c[g],console.log(`   - ${p}: ${c[g]}`)}),s.dataCallback({sensorType:"batchUpdate",value:h,timestamp:d.timestamp||new Date().toISOString()})}else{let h=!1;if(u&&c[u]!==void 0){const g=f[u]||u;console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: ${g} = ${c[u]}`),s.dataCallback({sensorType:g,value:c[u],timestamp:d.timestamp||new Date().toISOString()}),h=!0}else for(const[g,p]of Object.entries(f))c[g]!==void 0&&(console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: ${p} = ${c[g]}`),s.dataCallback({sensorType:p,value:c[g],timestamp:d.timestamp||new Date().toISOString()}),h=!0);h||console.warn(`âš ï¸ [${e}] No recognized sensor field in message:`,d)}}else console.warn(`âš ï¸ [${e}] No callback registered yet - data will be lost:`,d)});this.subscriptions.set(`stream-${e}`,o),console.log(`ðŸ”” Subscribed to ${r}`);const i=`/topic/state/${e}`,a=this.client.subscribe(i,l=>{const d=JSON.parse(l.body);console.log(`ðŸ”§ [${e}] Pump state received:`,d);const c=d.payload||d;if(s.dataCallback){const u=c.power||c.status||c.pumpStatus;if(u!==void 0){const y=String(u).toUpperCase();console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: pumpStatus = ${y}`),s.dataCallback({sensorType:"pumpStatus",value:y,timestamp:d.timestamp||new Date().toISOString()})}const f=c.mode||c.pumpMode;if(f!==void 0){const y=String(f).toLowerCase();console.log(`ðŸŽ¯ [${e}] Calling Dashboard callback: pumpMode = ${y}`),s.dataCallback({sensorType:"pumpMode",value:y,timestamp:d.timestamp||new Date().toISOString()})}}});this.subscriptions.set(`state-${e}`,a),console.log(`ðŸ”” Subscribed to ${i}`)}_unsubscribeFromDeviceTopics(e){const s=`stream-${e}`,r=`state-${e}`;this.subscriptions.has(s)&&(this.subscriptions.get(s).unsubscribe(),this.subscriptions.delete(s),console.log(`ðŸ”• Unsubscribed from /topic/stream/${e}`)),this.subscriptions.has(r)&&(this.subscriptions.get(r).unsubscribe(),this.subscriptions.delete(r),console.log(`ðŸ”• Unsubscribed from /topic/state/${e}`))}unsubscribeFromDevice(e){try{this._unsubscribeFromDeviceTopics(e)}catch(s){console.warn("[WebSocketClient] Failed to unsubscribe from device",e,s)}}async connect(e){if(!e)throw console.error("[WebSocketClient] âŒ Cannot connect: No JWT token provided"),new Error("JWT token required for WebSocket connection");return this.jwtToken=e,this.client?this.isConnected?console.log("[WebSocketClient] âœ… Already connected"):(console.log("[WebSocketClient] ðŸ”„ Reconnecting..."),this.client.activate()):(console.log("[WebSocketClient] ðŸ”„ Initializing STOMP client..."),this._initializeClient(e)),Promise.resolve()}subscribeToDevice(e,s){return this.currentDeviceId&&this.currentDeviceId!==e&&(console.log(`[WebSocketClient] ðŸ”„ Switching from ${this.currentDeviceId} to ${e}`),this._unsubscribeFromDeviceTopics(this.currentDeviceId)),this.currentDeviceId=e,this.dataCallback=s,console.log(`[WebSocketClient] Callback registered for device: ${e}`),this.isReady&&this.isConnected?this._subscribeToDeviceTopics(e):console.log(`[WebSocketClient] Will subscribe to ${e} when connection is ready`),!0}get isConnected(){return this.client?.connected||!1}getConnectionStatus(){return this.isConnected}onConnect(e){if(typeof e=="function"&&(this.connectCallbacks.push(e),this.isConnected))try{e()}catch(s){console.warn("[WebSocketClient] onConnect immediate call failed",s)}}offConnect(e){e&&(this.connectCallbacks=this.connectCallbacks.filter(s=>s!==e))}onDisconnect(e){typeof e=="function"&&this.disconnectCallbacks.push(e)}offDisconnect(e){e&&(this.disconnectCallbacks=this.disconnectCallbacks.filter(s=>s!==e))}sendPumpCommand(e,s,r=null){if(!this.isConnected)return console.warn("[WebSocketClient] Cannot send command - not connected"),!1;const o=`protonest/${e}/state/motor/paddy`,i={power:s.toLowerCase()};r&&(i.mode=r.toLowerCase());try{return this.client.publish({destination:o,body:JSON.stringify(i)}),console.log("[WebSocketClient] ðŸ“¤ Sent pump command:",i),!0}catch(a){return console.error("[WebSocketClient] âŒ Failed to send pump command:",a),!1}}disconnect(){this.client&&this.isConnected?(console.log("[WebSocketClient] ðŸ”Œ Disconnecting..."),this.currentDeviceId&&this._unsubscribeFromDeviceTopics(this.currentDeviceId),this.client.deactivate(),this.isReady=!1):console.log("[WebSocketClient] Already disconnected")}enableTestingMode(){typeof window>"u"||(window.sendPumpCommand=(e,s=null)=>this.currentDeviceId?this.sendPumpCommand(this.currentDeviceId,e,s):(console.error("âŒ No device selected. Subscribe to a device first."),!1),window.simulateSensorData=(e,s)=>{if(!this.isConnected)return console.error("âŒ Not connected"),!1;if(!this.currentDeviceId)return console.error("âŒ No device selected. Subscribe to a device first."),!1;const r=`protonest/${this.currentDeviceId}/stream/${e}`,o={[e]:String(s)};try{return this.client.publish({destination:r,body:JSON.stringify(o)}),console.log("ðŸ“¤ Simulated:",o),!0}catch(i){return console.error("âŒ Failed:",i),!1}},window.wsInfo=()=>{console.log("ðŸ“Š WebSocket Info:"),console.log("   Connected:",this.isConnected),console.log("   Current Device:",this.currentDeviceId||"None"),console.log("   Active Subscriptions:",Array.from(this.subscriptions.keys()))},console.log(""),console.log("ðŸ§ª Testing Mode Enabled!"),console.log('   sendPumpCommand("on")'),console.log('   sendPumpCommand("off")'),console.log('   simulateSensorData("temp", 25.5)'),console.log("   wsInfo()"),console.log(""))}}const se=new Gs,Zs=({deviceId:t,deviceList:e,activeTab:s,setActiveTab:r,selectedDevice:o,setSelectedDevice:i,isConnected:a,alertMessage:l})=>{const[d,c]=w.useState(()=>{if(typeof a<"u")return!!a;try{return!!se.getConnectionStatus()}catch{return!1}});w.useEffect(()=>{if(typeof a<"u"){c(!!a);return}const T=setInterval(()=>{try{const P=!!se.getConnectionStatus();c(P)}catch{c(!1)}},1e3);return()=>clearInterval(T)},[a]);const u=d?"green":"red",f=d?"green":"red",y=d?"green":"yellow",R={green:"Online",yellow:"Limited",red:"Offline"},h=(T,P,q)=>{const V=T==="green"?"text-green-500":T==="yellow"?"text-yellow-500":"text-red-500";return n.jsxs("div",{className:"relative group flex items-center",children:[n.jsx(P,{className:`w-5 h-5 ${V}`}),n.jsx("span",{className:"sr-only",children:q}),n.jsxs("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-2 px-2 py-1 rounded bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-50 shadow-lg transition-opacity duration-200",children:[q,": ",R[T]]})]})},{userId:g,logout:p}=Le(),j=e||["device9988","device0011233","device0000","device0001"],C=o||localStorage.getItem("selectedDevice")||j[0],v=T=>{const P=T.target.value;localStorage.setItem("selectedDevice",P),typeof i=="function"&&i(P)},[S,M]=w.useState(!1),O=w.useRef();return ne.useEffect(()=>{const T=P=>{O.current&&(O.current.contains(P.target)||M(!1))};return document.addEventListener("click",T),()=>document.removeEventListener("click",T)},[]),n.jsx("header",{className:"fixed inset-x-0 top-4 flex justify-center z-50",children:n.jsxs("div",{className:"w-[calc(100%-2rem)] max-w-7xl bg-white border-2 rounded-lg px-4 py-2 flex flex-col sm:flex-row justify-between items-center shadow-sm",children:[n.jsxs("div",{className:"w-full flex items-center justify-between sm:hidden mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{"aria-label":"Open menu",onClick:()=>M(T=>!T),className:"p-2 rounded-md hover:bg-gray-100",children:n.jsx("svg",{className:"w-6 h-6 text-gray-700",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("path",{d:"M4 6h16M4 12h16M4 18h16"})})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qe,{className:"h-6 w-6 text-green-600"}),n.jsxs("span",{className:"text-lg font-bold tracking-wide font-mono",children:["Agri",n.jsx("span",{className:"text-yellow-400",children:"Cop"})]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx(Je,{selectedDevice:C})})]}),S&&n.jsx("div",{ref:O,className:"sm:hidden absolute left-4 right-4 top-20 bg-white border rounded shadow-lg z-50 px-4 py-3",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qe,{className:"h-5 w-5 text-green-600"}),n.jsx("div",{className:"font-semibold",children:"AgriCop"})]}),n.jsx("button",{onClick:()=>M(!1),className:"text-gray-500",children:"Close"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>{M(!1),typeof r=="function"&&r("dashboard")},className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100",children:[" ",n.jsx(xt,{className:"w-4 h-4"})," Dashboard"]}),n.jsxs("button",{onClick:()=>{M(!1),typeof r=="function"&&r("settings")},className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100",children:[" ",n.jsx(Ze,{className:"w-4 h-4"})," Settings"]})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Select Device"}),n.jsx("select",{value:C||"",onChange:v,className:"w-full mt-1 bg-white border border-green-300 text-gray-700 py-2 px-3 rounded focus:ring-2 focus:ring-green-500 outline-none",children:j.map(T=>n.jsx("option",{value:T,children:T},T))})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[n.jsxs("div",{className:"text-xs text-gray-600",children:["User: ",g]}),n.jsx("button",{onClick:p,className:"text-red-500 text-sm",children:"Logout"})]})]})}),n.jsxs("div",{className:"hidden sm:flex items-center gap-4 mb-4 sm:mb-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>typeof r=="function"?r("dashboard"):null,className:`flex items-center justify-center w-8 h-8 rounded-lg transition border-none focus:outline-none ${s==="dashboard"?"bg-blue-50 text-blue-600 shadow-sm":"bg-transparent text-gray-500 hover:bg-gray-100"}`,title:"Dashboard","aria-label":"Dashboard","aria-current":s==="dashboard"?"page":void 0,children:[n.jsx(xt,{className:"w-4 h-4"}),n.jsx("span",{className:"sr-only",children:"Dashboard"})]}),n.jsxs("button",{onClick:()=>typeof r=="function"?r("settings"):null,className:`flex items-center justify-center w-8 h-8 rounded-lg transition border-none focus:outline-none ${s==="settings"?"bg-blue-50 text-blue-600 shadow-sm":"bg-transparent text-gray-500 hover:bg-gray-100"}`,title:"Device Settings","aria-label":"Device Settings","aria-current":s==="settings"?"page":void 0,children:[n.jsx(Ze,{className:"w-4 h-4"}),n.jsx("span",{className:"sr-only",children:"Device Settings"})]})]}),n.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[n.jsx(qe,{className:"h-6 w-6 text-green-600"}),n.jsxs("span",{className:"text-2xl font-bold tracking-wide font-mono",children:["Agri",n.jsx("span",{className:"text-yellow-400",children:"Cop"})]})]}),n.jsxs("div",{className:"text-left text-xs ml-4",children:[n.jsx("div",{className:"text-green-600 font-bold",children:"Authentication: Successful"}),n.jsxs("div",{className:"text-gray-600 font-mono",children:["User: ",g]}),n.jsxs("button",{onClick:p,className:"text-red-500 hover:underline mt-1 flex items-center gap-1",children:["Logout ",n.jsx(qs,{className:"w-3 h-3"})]})]})]}),n.jsx("div",{className:"flex-1 flex justify-center items-center mb-4 sm:mb-0",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Select Device:"}),n.jsx("select",{value:C||"",onChange:v,className:"bg-white border border-green-300 text-gray-700 py-1 px-2 rounded focus:ring-2 focus:ring-green-500 outline-none font-medium",children:j.map(T=>n.jsx("option",{value:T,children:T},T))})]})}),n.jsxs("div",{className:"hidden sm:flex items-center gap-4 ml-6",children:[h(u,Ht,"WebSocket"),h(f,Js,"MQTT"),h(y,Vs,"System")]}),n.jsxs("div",{className:"flex items-center gap-4 ml-8",children:[n.jsx("div",{className:"hidden sm:block",children:n.jsx(Je,{selectedDevice:C})}),n.jsx("div",{className:"sm:hidden",children:n.jsx(Je,{selectedDevice:C})})]})]})})},Je=({selectedDevice:t})=>{const{notifications:e,markRead:s,clearAll:r}=st(),[o,i]=ne.useState(!1),a=w.useRef();ne.useEffect(()=>{const u=f=>{a.current&&(a.current.contains(f.target)||i(!1))};return document.addEventListener("click",u),()=>document.removeEventListener("click",u)},[]);const l=e.filter(u=>{const f=u.meta&&u.meta.deviceId?u.meta.deviceId:null;return f===null||f===t}),d=l.filter(u=>!u.read).length,c=u=>u==="critical"?n.jsx(_s,{className:"w-4 h-4 text-red-600"}):u&&u.startsWith("pump")?n.jsx(Bt,{className:"w-4 h-4 text-blue-600"}):n.jsx(ft,{className:"w-4 h-4 text-gray-600"});return n.jsxs("div",{className:"relative",ref:a,children:[n.jsxs("button",{onClick:()=>i(u=>!u),className:"relative group",title:"View Alerts","aria-haspopup":"true",children:[n.jsx(ft,{className:"w-6 h-6 text-gray-500 hover:text-yellow-500 transition"}),d>0&&n.jsx("span",{className:"absolute -top-1 -right-1 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full",children:d})]}),o&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 max-h-96 overflow-auto bg-white border rounded shadow-lg z-50",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("div",{className:"font-semibold",children:"Notifications"}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("button",{onClick:()=>{r(t)},className:"text-xs text-gray-500 hover:underline",children:"Clear"})})]}),n.jsxs("ul",{className:"divide-y",children:[l.length===0&&n.jsx("li",{className:"p-3 text-sm text-gray-500",children:"No notifications"}),l.map(u=>n.jsx("li",{className:`p-3 text-sm ${u.read?"bg-white":"bg-gray-50"}`,children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:c(u.type)}),n.jsxs("div",{className:"truncate",children:[n.jsx("div",{className:`font-medium ${u.type==="critical"?"text-red-700":"text-gray-800"}`,children:u.message}),n.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(u.timestamp).toLocaleString()})]}),n.jsx("div",{className:"ml-2",children:!u.read&&n.jsx("button",{onClick:()=>s(u.id),className:"text-xs text-blue-600",children:"Mark"})})]})},u.id))]})]})]})};function zt(t,e){return function(){return t.apply(e,arguments)}}const{toString:Ys}=Object.prototype,{getPrototypeOf:nt}=Object,{iterator:Fe,toStringTag:Jt}=Symbol,_e=(t=>e=>{const s=Ys.call(e);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),re=t=>(t=t.toLowerCase(),e=>_e(e)===t),Pe=t=>e=>typeof e===t,{isArray:ge}=Array,pe=Pe("undefined");function Se(t){return t!==null&&!pe(t)&&t.constructor!==null&&!pe(t.constructor)&&Q(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Vt=re("ArrayBuffer");function Qs(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Vt(t.buffer),e}const en=Pe("string"),Q=Pe("function"),Kt=Pe("number"),ke=t=>t!==null&&typeof t=="object",tn=t=>t===!0||t===!1,Re=t=>{if(_e(t)!=="object")return!1;const e=nt(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Jt in t)&&!(Fe in t)},sn=t=>{if(!ke(t)||Se(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},nn=re("Date"),rn=re("File"),on=re("Blob"),an=re("FileList"),ln=t=>ke(t)&&Q(t.pipe),cn=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Q(t.append)&&((e=_e(t))==="formdata"||e==="object"&&Q(t.toString)&&t.toString()==="[object FormData]"))},un=re("URLSearchParams"),[dn,mn,fn,hn]=["ReadableStream","Request","Response","Headers"].map(re),pn=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ce(t,e,{allOwnKeys:s=!1}={}){if(t===null||typeof t>"u")return;let r,o;if(typeof t!="object"&&(t=[t]),ge(t))for(r=0,o=t.length;r<o;r++)e.call(null,t[r],r,t);else{if(Se(t))return;const i=s?Object.getOwnPropertyNames(t):Object.keys(t),a=i.length;let l;for(r=0;r<a;r++)l=i[r],e.call(null,t[l],l,t)}}function Xt(t,e){if(Se(t))return null;e=e.toLowerCase();const s=Object.keys(t);let r=s.length,o;for(;r-- >0;)if(o=s[r],e===o.toLowerCase())return o;return null}const ue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Gt=t=>!pe(t)&&t!==ue;function Ye(){const{caseless:t,skipUndefined:e}=Gt(this)&&this||{},s={},r=(o,i)=>{const a=t&&Xt(s,i)||i;Re(s[a])&&Re(o)?s[a]=Ye(s[a],o):Re(o)?s[a]=Ye({},o):ge(o)?s[a]=o.slice():(!e||!pe(o))&&(s[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&Ce(arguments[o],r);return s}const gn=(t,e,s,{allOwnKeys:r}={})=>(Ce(e,(o,i)=>{s&&Q(o)?t[i]=zt(o,s):t[i]=o},{allOwnKeys:r}),t),xn=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),yn=(t,e,s,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),s&&Object.assign(t.prototype,s)},bn=(t,e,s,r)=>{let o,i,a;const l={};if(e=e||{},t==null)return e;do{for(o=Object.getOwnPropertyNames(t),i=o.length;i-- >0;)a=o[i],(!r||r(a,t,e))&&!l[a]&&(e[a]=t[a],l[a]=!0);t=s!==!1&&nt(t)}while(t&&(!s||s(t,e))&&t!==Object.prototype);return e},wn=(t,e,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=e.length;const r=t.indexOf(e,s);return r!==-1&&r===s},vn=t=>{if(!t)return null;if(ge(t))return t;let e=t.length;if(!Kt(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=t[e];return s},Nn=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&nt(Uint8Array)),jn=(t,e)=>{const r=(t&&t[Fe]).call(t);let o;for(;(o=r.next())&&!o.done;){const i=o.value;e.call(t,i[0],i[1])}},Sn=(t,e)=>{let s;const r=[];for(;(s=t.exec(e))!==null;)r.push(s);return r},kn=re("HTMLFormElement"),Cn=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,r,o){return r.toUpperCase()+o}),vt=(({hasOwnProperty:t})=>(e,s)=>t.call(e,s))(Object.prototype),Tn=re("RegExp"),Zt=(t,e)=>{const s=Object.getOwnPropertyDescriptors(t),r={};Ce(s,(o,i)=>{let a;(a=e(o,i,t))!==!1&&(r[i]=a||o)}),Object.defineProperties(t,r)},En=t=>{Zt(t,(e,s)=>{if(Q(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const r=t[s];if(Q(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Mn=(t,e)=>{const s={},r=o=>{o.forEach(i=>{s[i]=!0})};return ge(t)?r(t):r(String(t).split(e)),s},On=()=>{},An=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Rn(t){return!!(t&&Q(t.append)&&t[Jt]==="FormData"&&t[Fe])}const Dn=t=>{const e=new Array(10),s=(r,o)=>{if(ke(r)){if(e.indexOf(r)>=0)return;if(Se(r))return r;if(!("toJSON"in r)){e[o]=r;const i=ge(r)?[]:{};return Ce(r,(a,l)=>{const d=s(a,o+1);!pe(d)&&(i[l]=d)}),e[o]=void 0,i}}return r};return s(t,0)},$n=re("AsyncFunction"),In=t=>t&&(ke(t)||Q(t))&&Q(t.then)&&Q(t.catch),Yt=((t,e)=>t?setImmediate:e?((s,r)=>(ue.addEventListener("message",({source:o,data:i})=>{o===ue&&i===s&&r.length&&r.shift()()},!1),o=>{r.push(o),ue.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",Q(ue.postMessage)),Ln=typeof queueMicrotask<"u"?queueMicrotask.bind(ue):typeof process<"u"&&process.nextTick||Yt,Fn=t=>t!=null&&Q(t[Fe]),m={isArray:ge,isArrayBuffer:Vt,isBuffer:Se,isFormData:cn,isArrayBufferView:Qs,isString:en,isNumber:Kt,isBoolean:tn,isObject:ke,isPlainObject:Re,isEmptyObject:sn,isReadableStream:dn,isRequest:mn,isResponse:fn,isHeaders:hn,isUndefined:pe,isDate:nn,isFile:rn,isBlob:on,isRegExp:Tn,isFunction:Q,isStream:ln,isURLSearchParams:un,isTypedArray:Nn,isFileList:an,forEach:Ce,merge:Ye,extend:gn,trim:pn,stripBOM:xn,inherits:yn,toFlatObject:bn,kindOf:_e,kindOfTest:re,endsWith:wn,toArray:vn,forEachEntry:jn,matchAll:Sn,isHTMLForm:kn,hasOwnProperty:vt,hasOwnProp:vt,reduceDescriptors:Zt,freezeMethods:En,toObjectSet:Mn,toCamelCase:Cn,noop:On,toFiniteNumber:An,findKey:Xt,global:ue,isContextDefined:Gt,isSpecCompliantForm:Rn,toJSONObject:Dn,isAsyncFn:$n,isThenable:In,setImmediate:Yt,asap:Ln,isIterable:Fn};function $(t,e,s,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}m.inherits($,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});const Qt=$.prototype,es={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{es[t]={value:t}});Object.defineProperties($,es);Object.defineProperty(Qt,"isAxiosError",{value:!0});$.from=(t,e,s,r,o,i)=>{const a=Object.create(Qt);m.toFlatObject(t,a,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const l=t&&t.message?t.message:"Error",d=e==null&&t?t.code:e;return $.call(a,l,d,s,r,o),t&&a.cause==null&&Object.defineProperty(a,"cause",{value:t,configurable:!0}),a.name=t&&t.name||"Error",i&&Object.assign(a,i),a};const _n=null;function Qe(t){return m.isPlainObject(t)||m.isArray(t)}function ts(t){return m.endsWith(t,"[]")?t.slice(0,-2):t}function Nt(t,e,s){return t?t.concat(e).map(function(o,i){return o=ts(o),!s&&i?"["+o+"]":o}).join(s?".":""):e}function Pn(t){return m.isArray(t)&&!t.some(Qe)}const Un=m.toFlatObject(m,{},null,function(e){return/^is[A-Z]/.test(e)});function Ue(t,e,s){if(!m.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,s=m.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,p){return!m.isUndefined(p[g])});const r=s.metaTokens,o=s.visitor||u,i=s.dots,a=s.indexes,d=(s.Blob||typeof Blob<"u"&&Blob)&&m.isSpecCompliantForm(e);if(!m.isFunction(o))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(m.isDate(h))return h.toISOString();if(m.isBoolean(h))return h.toString();if(!d&&m.isBlob(h))throw new $("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(h)||m.isTypedArray(h)?d&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function u(h,g,p){let j=h;if(h&&!p&&typeof h=="object"){if(m.endsWith(g,"{}"))g=r?g:g.slice(0,-2),h=JSON.stringify(h);else if(m.isArray(h)&&Pn(h)||(m.isFileList(h)||m.endsWith(g,"[]"))&&(j=m.toArray(h)))return g=ts(g),j.forEach(function(v,S){!(m.isUndefined(v)||v===null)&&e.append(a===!0?Nt([g],S,i):a===null?g:g+"[]",c(v))}),!1}return Qe(h)?!0:(e.append(Nt(p,g,i),c(h)),!1)}const f=[],y=Object.assign(Un,{defaultVisitor:u,convertValue:c,isVisitable:Qe});function R(h,g){if(!m.isUndefined(h)){if(f.indexOf(h)!==-1)throw Error("Circular reference detected in "+g.join("."));f.push(h),m.forEach(h,function(j,C){(!(m.isUndefined(j)||j===null)&&o.call(e,j,m.isString(C)?C.trim():C,g,y))===!0&&R(j,g?g.concat(C):[C])}),f.pop()}}if(!m.isObject(t))throw new TypeError("data must be an object");return R(t),e}function jt(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function rt(t,e){this._pairs=[],t&&Ue(t,this,e)}const ss=rt.prototype;ss.append=function(e,s){this._pairs.push([e,s])};ss.toString=function(e){const s=e?function(r){return e.call(this,r,jt)}:jt;return this._pairs.map(function(o){return s(o[0])+"="+s(o[1])},"").join("&")};function Bn(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ns(t,e,s){if(!e)return t;const r=s&&s.encode||Bn;m.isFunction(s)&&(s={serialize:s});const o=s&&s.serialize;let i;if(o?i=o(e,s):i=m.isURLSearchParams(e)?e.toString():new rt(e,s).toString(r),i){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class St{constructor(){this.handlers=[]}use(e,s,r){return this.handlers.push({fulfilled:e,rejected:s,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){m.forEach(this.handlers,function(r){r!==null&&e(r)})}}const rs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Hn=typeof URLSearchParams<"u"?URLSearchParams:rt,Wn=typeof FormData<"u"?FormData:null,qn=typeof Blob<"u"?Blob:null,zn={isBrowser:!0,classes:{URLSearchParams:Hn,FormData:Wn,Blob:qn},protocols:["http","https","file","blob","url","data"]},ot=typeof window<"u"&&typeof document<"u",et=typeof navigator=="object"&&navigator||void 0,Jn=ot&&(!et||["ReactNative","NativeScript","NS"].indexOf(et.product)<0),Vn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Kn=ot&&window.location.href||"http://localhost",Xn=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ot,hasStandardBrowserEnv:Jn,hasStandardBrowserWebWorkerEnv:Vn,navigator:et,origin:Kn},Symbol.toStringTag,{value:"Module"})),X={...Xn,...zn};function Gn(t,e){return Ue(t,new X.classes.URLSearchParams,{visitor:function(s,r,o,i){return X.isNode&&m.isBuffer(s)?(this.append(r,s.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function Zn(t){return m.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Yn(t){const e={},s=Object.keys(t);let r;const o=s.length;let i;for(r=0;r<o;r++)i=s[r],e[i]=t[i];return e}function os(t){function e(s,r,o,i){let a=s[i++];if(a==="__proto__")return!0;const l=Number.isFinite(+a),d=i>=s.length;return a=!a&&m.isArray(o)?o.length:a,d?(m.hasOwnProp(o,a)?o[a]=[o[a],r]:o[a]=r,!l):((!o[a]||!m.isObject(o[a]))&&(o[a]=[]),e(s,r,o[a],i)&&m.isArray(o[a])&&(o[a]=Yn(o[a])),!l)}if(m.isFormData(t)&&m.isFunction(t.entries)){const s={};return m.forEachEntry(t,(r,o)=>{e(Zn(r),o,s,0)}),s}return null}function Qn(t,e,s){if(m.isString(t))try{return(e||JSON.parse)(t),m.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(s||JSON.stringify)(t)}const Te={transitional:rs,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const r=s.getContentType()||"",o=r.indexOf("application/json")>-1,i=m.isObject(e);if(i&&m.isHTMLForm(e)&&(e=new FormData(e)),m.isFormData(e))return o?JSON.stringify(os(e)):e;if(m.isArrayBuffer(e)||m.isBuffer(e)||m.isStream(e)||m.isFile(e)||m.isBlob(e)||m.isReadableStream(e))return e;if(m.isArrayBufferView(e))return e.buffer;if(m.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Gn(e,this.formSerializer).toString();if((l=m.isFileList(e))||r.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Ue(l?{"files[]":e}:e,d&&new d,this.formSerializer)}}return i||o?(s.setContentType("application/json",!1),Qn(e)):e}],transformResponse:[function(e){const s=this.transitional||Te.transitional,r=s&&s.forcedJSONParsing,o=this.responseType==="json";if(m.isResponse(e)||m.isReadableStream(e))return e;if(e&&m.isString(e)&&(r&&!this.responseType||o)){const a=!(s&&s.silentJSONParsing)&&o;try{return JSON.parse(e,this.parseReviver)}catch(l){if(a)throw l.name==="SyntaxError"?$.from(l,$.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:X.classes.FormData,Blob:X.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],t=>{Te.headers[t]={}});const er=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tr=t=>{const e={};let s,r,o;return t&&t.split(`
`).forEach(function(a){o=a.indexOf(":"),s=a.substring(0,o).trim().toLowerCase(),r=a.substring(o+1).trim(),!(!s||e[s]&&er[s])&&(s==="set-cookie"?e[s]?e[s].push(r):e[s]=[r]:e[s]=e[s]?e[s]+", "+r:r)}),e},kt=Symbol("internals");function we(t){return t&&String(t).trim().toLowerCase()}function De(t){return t===!1||t==null?t:m.isArray(t)?t.map(De):String(t)}function sr(t){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=s.exec(t);)e[r[1]]=r[2];return e}const nr=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ve(t,e,s,r,o){if(m.isFunction(r))return r.call(this,e,s);if(o&&(e=s),!!m.isString(e)){if(m.isString(r))return e.indexOf(r)!==-1;if(m.isRegExp(r))return r.test(e)}}function rr(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,r)=>s.toUpperCase()+r)}function or(t,e){const s=m.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+s,{value:function(o,i,a){return this[r].call(this,e,o,i,a)},configurable:!0})})}let ee=class{constructor(e){e&&this.set(e)}set(e,s,r){const o=this;function i(l,d,c){const u=we(d);if(!u)throw new Error("header name must be a non-empty string");const f=m.findKey(o,u);(!f||o[f]===void 0||c===!0||c===void 0&&o[f]!==!1)&&(o[f||d]=De(l))}const a=(l,d)=>m.forEach(l,(c,u)=>i(c,u,d));if(m.isPlainObject(e)||e instanceof this.constructor)a(e,s);else if(m.isString(e)&&(e=e.trim())&&!nr(e))a(tr(e),s);else if(m.isObject(e)&&m.isIterable(e)){let l={},d,c;for(const u of e){if(!m.isArray(u))throw TypeError("Object iterator must return a key-value pair");l[c=u[0]]=(d=l[c])?m.isArray(d)?[...d,u[1]]:[d,u[1]]:u[1]}a(l,s)}else e!=null&&i(s,e,r);return this}get(e,s){if(e=we(e),e){const r=m.findKey(this,e);if(r){const o=this[r];if(!s)return o;if(s===!0)return sr(o);if(m.isFunction(s))return s.call(this,o,r);if(m.isRegExp(s))return s.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=we(e),e){const r=m.findKey(this,e);return!!(r&&this[r]!==void 0&&(!s||Ve(this,this[r],r,s)))}return!1}delete(e,s){const r=this;let o=!1;function i(a){if(a=we(a),a){const l=m.findKey(r,a);l&&(!s||Ve(r,r[l],l,s))&&(delete r[l],o=!0)}}return m.isArray(e)?e.forEach(i):i(e),o}clear(e){const s=Object.keys(this);let r=s.length,o=!1;for(;r--;){const i=s[r];(!e||Ve(this,this[i],i,e,!0))&&(delete this[i],o=!0)}return o}normalize(e){const s=this,r={};return m.forEach(this,(o,i)=>{const a=m.findKey(r,i);if(a){s[a]=De(o),delete s[i];return}const l=e?rr(i):String(i).trim();l!==i&&delete s[i],s[l]=De(o),r[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return m.forEach(this,(r,o)=>{r!=null&&r!==!1&&(s[o]=e&&m.isArray(r)?r.join(", "):r)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const r=new this(e);return s.forEach(o=>r.set(o)),r}static accessor(e){const r=(this[kt]=this[kt]={accessors:{}}).accessors,o=this.prototype;function i(a){const l=we(a);r[l]||(or(o,a),r[l]=!0)}return m.isArray(e)?e.forEach(i):i(e),this}};ee.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(ee.prototype,({value:t},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[s]=r}}});m.freezeMethods(ee);function Ke(t,e){const s=this||Te,r=e||s,o=ee.from(r.headers);let i=r.data;return m.forEach(t,function(l){i=l.call(s,i,o.normalize(),e?e.status:void 0)}),o.normalize(),i}function as(t){return!!(t&&t.__CANCEL__)}function xe(t,e,s){$.call(this,t??"canceled",$.ERR_CANCELED,e,s),this.name="CanceledError"}m.inherits(xe,$,{__CANCEL__:!0});function is(t,e,s){const r=s.config.validateStatus;!s.status||!r||r(s.status)?t(s):e(new $("Request failed with status code "+s.status,[$.ERR_BAD_REQUEST,$.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function ar(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function ir(t,e){t=t||10;const s=new Array(t),r=new Array(t);let o=0,i=0,a;return e=e!==void 0?e:1e3,function(d){const c=Date.now(),u=r[i];a||(a=c),s[o]=d,r[o]=c;let f=i,y=0;for(;f!==o;)y+=s[f++],f=f%t;if(o=(o+1)%t,o===i&&(i=(i+1)%t),c-a<e)return;const R=u&&c-u;return R?Math.round(y*1e3/R):void 0}}function lr(t,e){let s=0,r=1e3/e,o,i;const a=(c,u=Date.now())=>{s=u,o=null,i&&(clearTimeout(i),i=null),t(...c)};return[(...c)=>{const u=Date.now(),f=u-s;f>=r?a(c,u):(o=c,i||(i=setTimeout(()=>{i=null,a(o)},r-f)))},()=>o&&a(o)]}const Ie=(t,e,s=3)=>{let r=0;const o=ir(50,250);return lr(i=>{const a=i.loaded,l=i.lengthComputable?i.total:void 0,d=a-r,c=o(d),u=a<=l;r=a;const f={loaded:a,total:l,progress:l?a/l:void 0,bytes:d,rate:c||void 0,estimated:c&&l&&u?(l-a)/c:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(f)},s)},Ct=(t,e)=>{const s=t!=null;return[r=>e[0]({lengthComputable:s,total:t,loaded:r}),e[1]]},Tt=t=>(...e)=>m.asap(()=>t(...e)),cr=X.hasStandardBrowserEnv?((t,e)=>s=>(s=new URL(s,X.origin),t.protocol===s.protocol&&t.host===s.host&&(e||t.port===s.port)))(new URL(X.origin),X.navigator&&/(msie|trident)/i.test(X.navigator.userAgent)):()=>!0,ur=X.hasStandardBrowserEnv?{write(t,e,s,r,o,i,a){if(typeof document>"u")return;const l=[`${t}=${encodeURIComponent(e)}`];m.isNumber(s)&&l.push(`expires=${new Date(s).toUTCString()}`),m.isString(r)&&l.push(`path=${r}`),m.isString(o)&&l.push(`domain=${o}`),i===!0&&l.push("secure"),m.isString(a)&&l.push(`SameSite=${a}`),document.cookie=l.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function dr(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function mr(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function ls(t,e,s){let r=!dr(e);return t&&(r||s==!1)?mr(t,e):e}const Et=t=>t instanceof ee?{...t}:t;function me(t,e){e=e||{};const s={};function r(c,u,f,y){return m.isPlainObject(c)&&m.isPlainObject(u)?m.merge.call({caseless:y},c,u):m.isPlainObject(u)?m.merge({},u):m.isArray(u)?u.slice():u}function o(c,u,f,y){if(m.isUndefined(u)){if(!m.isUndefined(c))return r(void 0,c,f,y)}else return r(c,u,f,y)}function i(c,u){if(!m.isUndefined(u))return r(void 0,u)}function a(c,u){if(m.isUndefined(u)){if(!m.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function l(c,u,f){if(f in e)return r(c,u);if(f in t)return r(void 0,c)}const d={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(c,u,f)=>o(Et(c),Et(u),f,!0)};return m.forEach(Object.keys({...t,...e}),function(u){const f=d[u]||o,y=f(t[u],e[u],u);m.isUndefined(y)&&f!==l||(s[u]=y)}),s}const cs=t=>{const e=me({},t);let{data:s,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:l}=e;if(e.headers=a=ee.from(a),e.url=ns(ls(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),m.isFormData(s)){if(X.hasStandardBrowserEnv||X.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(m.isFunction(s.getHeaders)){const d=s.getHeaders(),c=["content-type","content-length"];Object.entries(d).forEach(([u,f])=>{c.includes(u.toLowerCase())&&a.set(u,f)})}}if(X.hasStandardBrowserEnv&&(r&&m.isFunction(r)&&(r=r(e)),r||r!==!1&&cr(e.url))){const d=o&&i&&ur.read(i);d&&a.set(o,d)}return e},fr=typeof XMLHttpRequest<"u",hr=fr&&function(t){return new Promise(function(s,r){const o=cs(t);let i=o.data;const a=ee.from(o.headers).normalize();let{responseType:l,onUploadProgress:d,onDownloadProgress:c}=o,u,f,y,R,h;function g(){R&&R(),h&&h(),o.cancelToken&&o.cancelToken.unsubscribe(u),o.signal&&o.signal.removeEventListener("abort",u)}let p=new XMLHttpRequest;p.open(o.method.toUpperCase(),o.url,!0),p.timeout=o.timeout;function j(){if(!p)return;const v=ee.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),M={data:!l||l==="text"||l==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:v,config:t,request:p};is(function(T){s(T),g()},function(T){r(T),g()},M),p=null}"onloadend"in p?p.onloadend=j:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(j)},p.onabort=function(){p&&(r(new $("Request aborted",$.ECONNABORTED,t,p)),p=null)},p.onerror=function(S){const M=S&&S.message?S.message:"Network Error",O=new $(M,$.ERR_NETWORK,t,p);O.event=S||null,r(O),p=null},p.ontimeout=function(){let S=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const M=o.transitional||rs;o.timeoutErrorMessage&&(S=o.timeoutErrorMessage),r(new $(S,M.clarifyTimeoutError?$.ETIMEDOUT:$.ECONNABORTED,t,p)),p=null},i===void 0&&a.setContentType(null),"setRequestHeader"in p&&m.forEach(a.toJSON(),function(S,M){p.setRequestHeader(M,S)}),m.isUndefined(o.withCredentials)||(p.withCredentials=!!o.withCredentials),l&&l!=="json"&&(p.responseType=o.responseType),c&&([y,h]=Ie(c,!0),p.addEventListener("progress",y)),d&&p.upload&&([f,R]=Ie(d),p.upload.addEventListener("progress",f),p.upload.addEventListener("loadend",R)),(o.cancelToken||o.signal)&&(u=v=>{p&&(r(!v||v.type?new xe(null,t,p):v),p.abort(),p=null)},o.cancelToken&&o.cancelToken.subscribe(u),o.signal&&(o.signal.aborted?u():o.signal.addEventListener("abort",u)));const C=ar(o.url);if(C&&X.protocols.indexOf(C)===-1){r(new $("Unsupported protocol "+C+":",$.ERR_BAD_REQUEST,t));return}p.send(i||null)})},pr=(t,e)=>{const{length:s}=t=t?t.filter(Boolean):[];if(e||s){let r=new AbortController,o;const i=function(c){if(!o){o=!0,l();const u=c instanceof Error?c:this.reason;r.abort(u instanceof $?u:new xe(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{a=null,i(new $(`timeout ${e} of ms exceeded`,$.ETIMEDOUT))},e);const l=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),t=null)};t.forEach(c=>c.addEventListener("abort",i));const{signal:d}=r;return d.unsubscribe=()=>m.asap(l),d}},gr=function*(t,e){let s=t.byteLength;if(s<e){yield t;return}let r=0,o;for(;r<s;)o=r+e,yield t.slice(r,o),r=o},xr=async function*(t,e){for await(const s of yr(t))yield*gr(s,e)},yr=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:s,value:r}=await e.read();if(s)break;yield r}}finally{await e.cancel()}},Mt=(t,e,s,r)=>{const o=xr(t,e);let i=0,a,l=d=>{a||(a=!0,r&&r(d))};return new ReadableStream({async pull(d){try{const{done:c,value:u}=await o.next();if(c){l(),d.close();return}let f=u.byteLength;if(s){let y=i+=f;s(y)}d.enqueue(new Uint8Array(u))}catch(c){throw l(c),c}},cancel(d){return l(d),o.return()}},{highWaterMark:2})},Ot=64*1024,{isFunction:Oe}=m,br=(({Request:t,Response:e})=>({Request:t,Response:e}))(m.global),{ReadableStream:At,TextEncoder:Rt}=m.global,Dt=(t,...e)=>{try{return!!t(...e)}catch{return!1}},wr=t=>{t=m.merge.call({skipUndefined:!0},br,t);const{fetch:e,Request:s,Response:r}=t,o=e?Oe(e):typeof fetch=="function",i=Oe(s),a=Oe(r);if(!o)return!1;const l=o&&Oe(At),d=o&&(typeof Rt=="function"?(h=>g=>h.encode(g))(new Rt):async h=>new Uint8Array(await new s(h).arrayBuffer())),c=i&&l&&Dt(()=>{let h=!1;const g=new s(X.origin,{body:new At,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!g}),u=a&&l&&Dt(()=>m.isReadableStream(new r("").body)),f={stream:u&&(h=>h.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!f[h]&&(f[h]=(g,p)=>{let j=g&&g[h];if(j)return j.call(g);throw new $(`Response type '${h}' is not supported`,$.ERR_NOT_SUPPORT,p)})});const y=async h=>{if(h==null)return 0;if(m.isBlob(h))return h.size;if(m.isSpecCompliantForm(h))return(await new s(X.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(m.isArrayBufferView(h)||m.isArrayBuffer(h))return h.byteLength;if(m.isURLSearchParams(h)&&(h=h+""),m.isString(h))return(await d(h)).byteLength},R=async(h,g)=>{const p=m.toFiniteNumber(h.getContentLength());return p??y(g)};return async h=>{let{url:g,method:p,data:j,signal:C,cancelToken:v,timeout:S,onDownloadProgress:M,onUploadProgress:O,responseType:T,headers:P,withCredentials:q="same-origin",fetchOptions:V}=cs(h),x=e||fetch;T=T?(T+"").toLowerCase():"text";let b=pr([C,v&&v.toAbortSignal()],S),N=null;const k=b&&b.unsubscribe&&(()=>{b.unsubscribe()});let z;try{if(O&&c&&p!=="get"&&p!=="head"&&(z=await R(P,j))!==0){let D=new s(g,{method:"POST",body:j,duplex:"half"}),U;if(m.isFormData(j)&&(U=D.headers.get("content-type"))&&P.setContentType(U),D.body){const[_,A]=Ct(z,Ie(Tt(O)));j=Mt(D.body,Ot,_,A)}}m.isString(q)||(q=q?"include":"omit");const B=i&&"credentials"in s.prototype,le={...V,signal:b,method:p.toUpperCase(),headers:P.normalize().toJSON(),body:j,duplex:"half",credentials:B?q:void 0};N=i&&new s(g,le);let G=await(i?x(N,V):x(g,le));const ae=u&&(T==="stream"||T==="response");if(u&&(M||ae&&k)){const D={};["status","statusText","headers"].forEach(L=>{D[L]=G[L]});const U=m.toFiniteNumber(G.headers.get("content-length")),[_,A]=M&&Ct(U,Ie(Tt(M),!0))||[];G=new r(Mt(G.body,Ot,_,()=>{A&&A(),k&&k()}),D)}T=T||"text";let I=await f[m.findKey(f,T)||"text"](G,h);return!ae&&k&&k(),await new Promise((D,U)=>{is(D,U,{data:I,headers:ee.from(G.headers),status:G.status,statusText:G.statusText,config:h,request:N})})}catch(B){throw k&&k(),B&&B.name==="TypeError"&&/Load failed|fetch/i.test(B.message)?Object.assign(new $("Network Error",$.ERR_NETWORK,h,N),{cause:B.cause||B}):$.from(B,B&&B.code,h,N)}}},vr=new Map,us=t=>{let e=t&&t.env||{};const{fetch:s,Request:r,Response:o}=e,i=[r,o,s];let a=i.length,l=a,d,c,u=vr;for(;l--;)d=i[l],c=u.get(d),c===void 0&&u.set(d,c=l?new Map:wr(e)),u=c;return c};us();const at={http:_n,xhr:hr,fetch:{get:us}};m.forEach(at,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const $t=t=>`- ${t}`,Nr=t=>m.isFunction(t)||t===null||t===!1;function jr(t,e){t=m.isArray(t)?t:[t];const{length:s}=t;let r,o;const i={};for(let a=0;a<s;a++){r=t[a];let l;if(o=r,!Nr(r)&&(o=at[(l=String(r)).toLowerCase()],o===void 0))throw new $(`Unknown adapter '${l}'`);if(o&&(m.isFunction(o)||(o=o.get(e))))break;i[l||"#"+a]=o}if(!o){const a=Object.entries(i).map(([d,c])=>`adapter ${d} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=s?a.length>1?`since :
`+a.map($t).join(`
`):" "+$t(a[0]):"as no adapter specified";throw new $("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return o}const ds={getAdapter:jr,adapters:at};function Xe(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new xe(null,t)}function It(t){return Xe(t),t.headers=ee.from(t.headers),t.data=Ke.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),ds.getAdapter(t.adapter||Te.adapter,t)(t).then(function(r){return Xe(t),r.data=Ke.call(t,t.transformResponse,r),r.headers=ee.from(r.headers),r},function(r){return as(r)||(Xe(t),r&&r.response&&(r.response.data=Ke.call(t,t.transformResponse,r.response),r.response.headers=ee.from(r.response.headers))),Promise.reject(r)})}const ms="1.13.2",Be={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Be[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Lt={};Be.transitional=function(e,s,r){function o(i,a){return"[Axios v"+ms+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,l)=>{if(e===!1)throw new $(o(a," has been removed"+(s?" in "+s:"")),$.ERR_DEPRECATED);return s&&!Lt[a]&&(Lt[a]=!0,console.warn(o(a," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(i,a,l):!0}};Be.spelling=function(e){return(s,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function Sr(t,e,s){if(typeof t!="object")throw new $("options must be an object",$.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let o=r.length;for(;o-- >0;){const i=r[o],a=e[i];if(a){const l=t[i],d=l===void 0||a(l,i,t);if(d!==!0)throw new $("option "+i+" must be "+d,$.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new $("Unknown option "+i,$.ERR_BAD_OPTION)}}const $e={assertOptions:Sr,validators:Be},oe=$e.validators;let de=class{constructor(e){this.defaults=e||{},this.interceptors={request:new St,response:new St}}async request(e,s){try{return await this._request(e,s)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=me(this.defaults,s);const{transitional:r,paramsSerializer:o,headers:i}=s;r!==void 0&&$e.assertOptions(r,{silentJSONParsing:oe.transitional(oe.boolean),forcedJSONParsing:oe.transitional(oe.boolean),clarifyTimeoutError:oe.transitional(oe.boolean)},!1),o!=null&&(m.isFunction(o)?s.paramsSerializer={serialize:o}:$e.assertOptions(o,{encode:oe.function,serialize:oe.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),$e.assertOptions(s,{baseUrl:oe.spelling("baseURL"),withXsrfToken:oe.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let a=i&&m.merge(i.common,i[s.method]);i&&m.forEach(["delete","get","head","post","put","patch","common"],h=>{delete i[h]}),s.headers=ee.concat(a,i);const l=[];let d=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(s)===!1||(d=d&&g.synchronous,l.unshift(g.fulfilled,g.rejected))});const c=[];this.interceptors.response.forEach(function(g){c.push(g.fulfilled,g.rejected)});let u,f=0,y;if(!d){const h=[It.bind(this),void 0];for(h.unshift(...l),h.push(...c),y=h.length,u=Promise.resolve(s);f<y;)u=u.then(h[f++],h[f++]);return u}y=l.length;let R=s;for(;f<y;){const h=l[f++],g=l[f++];try{R=h(R)}catch(p){g.call(this,p);break}}try{u=It.call(this,R)}catch(h){return Promise.reject(h)}for(f=0,y=c.length;f<y;)u=u.then(c[f++],c[f++]);return u}getUri(e){e=me(this.defaults,e);const s=ls(e.baseURL,e.url,e.allowAbsoluteUrls);return ns(s,e.params,e.paramsSerializer)}};m.forEach(["delete","get","head","options"],function(e){de.prototype[e]=function(s,r){return this.request(me(r||{},{method:e,url:s,data:(r||{}).data}))}});m.forEach(["post","put","patch"],function(e){function s(r){return function(i,a,l){return this.request(me(l||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}de.prototype[e]=s(),de.prototype[e+"Form"]=s(!0)});let kr=class fs{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(i){s=i});const r=this;this.promise.then(o=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](o);r._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(l=>{r.subscribe(l),i=l}).then(o);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,l){r.reason||(r.reason=new xe(i,a,l),s(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=r=>{e.abort(r)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new fs(function(o){e=o}),cancel:e}}};function Cr(t){return function(s){return t.apply(null,s)}}function Tr(t){return m.isObject(t)&&t.isAxiosError===!0}const tt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(tt).forEach(([t,e])=>{tt[e]=t});function hs(t){const e=new de(t),s=zt(de.prototype.request,e);return m.extend(s,de.prototype,e,{allOwnKeys:!0}),m.extend(s,e,null,{allOwnKeys:!0}),s.create=function(o){return hs(me(t,o))},s}const W=hs(Te);W.Axios=de;W.CanceledError=xe;W.CancelToken=kr;W.isCancel=as;W.VERSION=ms;W.toFormData=Ue;W.AxiosError=$;W.Cancel=W.CanceledError;W.all=function(e){return Promise.all(e)};W.spread=Cr;W.isAxiosError=Tr;W.mergeConfig=me;W.AxiosHeaders=ee;W.formToJSON=t=>os(m.isHTMLForm(t)?new FormData(t):t);W.getAdapter=ds.getAdapter;W.HttpStatusCode=tt;W.default=W;const{Axios:Yr,AxiosError:Qr,CanceledError:eo,isCancel:to,CancelToken:so,VERSION:no,all:ro,Cancel:oo,isAxiosError:ao,spread:io,toFormData:lo,AxiosHeaders:co,HttpStatusCode:uo,formToJSON:mo,getAdapter:fo,mergeConfig:ho}=W,Er=()=>"https://api.protonestconnect.co/api/v1/user",it=Er();console.log("ðŸ”§ API Base URL:",it);const je=W.create({baseURL:it,headers:{"Content-Type":"application/json"},timeout:15e3});je.interceptors.request.use(t=>{const e=localStorage.getItem("jwtToken");return e&&e!=="MOCK_TOKEN_FOR_TESTING"&&(t.headers["X-Token"]=e),console.log("ðŸ“¤ API Request:",{method:t.method?.toUpperCase(),url:t.url,baseURL:t.baseURL,hasToken:!!e&&e!=="MOCK_TOKEN_FOR_TESTING",payload:t.data||void 0}),t},t=>(console.error("âŒ Request interceptor error:",t),Promise.reject(t)));je.interceptors.response.use(t=>(console.log("ðŸ“¥ API Response:",{status:t.status,url:t.config.url,method:t.config.method?.toUpperCase()}),t),async t=>{const e=t.config;if(t.response){const s=t.response.status===400,r=t.response.data?.data||t.response.data?.message;if((!s||!window.__api400ErrorLogged&&r!=="Device does not belong to the user")&&(console.error("âŒ API Error Response:",{status:t.response.status,statusText:t.response.statusText,url:e?.url,method:e?.method?.toUpperCase(),data:t.response.data,allowHeader:t.response.headers?.allow}),s&&(window.__api400ErrorLogged=!0)),t.response.status===400){const o=t.response.data?.data||t.response.data?.message;if(o==="Device does not belong to the user")return window.__deviceAuthErrorShown||(console.error(`
ðŸš« DEVICE AUTHORIZATION ERROR`),console.error("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"),console.error("âŒ Device does not belong to your account"),console.error(`
ðŸ’¡ TO FIX THIS:`),console.error("   1. Go to: https://api.protonestconnect.co"),console.error("   2. Find your device ID in your dashboard"),console.error(`   3. Update 'defaultDeviceId' in Dashboard.jsx
`),console.error(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`),window.__deviceAuthErrorShown=!0),Promise.reject(t);o!=="Device does not belong to the user"&&console.error("ðŸ” 400 Error:",{endpoint:e?.url,message:o})}}if(t.response?.status===405)return console.error("ðŸš« Method Not Allowed (405):",{attempted:e?.method?.toUpperCase(),endpoint:e?.url,allowed:t.response.headers?.allow||"Not specified"}),Promise.reject(t);if((t.response?.status===400||t.response?.status===401)&&!e?.url?.includes("/get-token")&&(t.response?.data?.data==="Invalid token"||t.response?.data?.message?.includes("token"))&&!e._retry){e._retry=!0;try{const s=localStorage.getItem("refreshToken");if(!s)throw new Error("No refresh token available");console.log("ðŸ”„ Attempting token refresh...");const r=await W.post(`${it}/get-new-token`,{},{headers:{"X-Refresh-Token":s},timeout:1e4});if(r.data.status==="Success"){const{jwtToken:o}=r.data.data;return localStorage.setItem("jwtToken",o),e.headers["X-Token"]=o,console.log("âœ… Token refreshed successfully"),je(e)}}catch(s){console.error("âŒ Token refresh failed:",s.message),localStorage.clear(),window.location.href="/"}}return Promise.reject(t)});const Mr=async(t,e,s=null,r=null,o=0,i=100)=>{try{const a=y=>y.toISOString().split(".")[0]+"Z",l=new Date,d=r?new Date(r):l,c=s?new Date(s):new Date(l.getTime()-1440*60*1e3);console.log(`â° [HTTP] Time calculation for ${e}:`,{currentTime:l.toISOString(),startTime:c.toISOString(),endTime:d.toISOString(),rangeHours:((d-c)/(1e3*60*60)).toFixed(1)});const u={deviceId:t,topic:e,startTime:a(c),endTime:a(d),pagination:String(o),pageSize:String(i)};console.log(`ðŸ“¤ [HTTP] Fetching ${e} data:`),console.log(JSON.stringify({deviceId:u.deviceId,topic:u.topic,startTime:u.startTime,endTime:u.endTime,pagination:u.pagination,pageSize:u.pageSize},null,2));const f=await je.post("/get-stream-data/device/topic",u);if(console.log(`ðŸ“¥ [HTTP] Response for ${e}:`,{status:f.data.status,dataLength:f.data.data?.length||0}),f.data.status==="Success"){const y=f.data.data?.length||0;return y>0?(console.log(`âœ… ${e}: ${y} records`),console.log(`ðŸ“‹ [HTTP] Sample ${e} record:`,f.data.data[0])):console.log(`â„¹ï¸ ${e}: No data found in time range`),f.data.data||[]}return[]}catch(a){let l="Unknown error";return a.response?.data?l=a.response.data.data||a.response.data.message||a.response.data.error||(typeof a.response.data=="string"?a.response.data:null)||JSON.stringify(a.response.data):a.message&&(l=a.message),console.warn(`âš ï¸ [HTTP] Error fetching ${e}:`,{status:a.response?.status||"No response",statusText:a.response?.statusText||"N/A",message:l,fullResponse:a.response?.data}),[]}},Or=async(t,e=null,s=null)=>{const r=[{name:"temp",label:"temperature"},{name:"moisture",label:"moisture"},{name:"humidity",label:"humidity"},{name:"battery",label:"battery"},{name:"light",label:"light"}];try{console.log(`ðŸ“Š [HTTP] Fetching historical data for ${t}`),console.log(`ðŸ“… [HTTP] Time range: ${e||"Last 24h"} to ${s||"Now"}`);const o=await Promise.allSettled(r.map(f=>Mr(t,f.name,e,s,0,100))),i=o.filter(f=>f.status==="fulfilled"&&f.value.length>0).length,a=o.filter(f=>f.status==="rejected").length,l=o.filter(f=>f.status==="fulfilled"&&f.value.length===0).length;console.log("ðŸ“Š [HTTP] Historical data summary:",{successful:i,empty:l,failed:a,total:r.length}),i>0?console.log(`âœ… [HTTP] Loaded ${i} topics with historical data`):window.__historicalDataWarningShown||(console.warn("â„¹ï¸ [HTTP] No historical data available yet. Real-time data will still work."),console.warn("ðŸ’¡ [HTTP] Possible reasons:"),console.warn("   1. Device recently added - ProtoNest hasn't saved MQTT data to DB yet"),console.warn("   2. Topic names mismatch - check what topic names are saved in DB"),console.warn("   3. Device not in your account - verify device ownership"),window.__historicalDataWarningShown=!0);const d=new Map;o.forEach((f,y)=>{const R=r[y],h=R.name,g=R.label;f.status==="fulfilled"&&Array.isArray(f.value)?(console.log(`ðŸ” [HTTP] Processing ${h}: ${f.value.length} records`),f.value.forEach(p=>{const j=p.timestamp||p.time||new Date().toISOString();d.has(j)||d.set(j,{timestamp:j,time:new Date(j).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),moisture:null,temperature:null,humidity:null,light:null,battery:null});const C=d.get(j);let v=p;if(p.payload&&typeof p.payload=="string")try{v=JSON.parse(p.payload)}catch{console.warn(`âš ï¸ Failed to parse payload for ${h}:`,p.payload),v=p}else p.payload&&typeof p.payload=="object"&&(v=p.payload);g==="temperature"||h==="temp"?(C.temperature=Number(v.temp||v.temperature||p.value||0),console.log(`  ðŸ“Š [${j}] temperature: ${C.temperature}`)):g==="moisture"?(C.moisture=Number(v.moisture||p.value||0),console.log(`  ðŸ“Š [${j}] moisture: ${C.moisture}`)):g==="humidity"?(C.humidity=Number(v.humidity||p.value||0),console.log(`  ðŸ“Š [${j}] humidity: ${C.humidity}`)):g==="battery"?(C.battery=Number(v.battery||p.value||0),console.log(`  ðŸ“Š [${j}] battery: ${C.battery}`)):g==="light"&&(C.light=Number(v.light||p.value||0),console.log(`  ðŸ“Š [${j}] light: ${C.light}`))})):f.status==="rejected"&&console.warn(`âš ï¸ [HTTP] Failed to fetch ${h} data:`,f.reason?.message)});const c=Array.from(d.values()).sort((f,y)=>new Date(f.timestamp)-new Date(y.timestamp)),u={moisture:null,temperature:null,humidity:null,light:null,battery:null};return c.forEach(f=>{Object.keys(u).forEach(y=>{f[y]!==null&&f[y]!==void 0&&f[y]!==0?u[y]=f[y]:u[y]!==null&&(f[y]=u[y])})}),c.length>0&&(console.log(`âœ… [HTTP] Historical data: ${c.length} data points combined`),console.log(`ðŸ“… [HTTP] Time range: ${c[0].time} to ${c[c.length-1].time}`),console.log("ðŸ“Š [HTTP] Latest data point:",c[c.length-1])),c}catch(o){throw console.error("âŒ [HTTP] Error fetching all stream data:",o),o}},Ar=async(t,e,s={})=>{try{console.log("Updating device state:",{deviceId:t,topic:e,payload:s});const r={deviceId:t,topic:e,payload:s};console.log("ðŸ“¤ Update state request body:",JSON.stringify(r,null,2));const o=await je.post("/update-state-details",r);return console.log("âœ… Device state update response:",o.data),o.data}catch(r){throw r.response?.status===405&&(console.error("âŒ Method not allowed for update-state-details. Server may not support POST."),console.error("Allowed methods:",r.response.headers?.allow||"Unknown")),r.response?.status===400&&console.error("ðŸ” Device Update 400 Error Analysis:",{endpoint:"/update-state-details",sentPayload:requestBody,serverResponse:r.response.data,possibleCauses:["Invalid deviceId format","Topic not found or invalid format","Payload structure incorrect (should be key-value pairs)","Missing required parameters (deviceId, topic, payload)","Topic doesn't exist - new topic will be created automatically"]}),console.error("âŒ Error updating device state:",{status:r.response?.status,statusText:r.response?.statusText,data:r.response?.data,message:r.message,url:r.config?.url,method:r.config?.method,requestBody}),r}},Rr=async(t,e,s="pump",r="auto")=>{const o=e.toLowerCase();return console.log("ðŸ“¤ Sending pump command via HTTP API:",{deviceId:t,topic:s,pump:o,mode:r}),Ar(t,s,{pump:o,mode:r})},ve=({label:t,value:e,unit:s="",status:r,decimals:o=1})=>{const i=h=>h==null?"--":typeof h=="number"?Number(h).toFixed(o):h,a=h=>h==="critical"?{accent:"border-t-4 border-red-500",bg:"bg-red-500",text:"text-red-500"}:h==="warning"?{accent:"border-t-4 border-amber-400",bg:"bg-amber-400",text:"text-amber-500"}:{accent:"border-t-4 border-green-500",bg:"bg-green-50",text:"text-green-700"},{accent:l,bg:d,text:c,Icon:u,short:f}=a(r),y="text-3xl lg:text-4xl",R=c||"text-gray-800";return n.jsxs("div",{className:`flex flex-col items-center p-3 bg-white rounded-lg shadow-sm w-full ${l}`,children:[n.jsxs("div",{className:"flex flex-col items-center justify-center w-full",children:[n.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:t}),n.jsxs("div",{className:`${y} font-semibold ${R} text-center`,children:[i(e),s]})]}),f?n.jsx("div",{className:"mt-3 w-full flex items-center justify-center",children:n.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full ${d} ${c} text-xs font-semibold shadow-sm`,children:[u?n.jsx(u,{className:"w-4 h-4"}):null,n.jsx("span",{children:f})]})}):null]})},Dr=[{key:"moisture",label:"Moisture",color:"bg-cyan-500"},{key:"temperature",label:"Temp",color:"bg-green-500"},{key:"humidity",label:"Humidity",color:"bg-blue-500"},{key:"light",label:"Light",color:"bg-yellow-500"},{key:"battery",label:"Battery",color:"bg-purple-500"}],$r=({visibleSeries:t,toggleSeries:e,getButtonClass:s,className:r=""})=>n.jsx("div",{className:`flex items-center gap-2 justify-center md:justify-start ${r}`,children:Dr.map(({key:o,label:i,color:a})=>n.jsxs("button",{onClick:()=>e(o),className:s(t[o],a),children:[t[o]?n.jsx(Hs,{className:"w-3 h-3"}):n.jsx(Bs,{className:"w-3 h-3"})," ",i]},o))}),Ir=({chartData:t,isLoading:e,onExportCSV:s,isExporting:r,dataSource:o="None",error:i=null,timeRange:a="1h",dataInterval:l="auto",onTimeRangeChange:d,onDataIntervalChange:c,allData:u=[],onFilteredDataChange:f})=>{const[y,R]=w.useState({moisture:!0,temperature:!0,humidity:!0,light:!0,battery:!0}),[h,g]=w.useState(!1),[p,j]=w.useState(""),[C,v]=w.useState("minutes"),[S,M]=w.useState(""),[O,T]=w.useState("seconds"),[P,q]=w.useState(!1),[V,x]=w.useState(a),[b,N]=w.useState(l),[k,z]=w.useState("all"),B=()=>{if(!p||parseFloat(p)<=0){alert("Please enter a valid time range value");return}const E={seconds:1e3,minutes:60*1e3,hours:3600*1e3,days:1440*60*1e3},Y=`custom_${parseFloat(p)*E[C]}`;if(le[Y]=`${p} ${C.charAt(0).toUpperCase()+C.slice(1)}`,S&&parseFloat(S)>0){const fe=`custom_interval_${parseFloat(S)*E[O]}`;G[fe]=`${S} ${O.charAt(0).toUpperCase()+O.slice(1)}`,c&&c(fe)}d&&d(Y),g(!1)},le={"1m":"Last 1 Minute","5m":"Last 5 Minutes","15m":"Last 15 Minutes","1h":"Last 1 Hour","6h":"Last 6 Hours","24h":"Last 24 Hours"},G={auto:"Auto","1s":"1 Second","5s":"5 Seconds","1m":"1 Minute","5m":"5 Minutes","1h":"1 Hour"},I=(E=>{if(E.startsWith("custom_")){const Y=parseInt(E.replace("custom_","")),K=["auto"];return Y>=1e3&&K.push("1s"),Y>=5e3&&K.push("5s"),Y>=6e4&&K.push("1m"),Y>=3e5&&K.push("5m"),Y>=36e5&&K.push("1h"),K}return{"1m":["auto","1s"],"5m":["auto","1s","5s"],"15m":["auto","1s","5s","1m"],"1h":["auto","1s","5s","1m","5m"],"6h":["auto","5s","1m","5m"],"24h":["auto","1m","5m","1h"]}[E]||["auto"]})(a),D=w.useMemo(()=>{if(!u||u.length===0)return t;const E=new Date;let F;a.startsWith("custom_")?F=parseInt(a.replace("custom_","")):F={"1m":60*1e3,"5m":300*1e3,"15m":900*1e3,"1h":3600*1e3,"6h":360*60*1e3,"24h":1440*60*1e3}[a]||3600*1e3;const Y=E.getTime()-F;let K=u.filter(Z=>new Date(Z.timestamp).getTime()>=Y);if(l!=="auto"&&K.length>0){let Z;if(l.startsWith("custom_interval_")?Z=parseInt(l.replace("custom_interval_","")):Z={"1s":1e3,"5s":5e3,"1m":6e4,"5m":5*6e4,"1h":60*6e4}[l]||0,Z>0){const ie=new Map;K.forEach(ce=>{const Ee=new Date(ce.timestamp).getTime(),he=Math.floor(Ee/Z)*Z;if(!ie.has(he))ie.set(he,ce);else{const gs=ie.get(he),xs=new Date(gs.timestamp).getTime();Math.abs(Ee-he)<Math.abs(xs-he)&&ie.set(he,ce)}}),K=Array.from(ie.values()).sort((ce,Ee)=>new Date(ce.timestamp).getTime()-new Date(Ee.timestamp).getTime())}}const fe=l==="1s"||l==="5s"||l.startsWith("custom_interval_")&&parseInt(l.replace("custom_interval_",""))<6e4;return K=K.map(Z=>({...Z,time:new Date(Z.timestamp).toLocaleTimeString([],fe?{hour:"2-digit",minute:"2-digit",second:"2-digit"}:{hour:"2-digit",minute:"2-digit"})})),K},[u,t,a,l]),U=E=>{R(F=>({...F,[E]:!F[E]}))},_=Object.values(y).every(E=>E===!0);ne.useEffect(()=>{f&&f(D)},[D,f]);const A=()=>{const E=Object.keys(y).filter(F=>y[F]);d&&d(V),c&&c(b),setTimeout(()=>{s&&s(E),q(!1)},100)},L=()=>{d&&d(V),c&&c(b),setTimeout(()=>{s&&s(),q(!1)},100)},J=E=>{const F=E==="selected"?Object.keys(y).filter(Y=>y[Y]):null;s&&s(F),q(!1)};ne.useEffect(()=>{P&&(x(a),N(l))},[P,a,l]);const He=(E,F)=>`px-3 py-1.5 rounded-md text-xs font-bold flex items-center gap-2 transition-all border ${E?`${F} text-white border-transparent shadow-sm`:"bg-gray-50 text-gray-500 border-gray-200 hover:bg-gray-100"}`;return n.jsxs("div",{className:"w-[calc(100%-2rem)] max-w-7xl mx-auto bg-white rounded-2xl p-4 shadow-sm flex flex-col border border-gray-200 px-6 py-6",children:[n.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Historical Trends of the Sensors"}),n.jsxs("span",{className:"text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-full flex items-center gap-1",children:[n.jsx(Ps,{className:"w-3 h-3"}),le[a]||a.replace("custom_","").replace(/\d+/,E=>{const F=parseInt(E);return F>=864e5?`${(F/864e5).toFixed(1)} Days`:F>=36e5?`${(F/36e5).toFixed(1)} Hours`:F>=6e4?`${(F/6e4).toFixed(1)} Minutes`:`${(F/1e3).toFixed(1)} Seconds`})]}),l!=="auto"&&n.jsx("span",{className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full border border-indigo-200",children:G[l]||l.replace("custom_interval_","").replace(/\d+/,E=>{const F=parseInt(E);return F>=36e5?`${(F/36e5).toFixed(1)} Hour Interval`:F>=6e4?`${(F/6e4).toFixed(1)} Min Interval`:`${(F/1e3).toFixed(1)}s Interval`})}),D.length>0&&n.jsxs("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full border border-purple-200",children:[D.length," points"]}),o!=="None"&&n.jsxs("span",{className:`text-xs px-2 py-1 rounded-full flex items-center gap-1 ${o==="API"?"bg-blue-100 text-blue-700 border border-blue-200":"bg-green-100 text-green-700 border border-green-200"}`,children:[o==="API"?n.jsx(Us,{className:"w-3 h-3"}):n.jsx(Ht,{className:"w-3 h-3"}),o]})]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>q(!P),disabled:r||t.length===0,className:"bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 text-xs font-bold px-4 py-2 rounded-lg flex items-center gap-2 transition disabled:opacity-50",children:[r?n.jsx(Ge,{className:"w-4 h-4 animate-spin"}):n.jsx(pt,{className:"w-4 h-4"}),n.jsx("span",{children:"Export CSV"})]}),P&&!r&&t.length>0&&n.jsx("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50",children:n.jsxs("div",{className:"p-4",children:[n.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-3",children:"Export Options"}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sensors"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>z("all"),className:`flex-1 px-3 py-1.5 text-xs rounded transition-all ${k==="all"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Sensors"}),!_&&n.jsxs("button",{onClick:()=>z("selected"),className:`flex-1 px-3 py-1.5 text-xs rounded transition-all ${k==="selected"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Selected (",Object.values(y).filter(E=>E).length,")"]})]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Time Range"}),n.jsxs("select",{value:V,onChange:E=>x(E.target.value),className:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"1m",children:"Last 1 Minute"}),n.jsx("option",{value:"5m",children:"Last 5 Minutes"}),n.jsx("option",{value:"15m",children:"Last 15 Minutes"}),n.jsx("option",{value:"1h",children:"Last 1 Hour"}),n.jsx("option",{value:"6h",children:"Last 6 Hours"}),n.jsx("option",{value:"24h",children:"Last 24 Hours"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Data Interval"}),n.jsxs("select",{value:b,onChange:E=>N(E.target.value),className:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"auto",children:"Auto"}),n.jsx("option",{value:"1s",children:"1 Second"}),n.jsx("option",{value:"5s",children:"5 Seconds"}),n.jsx("option",{value:"1m",children:"1 Minute"}),n.jsx("option",{value:"5m",children:"5 Minutes"}),n.jsx("option",{value:"1h",children:"1 Hour"})]})]}),n.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-200",children:[n.jsx("button",{onClick:()=>q(!1),className:"flex-1 px-3 py-2 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-all",children:"Cancel"}),n.jsxs("button",{onClick:k==="all"?L:A,className:"flex-1 px-3 py-2 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-all font-medium flex items-center justify-center gap-1",children:[n.jsx(pt,{className:"w-3 h-3"}),"Export"]})]}),n.jsx("div",{className:"mt-2 pt-2 border-t border-gray-100",children:n.jsx("button",{onClick:()=>J(k),className:"w-full px-3 py-1.5 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded transition-all text-center",children:"Quick Export (Current View)"})})]})})]})]}),P&&n.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>q(!1)}),i&&n.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-3 mb-4 flex items-center gap-2 text-sm",children:[n.jsx(Bt,{className:"w-4 h-4 flex-shrink-0"}),n.jsx("span",{children:i})]}),h&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx- shadow-2xl",children:[n.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Custom Time Range"}),n.jsxs("div",{className:"space-y-10",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Range"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"number",value:p,onChange:E=>j(E.target.value),placeholder:"Enter value",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"any"}),n.jsxs("select",{value:C,onChange:E=>v(E.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"seconds",children:"Seconds"}),n.jsx("option",{value:"minutes",children:"Minutes"}),n.jsx("option",{value:"hours",children:"Hours"}),n.jsx("option",{value:"days",children:"Days"})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data Interval (Optional)"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"number",value:S,onChange:E=>M(E.target.value),placeholder:"Leave empty for auto",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",step:"any"}),n.jsxs("select",{value:O,onChange:E=>T(E.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"seconds",children:"Seconds"}),n.jsx("option",{value:"minutes",children:"Minutes"}),n.jsx("option",{value:"hours",children:"Hours"})]})]})]})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx("button",{onClick:()=>g(!1),className:"flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium",children:"Cancel"}),n.jsx("button",{onClick:B,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all font-medium shadow-md",children:"Apply"})]})]})}),n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("div",{className:"flex-1",children:n.jsx($r,{visibleSeries:y,toggleSeries:U,getButtonClass:He,className:"mb-0 p-0 bg-transparent border-0"})}),n.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-gray-600 hidden md:inline",children:"Time Range"}),n.jsxs("select",{value:a.startsWith("custom_")?"custom":a,onChange:E=>{E.target.value==="custom"?g(!0):d&&d(E.target.value)},className:"px-3 py-1 rounded-lg text-xs border border-gray-300 bg-white",children:[n.jsx("option",{value:"1m",children:"1m"}),n.jsx("option",{value:"5m",children:"5m"}),n.jsx("option",{value:"15m",children:"15m"}),n.jsx("option",{value:"1h",children:"1h"}),n.jsx("option",{value:"6h",children:"6h"}),n.jsx("option",{value:"24h",children:"24h"}),n.jsx("option",{value:"custom",children:"Custom"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-gray-600 hidden md:inline",children:"Interval"}),n.jsxs("select",{value:l.startsWith("custom_interval_")?"custom":l,onChange:E=>{E.target.value==="custom"?g(!0):c&&c(E.target.value)},className:"px-3 py-1 rounded-lg text-xs border border-gray-300 bg-white",children:[["auto","1s","5s","1m","5m","1h"].map(E=>n.jsx("option",{value:E,disabled:!I.includes(E),children:G[E]},E)),n.jsx("option",{value:"custom",children:"Custom"})]})]})]})]}),n.jsx("div",{className:"h-96 w-full flex-grow relative",children:e?n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400 bg-white/50 z-10",children:[n.jsx(Ge,{className:"animate-spin w-10 h-10 mb-3 text-blue-500"}),n.jsx("span",{className:"text-sm font-medium",children:"Loading Data..."})]}):D.length===0?n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200",children:n.jsx("span",{className:"text-sm",children:"No data available for this period"})}):n.jsx(js,{width:"100%",height:"100%",children:n.jsxs(Ss,{data:D,margin:{top:10,right:10,left:-20,bottom:0},children:[n.jsx(ks,{strokeDasharray:"3 3",vertical:!1,stroke:"#f0f0f0"}),n.jsx(Cs,{dataKey:"time",tick:{fontSize:11,fill:"#9ca3af"},tickLine:!1,axisLine:{stroke:"#e5e7eb"},minTickGap:30}),n.jsx(lt,{yAxisId:"left",tick:{fontSize:11,fill:"#9ca3af"},tickLine:!1,axisLine:!1,domain:[0,"auto"]}),n.jsx(lt,{yAxisId:"right",orientation:"right",tick:{fontSize:11,fill:"#eab308"},tickLine:!1,axisLine:!1,hide:!y.light}),n.jsx(Ts,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},itemStyle:{fontSize:"12px",fontWeight:600}}),y.moisture&&n.jsx(ye,{yAxisId:"left",type:"monotone",dataKey:"moisture",name:"Moisture (%)",stroke:"#06b6d4",strokeWidth:3,dot:!1,activeDot:{r:6}}),y.temperature&&n.jsx(ye,{yAxisId:"left",type:"monotone",dataKey:"temperature",name:"Temp (Â°C)",stroke:"#22c55e",strokeWidth:3,dot:!1,activeDot:{r:6}}),y.humidity&&n.jsx(ye,{yAxisId:"left",type:"monotone",dataKey:"humidity",name:"Humidity (%)",stroke:"#3b82f6",strokeWidth:3,dot:!1,activeDot:{r:6}}),y.battery&&n.jsx(ye,{yAxisId:"left",type:"step",dataKey:"battery",name:"Battery (%)",stroke:"#a855f7",strokeWidth:3,dot:!1}),y.light&&n.jsx(ye,{yAxisId:"right",type:"monotone",dataKey:"light",name:"Light (lux)",stroke:"#eab308",strokeWidth:3,dot:!1,activeDot:{r:6}})]})})})]})},Lr=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3v18h18"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17V9m6 8V5m-3 12V13"})]}),ps=({title:t="Title",subtitle:e="",deviceId:s="",showDate:r=!0,showDevice:o=!0,icon:i=null})=>{const[a,l]=w.useState(new Date);return w.useEffect(()=>{if(!r)return;const d=setInterval(()=>l(new Date),1e3);return()=>clearInterval(d)},[r]),n.jsx("div",{className:"mb-6 mx-auto justify-center z-50",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"bg-indigo-50 text-indigo-600 rounded-lg p-3",children:i||n.jsx(Lr,{})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:t}),e&&n.jsx("p",{className:"text-sm text-gray-500",children:e})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[r&&n.jsx("div",{className:"text-xl font-semibold text-gray-800",children:a.toLocaleString([],{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),o&&n.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[n.jsx("span",{className:"text-sm text-gray-500",children:"Device ID"}),n.jsx("div",{className:"bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full",children:s||"â€”"})]})]})]})})},Fr=({enabled:t=!0})=>{const e=new Date,s=e.getMonth(),r=e.getDate(),o=s===11,i=o&&(r===24||r===25),a=w.useMemo(()=>{const l=Math.min(80,Math.max(20,Math.floor(window.innerWidth/12)));return Array.from({length:l}).map((d,c)=>{const u=Math.random()*8+6,f=Math.random()*100,y=Math.random()*8,R=6+Math.random()*10,h=.6+Math.random()*.4,g=Math.random()*40+10;return{id:c,size:u,left:f,delay:y,duration:R,opacity:h,sway:g}})},[]);return!t||!o?null:n.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none",children:[n.jsxs("div",{style:{position:"fixed",inset:0,zIndex:40,overflow:"hidden"},children:[n.jsx("style",{children:`
          @keyframes fallDown {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); }
            100% { transform: translateY(110vh) translateX(var(--sway)) rotate(360deg); }
          }
        `}),a.map(l=>n.jsx("div",{style:{position:"absolute",left:`${l.left}%`,top:"-5vh",width:l.size,height:l.size,borderRadius:"50%",background:"rgba(255,255,255,0.9)",boxShadow:"0 0 6px rgba(255,255,255,0.6)",opacity:l.opacity,transform:"translateY(-10vh)",animationName:"fallDown",animationDuration:`${l.duration}s`,animationDelay:`${l.delay}s`,animationTimingFunction:"linear",animationIterationCount:"infinite","--sway":`${(Math.random()>.5?1:-1)*l.sway}px`}},l.id))]}),i&&n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"flex-start",justifyContent:"center",zIndex:50,pointerEvents:"none"},children:n.jsx("div",{style:{marginTop:72,background:"rgba(255,255,255,0.9)",color:"#1f2937",padding:"8px 14px",borderRadius:12,boxShadow:"0 6px 20px rgba(0,0,0,0.12)",fontWeight:600},children:r===24?"Warm wishes â€” Happy Christmas Eve! ðŸŽ„":"Merry Christmas! ðŸŽ… Enjoy the holidays!"})})]})},_r=({deviceId:t,liveData:e,settings:s,isConnected:r,alertMessage:o})=>{const a=t||"device0011233",{jwtToken:l}=Le(),d=e||{moisture:0,temperature:0,humidity:0,light:0,battery:0,pumpStatus:"OFF",pumpMode:"manual"},c=s||{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1},[u]=w.useState(["device9988","device0011233","device0000","device0001","device0002"]),[f,y]=w.useState([]),[R,h]=w.useState([]),[g,p]=w.useState(!1),[j,C]=w.useState(!1),[v,S]=w.useState(null),[M,O]=w.useState(()=>localStorage.getItem(`timeRange_${a}`)||"1h"),[T,P]=w.useState(()=>localStorage.getItem(`dataInterval_${a}`)||"auto"),[q,V]=w.useState({});w.useEffect(()=>{try{const I=U=>{const _=e?.[U];if(_==null||c==null)return{level:"normal",message:null};const A=Number(_);if(!isFinite(A))return{level:"normal",message:null};if(U==="moisture"){const L=parseFloat(c.moistureMin),J=parseFloat(c.moistureMax);if(!isNaN(L)&&A<L)return{level:"critical",message:`CRITICAL: ${A.toFixed(1)}% < ${L}%`};if(!isNaN(J)&&A>J)return{level:"warning",message:`WARNING: ${A.toFixed(1)}% > ${J}%`}}if(U==="temperature"){const L=parseFloat(c.tempMin),J=parseFloat(c.tempMax);if(!isNaN(L)&&A<L)return{level:"critical",message:`CRITICAL: ${A.toFixed(1)}Â°C < ${L}Â°C`};if(!isNaN(J)&&A>J)return{level:"warning",message:`WARNING: ${A.toFixed(1)}Â°C > ${J}Â°C`}}if(U==="humidity"){const L=parseFloat(c.humidityMin),J=parseFloat(c.humidityMax);if(!isNaN(L)&&A<L)return{level:"critical",message:`CRITICAL: ${A.toFixed(1)}% < ${L}%`};if(!isNaN(J)&&A>J)return{level:"warning",message:`WARNING: ${A.toFixed(1)}% > ${J}%`}}if(U==="light"){const L=parseFloat(c.lightMin),J=parseFloat(c.lightMax);if(!isNaN(L)&&A<L)return{level:"critical",message:`CRITICAL: ${Math.round(A)} lux < ${L} lux`};if(!isNaN(J)&&A>J)return{level:"warning",message:`WARNING: ${Math.round(A)} lux > ${J} lux`}}if(U==="battery"){const L=parseFloat(c.batteryMin);if(!isNaN(L)&&A<L)return{level:"critical",message:`Warning: below ${L}%`}}return{level:"normal",message:null}},D={moisture:I("moisture"),temperature:I("temperature"),humidity:I("humidity"),light:I("light"),battery:I("battery")};console.debug("[Dashboard] computed alertStates ->",{rawLive:e,settings:c,states:D}),V(D)}catch(I){console.warn("[Dashboard] alertStates compute failed",I)}},[e,c]);const[x,b]=w.useState(null),[N,k]=w.useState(null);w.useEffect(()=>{const I=async()=>{if(!l){console.warn("âš ï¸ Cannot fetch historical data: missing deviceId or token");return}p(!0),S(null);try{console.log(`ðŸ“Š [HTTP API] Fetching historical data for device: ${a}`);const U=await Or(a);y(U),console.log(`âœ… [HTTP API] Historical data loaded: ${U.length} records`)}catch(U){console.error("âŒ [HTTP API] Failed to fetch historical data:",U),U.response?.data?.data==="Device does not belong to the user"?S(`âš ï¸ Device "${a}" not found in your account. Please update the device ID in Dashboard.jsx or add this device to your ProtoNest account. Real-time data will still work.`):S("Failed to load historical data. Real-time WebSocket data will still work."),y([])}finally{p(!1)}};I();const D=setInterval(()=>{l&&I()},3e4);return()=>clearInterval(D)},[a,l,M]),w.useEffect(()=>{console.log(`[Dashboard] ðŸ”„ Device changed to: ${a} - Resetting view state`),y([]),h([]),S(null),b(null),k(null);const I=localStorage.getItem(`timeRange_${a}`),D=localStorage.getItem(`dataInterval_${a}`);O(I||"1h"),P(D||"auto"),console.log(`[Dashboard] âœ… View reset complete for device: ${a}`)},[a]);const z=async(I=null)=>{C(!0);try{const D=R.length>0?R:f;if(D.length===0){alert("No data available to export. Please wait for data to accumulate.");return}const U=["moisture","temperature","humidity","light","battery"],_=I&&I.length>0?I.filter(Z=>U.includes(Z)):U,A=["time",..._].join(","),L=D.map(Z=>{const ie=[Z.time];return _.forEach(ce=>{ie.push(Z[ce]??"")}),ie.join(",")}).join(`
`),J=`${A}
${L}`,He=new Blob([J],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(He),F=document.createElement("a");F.href=E;const Y=I?"selected":"all",K=M.replace("custom_","custom-"),fe=T==="auto"?"auto":T.replace("custom_interval_","interval-");F.download=`agricop_${a}_${Y}_${K}_${fe}_report.csv`,document.body.appendChild(F),F.click(),document.body.removeChild(F)}catch(D){console.error("Export failed",D)}finally{C(!1)}},B=I=>{console.log(`ðŸ“Š Changing time range to: ${I}`),O(I),localStorage.setItem(`timeRange_${a}`,I);let D="auto";I==="1m"||I==="5m"?D="1s":I==="15m"?D="5s":I==="1h"?D="auto":I==="6h"?D="1m":I==="24h"&&(D="5m"),P(D),localStorage.setItem(`dataInterval_${a}`,D)},le=I=>{console.log(`ðŸ“Š Changing data interval to: ${I}`),P(I),localStorage.setItem(`dataInterval_${a}`,I)},G=d?.pumpStatus||"OFF",ae=I=>{try{const D=d?.[I];if(D==null||c==null)return"critical";const U=Number(D);if(!isFinite(U))return"critical";let _=NaN,A=NaN;const L={moistureMin:20,moistureMax:70,tempMin:10,tempMax:35,humidityMin:30,humidityMax:80,lightMin:200,lightMax:1e3,batteryMin:20};switch(I){case"moisture":_=parseFloat(c.moistureMin),A=parseFloat(c.moistureMax),isNaN(_)&&(_=L.moistureMin),isNaN(A)&&(A=L.moistureMax);break;case"temperature":_=parseFloat(c.tempMin),A=parseFloat(c.tempMax),isNaN(_)&&(_=L.tempMin),isNaN(A)&&(A=L.tempMax);break;case"humidity":_=parseFloat(c.humidityMin),A=parseFloat(c.humidityMax),isNaN(_)&&(_=L.humidityMin),isNaN(A)&&(A=L.humidityMax);break;case"light":_=parseFloat(c.lightMin),A=parseFloat(c.lightMax),isNaN(_)&&(_=L.lightMin),isNaN(A)&&(A=L.lightMax);break;case"battery":_=parseFloat(c.batteryMin),isNaN(_)&&(_=L.batteryMin),A=100;break;default:break}return!isNaN(_)&&U===_||!isNaN(A)&&U===A?"warning":!isNaN(_)&&U<_||!isNaN(A)&&U>A?"critical":"normal"}catch(D){return console.warn("[Dashboard] getSensorStatus failed",D),"critical"}};return n.jsxs("div",{className:"min-h-screen bg-[#f0f4f8] p-4 font-sans text-gray-800 overflow-x-hidden",children:[n.jsx(Fr,{}),n.jsx("div",{className:"w-[calc(100%-2rem)] max-w-7xl justify-center mx-auto mb-6",children:n.jsx(ps,{title:"Dashboard",subtitle:"Real-time sensor readings, charts, and controls for your device.",deviceId:a})}),n.jsxs("div",{className:"w-[calc(100%-2rem)] mx-auto px-4 mb-8",children:[n.jsx("div",{className:"max-w-7xl mx-auto",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:[n.jsx(ve,{label:"Soil Moisture",value:d?.moisture,unit:"%",decimals:1,status:ae("moisture")}),n.jsx(ve,{label:"Temperature",value:d?.temperature,unit:"Â°C",decimals:1,status:ae("temperature")}),n.jsx(ve,{label:"Humidity",value:d?.humidity,unit:"%",decimals:1,status:ae("humidity")}),n.jsx(ve,{label:"Light",value:d?.light,unit:" lux",decimals:0,status:ae("light")}),n.jsx(ve,{label:"Battery",value:d?.battery,unit:"%",decimals:0,status:ae("battery")})]})}),n.jsx("div",{className:`w-[calc(100%-2rem)] max-w-7xl mx-auto rounded-xl py-3 text-center border transition-colors duration-500 shadow-sm ${G==="ON"?"bg-green-100 border-green-300 text-green-900":"bg-blue-100 border-blue-300 text-blue-900"}`,children:n.jsxs("h2",{className:"text-lg font-semibold",children:["Pump : ",G," (",d?.pumpMode||"Optimal",")"]})})]}),n.jsx("div",{className:"w-[calc(100%-2rem)] mx-auto flex flex-col items-center justify-center",children:n.jsx("div",{className:"w-full",children:n.jsx(Ir,{chartData:f,isLoading:g,onExportCSV:z,isExporting:j,dataSource:"HTTP API",error:v,timeRange:M,dataInterval:T,onTimeRangeChange:B,onDataIntervalChange:le,allData:f,onFilteredDataChange:h})})})]})},Ft=({label:t,value:e,onChange:s,min:r,max:o,step:i="1",error:a,unit:l=""})=>n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:[t," ",l&&`(${l})`]}),n.jsx("input",{type:"number",min:r,max:o,step:i,value:e,onChange:s,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none ${a?"border-red-300":"border-gray-300"}`}),n.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Valid Range: ",r," - ",o," ",l]}),a&&n.jsx("p",{className:"text-red-500 text-xs mt-1",children:a})]}),Ne=({title:t,minConfig:e,maxConfig:s,rangeError:r,icon:o})=>n.jsxs("div",{className:"space-y-4",children:[n.jsx("h4",{className:"font-semibold text-gray-700 border-b pb-2",children:n.jsxs("div",{className:"flex items-center gap-3",children:[o&&n.jsx(o,{className:"w-5 h-5 text-gray-600"}),n.jsx("span",{children:t})]})}),r&&n.jsxs("div",{className:"text-red-600 text-sm flex items-center gap-2",children:[n.jsx(Wt,{className:"w-4 h-4"}),r]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx(Ft,{...e}),s&&n.jsx(Ft,{...s})]})]}),Pr=({onClick:t,disabled:e,loading:s,loadingText:r="Processing...",icon:o,children:i,className:a=""})=>n.jsx("button",{onClick:t,disabled:e||s,className:`flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition ${a}`,children:s?n.jsxs(n.Fragment,{children:[n.jsx(Ge,{className:"w-4 h-4 animate-spin"}),r]}):n.jsxs(n.Fragment,{children:[o&&n.jsx(o,{className:"w-4 h-4"}),i]})}),Ur=({enabled:t,onToggle:e,title:s="Automatic Mode",description:r="Auto control pump based on moisture thresholds"})=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-700",children:s}),n.jsx("div",{className:"text-xs text-gray-500",children:r})]}),n.jsx("button",{onClick:e,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${t?"bg-blue-600":"bg-gray-300"}`,children:n.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]}),Br=({open:t,title:e="Cannot Save Settings",errors:s=[],onClose:r})=>t?n.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[n.jsx("div",{className:"absolute inset-0 bg-black opacity-40",onClick:r}),n.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4 z-10 border-2 border-red-200",children:[n.jsxs("div",{className:"p-4 border-b flex items-center gap-3",children:[n.jsx(Wt,{className:"w-6 h-6 text-red-600"}),n.jsx("h3",{className:"text-lg font-semibold text-red-700",children:e})]}),n.jsxs("div",{className:"p-4",children:[n.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"There are errors in the form. Please correct the highlighted fields before saving."}),s&&s.length>0&&n.jsx("ul",{className:"list-disc list-inside text-sm text-red-600 space-y-1 mb-4",children:s.map((o,i)=>n.jsx("li",{children:o},i))}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-semibold",children:"Close"})})]})]})]}):null,te={moisture:{min:20,max:60},temperature:{min:10,max:35},humidity:{min:30,max:70},light:{min:100,max:1e3},battery:{min:20}},Hr=({deviceId:t})=>{const e=t,[s,r]=w.useState(te),[o,i]=w.useState(!1),[a,l]=w.useState(!1),[d,c]=w.useState(""),[u,f]=w.useState(!1),[y,R]=w.useState([]),{addNotification:h}=st();w.useEffect(()=>{if(!e)return;const x=`settings_${e}`;try{const b=localStorage.getItem(x);if(b){const N=JSON.parse(b);if(N.thresholds){const k=Object.keys(te).reduce((z,B)=>(z[B]={...te[B],...N.thresholds[B]||{}},z),{});r(k)}typeof N.autoMode=="boolean"&&i(N.autoMode),typeof N.pumpOn=="boolean"&&l(N.pumpOn)}}catch{}},[e]);const g=(x={})=>{if(!e)return;const b=`settings_${e}`,N={thresholds:{...s,...x.thresholds||{}},autoMode:typeof x.autoMode=="boolean"?x.autoMode:o,pumpOn:typeof x.pumpOn=="boolean"?x.pumpOn:a};localStorage.setItem(b,JSON.stringify(N)),window.dispatchEvent(new CustomEvent("settings:updated",{detail:{deviceId:e}}))},p=(x,b,N)=>{r(k=>{const z=Number(N),B=Number.isNaN(z)&&k&&k[x]&&typeof k[x][b]<"u"?k[x][b]:z;return{...k,[x]:{...k[x],[b]:B}}})},j=()=>{i(x=>{const b=!x;try{h({type:"pump:mode",message:`Pump mode set to ${b?"auto":"manual"}`,timestamp:new Date().toISOString(),meta:{deviceId:e}})}catch{}return b})},C=()=>{l(x=>{const b=!x;g({pumpOn:b});try{const N=o?"auto":"manual";h({type:"pump:status",message:`Pump turned ${b?"ON":"OFF"} (${N})`,timestamp:new Date().toISOString(),meta:{deviceId:e,mode:N}})}catch{}return b})},[v,S]=w.useState({moisture:"unknown",temperature:"unknown",humidity:"unknown",light:"unknown",battery:"unknown"});w.useEffect(()=>{try{const b=window.__latestLiveData||null;b&&typeof b=="object"&&(S(N=>({moisture:typeof b.moisture<"u"?b.moisture:N.moisture,temperature:typeof b.temperature<"u"?b.temperature:N.temperature,humidity:typeof b.humidity<"u"?b.humidity:N.humidity,light:typeof b.light<"u"?b.light:N.light,battery:typeof b.battery<"u"?b.battery:N.battery})),typeof b.pumpStatus<"u"&&l(String(b.pumpStatus).toUpperCase()==="ON"),typeof b.pumpMode<"u"&&i(String(b.pumpMode).toLowerCase()==="auto"))}catch{}const x=b=>{const N=b&&b.detail?b.detail:b;if(N){S(k=>({moisture:typeof N.moisture<"u"?N.moisture:k.moisture,temperature:typeof N.temperature<"u"?N.temperature:k.temperature,humidity:typeof N.humidity<"u"?N.humidity:k.humidity,light:typeof N.light<"u"?N.light:k.light,battery:typeof N.battery<"u"?N.battery:k.battery}));try{typeof N.pumpStatus<"u"&&l(String(N.pumpStatus).toUpperCase()==="ON"),typeof N.pumpMode<"u"&&i(String(N.pumpMode).toLowerCase()==="auto")}catch{}}};return window.addEventListener("live:update",x),()=>window.removeEventListener("live:update",x)},[]);const M=x=>{const b=v[x];if(b==null||String(b)==="unknown")return"critical";const N=Number(b);if(Number.isNaN(N))return"critical";const k=s&&s[x]||te[x]||{},z=typeof k.min<"u"?Number(k.min):void 0,B=typeof k.max<"u"?Number(k.max):void 0;return typeof z<"u"&&!Number.isNaN(z)&&N===z||typeof B<"u"&&!Number.isNaN(B)&&N===B?"warning":typeof z<"u"&&!Number.isNaN(z)&&N<z||typeof B<"u"&&!Number.isNaN(B)&&N>B?"critical":"normal"},O=x=>{const b=M(x);return b==="critical"?{container:"bg-red-50 rounded p-2",icon:"text-red-600",value:"text-red-600"}:b==="warning"?{container:"bg-yellow-50 rounded p-2",icon:"text-yellow-600",value:"text-yellow-600"}:{container:"bg-green-50 rounded p-2",icon:"text-green-600",value:"text-green-600"}},T=()=>{q()},P={moisture:{min:0,max:100},temperature:{min:-10,max:60},humidity:{min:0,max:100},light:{min:0,max:2e3},battery:{min:0,max:100}},q=()=>{const x=[];if(Object.keys(P).forEach(b=>{const N=P[b],k=s[b]||{};typeof k.min>"u"||k.min===null||k.min===""?x.push(`${V(b)} Min is required.`):Number.isNaN(Number(k.min))?x.push(`${V(b)} Min must be a number.`):(Number(k.min)<N.min||Number(k.min)>N.max)&&x.push(`${V(b)} Min must be between ${N.min} and ${N.max}.`),typeof k.max<"u"&&(k.max===null||k.max===""?x.push(`${V(b)} Max is required.`):Number.isNaN(Number(k.max))?x.push(`${V(b)} Max must be a number.`):(Number(k.max)<N.min||Number(k.max)>N.max)&&x.push(`${V(b)} Max must be between ${N.min} and ${N.max}.`)),typeof k.min<"u"&&typeof k.max<"u"&&k.min!==""&&k.max!==""&&Number(k.min)>Number(k.max)&&x.push(`${V(b)} Min cannot be greater than Max.`)}),x.length>0){R(x),f(!0);return}g({thresholds:s}),c("Settings saved"),setTimeout(()=>c(""),2500)},V=x=>x.charAt(0).toUpperCase()+x.slice(1);return n.jsx(n.Fragment,{children:n.jsxs("div",{className:"min-h-screen bg-[#f0f4f8] p-4 font-sans text-gray-800 overflow-x-hidden",children:[n.jsx("div",{children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx(ps,{title:"Device Settings",subtitle:"Configure thresholds and pump",deviceId:e,showDate:!0,icon:n.jsx(Ze,{className:"w-6 h-6"})}),n.jsx("div",{className:" p-8 mx-auto mt-6 bg-blue-100 rounded-lg shadow-md border-blue-50",children:n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-6 w-full lg:col-span-8",children:n.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 grid grid-cols-2 grid-rows-3 gap-6",children:[n.jsx("div",{children:n.jsx(Ne,{title:"Soil Moisture Thresholds",icon:gt,minConfig:{label:"Min",unit:"%",value:s&&s.moisture&&typeof s.moisture.min<"u"?s.moisture.min:te.moisture.min,onChange:x=>p("moisture","min",x.target.value),min:0,max:100,step:1},maxConfig:{label:"Max",unit:"%",value:s&&s.moisture&&typeof s.moisture.max<"u"?s.moisture.max:te.moisture.max,onChange:x=>p("moisture","max",x.target.value),min:0,max:100,step:1}})}),n.jsx("div",{children:n.jsx(Ne,{title:"Temperature Thresholds",icon:bt,minConfig:{label:"Min",unit:"Â°C",value:s&&s.temperature&&typeof s.temperature.min<"u"?s.temperature.min:te.temperature.min,onChange:x=>p("temperature","min",x.target.value),min:-10,max:50,step:.5},maxConfig:{label:"Max",unit:"Â°C",value:s&&s.temperature&&typeof s.temperature.max<"u"?s.temperature.max:te.temperature.max,onChange:x=>p("temperature","max",x.target.value),min:0,max:60,step:.5}})}),n.jsx("div",{children:n.jsx(Ne,{title:"Humidity Thresholds",icon:ht,minConfig:{label:"Min",unit:"%",value:s&&s.humidity&&typeof s.humidity.min<"u"?s.humidity.min:te.humidity.min,onChange:x=>p("humidity","min",x.target.value),min:0,max:100,step:1},maxConfig:{label:"Max",unit:"%",value:s&&s.humidity&&typeof s.humidity.max<"u"?s.humidity.max:te.humidity.max,onChange:x=>p("humidity","max",x.target.value),min:0,max:100,step:1}})}),n.jsx("div",{children:n.jsx(Ne,{title:"Light Intensity Thresholds",icon:yt,minConfig:{label:"Min",unit:"lux",value:s&&s.light&&typeof s.light.min<"u"?s.light.min:te.light.min,onChange:x=>p("light","min",x.target.value),min:0,max:2e3,step:10},maxConfig:{label:"Max",unit:"lux",value:s&&s.light&&typeof s.light.max<"u"?s.light.max:te.light.max,onChange:x=>p("light","max",x.target.value),min:0,max:2e3,step:10}})}),n.jsx("div",{className:"col-span-2",children:n.jsx(Ne,{title:"Battery Protection",icon:mt,minConfig:{label:"Min",unit:"%",value:s&&s.battery&&typeof s.battery.min<"u"?s.battery.min:te.battery.min,onChange:x=>p("battery","min",x.target.value),min:0,max:100,step:1}})})]})}),n.jsxs("div",{className:"self-start lg:pl-4 lg:col-span-4 flex flex-col justify-between h-full space-y-4",children:[n.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-4 ",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:" ml-8 text-lg font-semibold text-gray-800",children:"Current Status"})})}),n.jsxs("div",{className:"px-4 grid grid-cols-2 gap-3 text-sm text-gray-700",children:[(()=>{const x=O("moisture");return n.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[n.jsx(gt,{className:`w-4 h-4 ${x.icon}`}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Moisture"}),n.jsxs("div",{className:`font-medium ${x.value}`,children:[String(v.moisture),"%"]})]})]})})(),(()=>{const x=O("temperature");return n.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[n.jsx(bt,{className:`w-4 h-4 ${x.icon}`}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Temperature"}),n.jsxs("div",{className:`font-medium ${x.value}`,children:[String(v.temperature),"Â°C"]})]})]})})(),(()=>{const x=O("humidity");return n.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[n.jsx(ht,{className:`w-4 h-4 ${x.icon}`}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Humidity"}),n.jsxs("div",{className:`font-medium ${x.value}`,children:[String(v.humidity),"%"]})]})]})})(),(()=>{const x=O("light");return n.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[n.jsx(yt,{className:`w-4 h-4 ${x.icon}`}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Light"}),n.jsxs("div",{className:`font-medium ${x.value}`,children:[String(v.light)," lux"]})]})]})})(),(()=>{const x=O("battery");return n.jsxs("div",{className:`flex items-center gap-2 ${x.container}`,children:[n.jsx(mt,{className:`w-4 h-4 ${x.icon}`}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Battery"}),n.jsxs("div",{className:`font-medium ${x.value}`,children:[String(v.battery),"%"]})]})]})})(),(()=>{const x=a?"text-green-600":"text-gray-600",b=a?"text-green-600":"text-gray-700";return n.jsxs("div",{className:`flex items-center gap-2 ${a?"bg-green-50 rounded p-2":""}`,children:[n.jsx(zs,{className:`w-4 h-4 ${x}`}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-gray-500",children:"Pump"}),n.jsx("div",{className:`font-medium ${b}`,children:a?"ON":"OFF"})]})]})})()]})]}),n.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-6 h-full w-full lg:w-auto",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(Ws,{className:"w-6 h-6 text-gray-600"}),n.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"Pump Control"})]}),n.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 flex flex-col gap-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-2",children:n.jsx(Ur,{enabled:o,onToggle:j})}),n.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex flex-col items-start",children:[n.jsx("div",{className:"font-semibold text-gray-700",children:"Manual Control"}),n.jsxs("div",{className:"flex flex-col items-start gap-1 mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),n.jsx("span",{className:`font-bold ${a?"text-green-600":"text-gray-700"}`,children:a?"ON":"OFF"})]}),n.jsx("div",{children:n.jsx("span",{className:`${o?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"} text-xs px-2 py-0.5 rounded`,children:o?"auto":"manual"})})]})]}),n.jsxs("button",{onClick:C,"aria-pressed":a,disabled:o,className:`flex items-center gap-3 px-6 py-3 rounded-lg font-bold text-white shadow-md transition-all focus:outline-none ${a?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 2v10"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.5 7.5a8.5 8.5 0 1013 0"})]}),a?"Turn OFF":"Turn ON"]})]})]})]}),n.jsxs("div",{className:"flex flex-col items-center mt-6",children:[n.jsx(Pr,{onClick:T,className:"w-full",children:"Save Settings"}),d&&n.jsx("div",{className:"text-center text-sm text-green-600 mt-4",children:d})]})]})]})})]})}),n.jsx(Br,{open:u,errors:y,onClose:()=>f(!1)})]})})};function Wr(){const{jwtToken:t}=Le(),{addNotification:e}=st(),[s,r]=w.useState(()=>localStorage.getItem("activeTab")||"dashboard"),o="device0011233",[i,a]=w.useState(()=>localStorage.getItem("selectedDevice")||o),[l,d]=w.useState({moisture:0,temperature:0,humidity:0,light:0,battery:0,pumpStatus:"OFF",pumpMode:"manual"}),[c,u]=w.useState(!1),[f,y]=w.useState(()=>{try{const g=localStorage.getItem(`settings_${i}`);return g?JSON.parse(g):{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1}}catch{return{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1}}});w.useEffect(()=>{try{window.__latestLiveData=l,window.dispatchEvent(new CustomEvent("live:update",{detail:l}))}catch{}},[l]);const R=ne.useRef(null);ne.useEffect(()=>{try{const g=R.current||{},p=l||{};let j=null;try{const S=localStorage.getItem(`settings_${i}`);S&&(j=JSON.parse(S).thresholds||null)}catch{}const C=["moisture","temperature","humidity","light","battery"],v=(S,M)=>{if(M==null||String(M)==="unknown")return!0;const O=Number(M);if(Number.isNaN(O))return!0;const T=j&&j[S]||null,P=T&&typeof T.min<"u"?Number(T.min):void 0,q=T&&typeof T.max<"u"?Number(T.max):void 0;return typeof P<"u"&&!Number.isNaN(P)&&O<P||typeof q<"u"&&!Number.isNaN(q)&&O>q};if(C.forEach(S=>{const M=v(S,g[S]),O=v(S,p[S]);if(!M&&O)try{e({type:"critical",message:`Critical: ${S}=${p[S]}`,timestamp:new Date().toISOString(),meta:{deviceId:i,sensor:S,value:p[S]}})}catch{}}),(g.pumpStatus||"")!==(p.pumpStatus||"")){const S=p.pumpMode||(f&&f.autoMode?"auto":"manual")||"manual";try{e({type:"pump:status",message:`Pump ${p.pumpStatus} (${S})`,timestamp:new Date().toISOString(),meta:{deviceId:i,mode:S}})}catch{}}}catch{}finally{R.current=l}},[l,i,e,f]),w.useEffect(()=>{localStorage.setItem("activeTab",s)},[s]),w.useEffect(()=>{localStorage.setItem("selectedDevice",i)},[i]),w.useEffect(()=>{try{const g=localStorage.getItem(`settings_${i}`);y(g?JSON.parse(g):{moistureMin:"20",moistureMax:"70",tempMin:"10",tempMax:"35",humidityMin:"30",humidityMax:"80",lightMin:"200",lightMax:"1000",batteryMin:"20",autoMode:!1})}catch(g){console.warn("[App] Failed to load settings",g)}},[i]),w.useEffect(()=>{const g=p=>{try{const j=p?.detail?.deviceId;if(!j||j!==i)return;const C=localStorage.getItem(`settings_${i}`);C&&y(JSON.parse(C))}catch(j){console.error("[App] onSettingsUpdated",j)}};return window.addEventListener("settings:updated",g),()=>window.removeEventListener("settings:updated",g)},[i]);const h=w.useRef({cmd:null,ts:0});return w.useEffect(()=>{try{if(!f||!f.autoMode)return;const g=l?.moisture;if(g==null)return;const p=Number(g);if(!isFinite(p))return;let j=parseFloat(f.moistureMin);isNaN(j)&&(j=20);const C=p<=j?"ON":"OFF",v=Date.now(),S=h.current;if(S.cmd===C&&v-S.ts<5e3||!i||(l?.pumpStatus||"").toUpperCase()===C)return;console.log("[App] AUTO MODE: sending pump command",{device:i,desired:C,moisture:p,min:j}),Rr(i,C,"pump","auto").then(O=>{h.current={cmd:C,ts:Date.now()},console.log("[App] AUTO MODE: pump command response",O)}).catch(O=>{console.error("[App] AUTO MODE: pump command failed",O)})}catch(g){console.warn("[App] auto control failed",g)}},[f?.autoMode,l?.moisture,i,l?.pumpStatus]),w.useEffect(()=>{if(!t)return;se.connect(t).then(()=>console.log("[App] WebSocket connected (global)")).catch(v=>console.warn("[App] WebSocket connect failed",v));const g=()=>u(!0),p=()=>u(!1);se.onConnect(g),se.onDisconnect(p);const j=v=>{d(S=>{const M={...S};if(v.sensorType==="batchUpdate"){const O=v.value||{};O.temp!==void 0&&(M.temperature=parseFloat(O.temp)),O.humidity!==void 0&&(M.humidity=parseFloat(O.humidity)),O.battery!==void 0&&(M.battery=parseFloat(O.battery)),O.light!==void 0&&(M.light=parseFloat(O.light)),O.moisture!==void 0&&(M.moisture=parseFloat(O.moisture))}else switch(v.sensorType){case"temp":M.temperature=parseFloat(v.value);break;case"humidity":M.humidity=parseFloat(v.value);break;case"battery":M.battery=parseFloat(v.value);break;case"light":M.light=parseFloat(v.value);break;case"moisture":M.moisture=parseFloat(v.value);break;case"pumpStatus":M.pumpStatus=v.value;break;case"pumpMode":M.pumpMode=v.value;break}return M})},C=()=>{try{se.subscribeToDevice(i,j)}catch(v){console.warn("[App] subscribeToDevice failed",v)}};try{se.getConnectionStatus()&&C()}catch{}return se.onConnect(()=>C()),()=>{try{se.offConnect(g),se.offDisconnect(p),se.unsubscribeFromDevice(i)}catch(v){console.warn("[App] cleanup failed",v)}}},[t,i]),n.jsx(Ds,{children:n.jsxs("div",{className:"App",children:[n.jsx(Zs,{activeTab:s,setActiveTab:r,selectedDevice:i,setSelectedDevice:a,isConnected:c}),n.jsx("div",{className:"pt-24"}),s==="dashboard"?n.jsx(_r,{deviceId:i,liveData:l,settings:f,isConnected:c}):n.jsx(Hr,{deviceId:i})]})})}const qr=()=>"https://api.protonestconnect.co/api/v1/user",_t=qr(),zr=async(t,e)=>{try{const s=t.trim(),r=e.trim();if(!s.includes("@"))throw new Error("Invalid email format");console.log("ðŸ”„ Making secure authentication request to:",_t),console.log("ðŸ“‹ IMPORTANT: Using secretKey as password (not login password)");const o={email:s,password:r};console.log("ðŸ”„ Attempting /get-token with documented payload structure:",{email:s,passwordType:"secretKey",passwordLength:r.length});try{const i=await W.post(`${_t}/get-token`,o,{headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(console.log("ðŸ“¡ API Response from /get-token (Success):",i.data),i.data.status==="Success"){const a=i.data.data?.jwtToken,l=i.data.data?.refreshToken;if(!a)throw new Error("No JWT token in response data");return console.log("âœ… Login successful via /get-token. JWT token received securely."),{jwtToken:a,refreshToken:l,userId:s}}else throw new Error(`Authentication failed: ${i.data.message||"Unexpected response status"}`)}catch(i){if(i.response?.status===400){const a=i.response.data;throw console.error("âŒ Authentication failed (400):",{serverResponse:JSON.stringify(a,null,2),possibleCauses:["Invalid email format - check email address","Invalid credentials - verify email is registered","Wrong secretKey - check Protonest dashboard for correct secretKey","User not found - email not registered in system","Email not verified - check email verification status"]}),a?.data==="Invalid email format"?new Error("Invalid email format. Please check the email address."):a?.data==="Invalid credentials"?new Error("Invalid credentials. Please verify the email and secretKey from Protonest dashboard."):a?.data==="User not found"?new Error("User not found. Please check if the email is registered in the system."):a?.data==="Email not verified"?new Error("Email not verified. Please verify your email address first."):new Error(`Authentication failed: ${a?.data||"Please verify email and secretKey"}`)}else throw i.response?.status===500?(console.error("âŒ Server error (500):",i.response.data),new Error("Internal server error. Please try again later.")):(console.error(`âŒ Unexpected error (${i.response?.status}):`,i.response?.data),i)}}catch(s){throw console.error("âŒ Login process failed:",{message:s.message,email:t?.trim(),hasPassword:!0,passwordLength:e?.length||0}),s}},Ae="ratnaabinayansn@gmail.com",Pt="6M3@pwYvBGRVJLN",Jr=({children:t})=>{const{setAuth:e}=Le(),[s,r]=ne.useState(!1),[o,i]=ne.useState(!0);return ne.useEffect(()=>{if(s)return;r(!0),(async()=>{try{console.log("ðŸ”‘ Attempting auto login with real credentials..."),console.log("ðŸ“§ Email:",Ae),console.log("ðŸ” SecretKey length:",Pt.length);const l=await zr(Ae,Pt);console.log("âœ… Auto login successful. Ready for connection."),e({userId:l.userId||Ae,jwtToken:l.jwtToken}),l.refreshToken&&localStorage.setItem("refreshToken",l.refreshToken)}catch(l){console.warn("âš ï¸ Auto login failed. Using mock data for development."),console.error("Auto login error details:",l.message),l.message.includes("Invalid credentials")&&console.error("ðŸ”§ Credentials may be incorrect or expired. Please verify from Protonest dashboard"),e({userId:Ae,jwtToken:"MOCK_TOKEN_FOR_TESTING"})}finally{i(!1)}})()},[e,s]),o?n.jsx("div",{className:"min-h-screen flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600",children:"Authenticating with Protonest API..."}),n.jsx("p",{className:"text-blue-600 text-sm mt-2",children:"âœ… Using real credentials"})]})}):t};Rs.createRoot(document.getElementById("root")).render(n.jsx($s,{children:n.jsx(Jr,{children:n.jsx(vs,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:n.jsx(Ks,{children:n.jsx(Wr,{})})})})}));
